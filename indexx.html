<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema Control MEP - Lic. S√°nchez</title>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>

    <style>
        :root {
            --mep-blue: #3498db;
            --mep-green: #27ae60;
            --mep-red: #e74c3c;
            --mep-yellow: #f1c40f;
            --mep-orange: #e67e22;
            --mep-purple: #9b59b6;
            --mep-teal: #16a085; /* Color para Cotidiano */
            --mep-bitacora: #34495e; /* Color para Bit√°cora */
            --bg-color: #f0f2f5;
        }

        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin: 20px; background-color: var(--bg-color); }
        .container { max-width: 1400px; margin: auto; }

        .topbar{position:sticky;top:10px;z-index:1500;display:flex;align-items:center;justify-content:space-between;gap:10px;margin-bottom:12px}
        .btn-menu{background:var(--mep-blue);color:#fff;border:none;padding:10px 16px;border-radius:12px;cursor:pointer;font-weight:1000}
        .btn-menu:hover{filter:brightness(.95)}
        .topbar-meta{background:#fff;border:1px solid #e3e3e3;border-radius:999px;padding:10px 14px;font-weight:900;color:#2c3e50;box-shadow:0 2px 6px rgba(0,0,0,.06);max-width:75%;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}

        .menu-overlay{position:fixed;inset:0;background:rgba(0,0,0,.5);display:none;align-items:flex-start;justify-content:center;padding:80px 12px;z-index:2500}
        .menu-overlay.open{display:flex}
        .menu-panel{width:min(820px, 96%);background:#fff;border-radius:18px;box-shadow:0 14px 50px rgba(0,0,0,.25);overflow:hidden}
        .menu-header{display:flex;align-items:center;justify-content:space-between;gap:12px;padding:14px 16px;border-bottom:1px solid #eee;background:#f8fbfb}
        .menu-title{font-size:1.1em;font-weight:1000;color:#2c3e50}
        .menu-subtitle{font-size:.85em;color:#7f8c8d;font-weight:800;margin-top:2px}
        .menu-close{border:none;background:transparent;font-size:30px;line-height:24px;cursor:pointer;border-radius:10px;padding:2px 10px;color:#444}
        .menu-close:hover{background:rgba(0,0,0,.06)}
        .menu-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:10px;padding:14px}
        .menu-item{border:none;background:#eef2f3;color:#2c3e50;padding:12px 14px;border-radius:14px;cursor:pointer;font-weight:1000;text-align:left}
        .menu-item:hover{filter:brightness(.98)}
        .menu-item.primary{background:var(--mep-blue);color:#fff}

        .portada-actions{display:flex;gap:10px;flex-wrap:wrap;margin-top:10px}
        .portada-actions .btn-save-lista,.portada-actions .btn-reset-general{width:auto;flex:1 1 240px}
        .portada-preview{margin-top:12px;background:#eef2f3;border:1px solid #dfe6e9;border-radius:14px;padding:12px}


        .card { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); margin-bottom: 25px; }
        h1, h2, h3 { text-align: center; color: #2c3e50; text-transform: uppercase; }
        h2 { border-bottom: 3px solid var(--mep-blue); padding-bottom: 10px; }

        .nav-tabs { display: flex; justify-content: center; gap: 10px; margin-bottom: 20px; flex-wrap: wrap; }
        .nav-tabs button { padding: 12px 24px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; transition: 0.3s; margin-top: 5px; font-size: 1em; }
        .btn-nav { background: #dcdde1; color: #2f3640; }
        .btn-nav.active { background: var(--mep-blue); color: white; }

        /* Colores espec√≠ficos por Tab */
        #tabTareas.active { background: var(--mep-purple); }
        #tabCotidiano.active { background: var(--mep-teal); }

        
        #tabBitacora.active { background: var(--mep-bitacora); color: white; }
.submenu-container { text-align: center; margin-bottom: 20px; padding: 15px; background: #eef2f3; border-radius: 8px; display: none; }
        .submenu-container.visible { display: block; }

        .btn-subnav { background: #fff; border: 2px solid var(--mep-blue); color: var(--mep-blue); padding: 10px 20px; margin: 5px; border-radius: 6px; cursor: pointer; font-weight: bold; transition: 0.2s; }
        .btn-subnav:hover, .btn-subnav.active { background: var(--mep-blue); color: white; }

        .btn-materia-prueba { border-color: #8e44ad; color: #8e44ad; }
        .btn-materia-prueba:hover, .btn-materia-prueba.active { background: #8e44ad; color: white; }

        .btn-periodo-prueba { border-color: #27ae60; color: #27ae60; }
        .btn-periodo-prueba:hover, .btn-periodo-prueba.active { background: #27ae60; color: white; }

        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th, td { border: 1px solid #000; padding: 8px; text-align: center; font-size: 0.85em; }
        th { background: #ecf0f1; font-weight: bold; }

        .m-esp { background-color: #fff9c4; }
        .m-mate { background-color: #ffffff; }
        .m-soc { background-color: #fffde7; }
        .receso { background-color: #f1f2f6; font-style: italic; color: #7f8c8d; }

        /* opcionales (por si quiere color en otras materias) */
        .m-mus { background-color: #f3e5f5; }
        .m-ing { background-color: #e3f2fd; }
        .m-inf { background-color: #e8f5e9; }
        .m-rel { background-color: #fce4ec; }

                .estudiantes-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(520px, 1fr)); gap: 12px; }
        .estudiante-item { display: flex; flex-direction: column; gap: 10px; background: #f9f9f9; padding: 10px 12px; border: 1px solid #ddd; border-radius: 10px; }
        .estudiante-top { display: flex; align-items: center; gap: 10px; }
        .estudiante-extra { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .num-lista { font-weight: bold; color: var(--mep-blue); width: 32px; text-align: center; }
        .input-estudiante { flex: 1 1 auto; padding: 8px; border: 1px solid #ccc; border-radius: 6px; }
        .input-small { padding: 8px; border: 1px solid #ccc; border-radius: 6px; width: 100%; }
        .select-condicion { width: 190px; padding: 8px; border: 1px solid #ccc; border-radius: 6px; font-size: 0.85em; background-color: white; }
        @media (max-width: 620px) {
            .estudiantes-grid { grid-template-columns: 1fr; }
            .estudiante-extra { grid-template-columns: 1fr; }
            .select-condicion { width: 100%; }
        }

        /* ====== ESTUDIANTES: UI M√ÅS LIMPIA (COMPACTO / OCULTAR VAC√çOS) ====== */
        .estudiantes-toolbar { display: flex; justify-content: center; gap: 10px; flex-wrap: wrap; margin: 8px 0 14px; }
        .estudiantes-toolbar .chip { display: inline-flex; align-items: center; gap: 8px; background: #eef2f3; border: 1px solid #dfe6e9; color: #2c3e50; padding: 8px 12px; border-radius: 999px; font-weight: 900; }
        .estudiantes-toolbar input[type="checkbox"] { width: auto; }

        .estudiante-actions { display: flex; gap: 8px; align-items: center; flex: 0 0 auto; }
        .btn-icon { width: 36px; height: 36px; border-radius: 10px; border: 1px solid #dfe6e9; background: #fff; cursor: pointer; font-weight: 1000; line-height: 34px; }
        .btn-icon:hover { filter: brightness(.98); }
        .btn-icon.details { border-color: rgba(52,152,219,.35); background: rgba(52,152,219,.10); }
        .btn-icon.details.active { background: rgba(52,152,219,.22); }
        .btn-icon.danger { border-color: rgba(192,57,43,.35); background: rgba(192,57,43,.10); color: #922b21; }

        .estudiante-mini { margin-left: 42px; font-size: .82em; color: #7f8c8d; margin-top: -6px; }
        .estudiante-details { display: grid; gap: 10px; }

        #gridEstudiantes.compact .estudiante-details { display: none; }
        #gridEstudiantes.compact .estudiante-item.open .estudiante-details { display: grid; }

        #gridEstudiantes.hide-empty .estudiante-item.is-empty { display: none; }

        #gridEstudiantes.hide-empty .estudiante-item.force-show { display: flex; outline: 2px dashed rgba(39, 174, 96, .45); }

        .controls { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 20px; align-items: end; }
        .controls label { font-weight: bold; display: block; margin-bottom: 5px; }
        .controls select, .controls input { padding: 10px; border-radius: 6px; border: 1px solid #ccc; width: 100%; }

        .btn-save-lista { background: var(--mep-green); color: white; border: none; padding: 15px; border-radius: 8px; width: 100%; font-weight: bold; cursor: pointer; margin-top: 20px; }
        .btn-delete-day { background: var(--mep-red); }
        .btn-pdf { background: #e67e22; }
        .btn-pdf-mini { background: #e67e22; color:white; border:none; padding:5px 10px; border-radius:4px; cursor:pointer; font-size:0.8em; margin-right: 5px; }
        .btn-reset-mini { background: #c0392b; color:white; border:none; padding:5px 10px; border-radius:4px; cursor:pointer; font-size:0.8em; }
        .btn-reset-mini:hover { background: #922b21; }

        .info-dia { background: #e8f4fd; padding: 12px; border-radius: 8px; margin-bottom: 10px; border-left: 5px solid var(--mep-blue); font-weight: bold; color: #2980b9; }
        .hidden { display: none; }
        .status-save { font-size: 0.8em; color: var(--mep-green); text-align: right; margin-top: 5px; font-weight: bold; opacity: 0; transition: opacity 0.5s; }

        .search-container { margin-bottom: 20px; text-align: center; }
        .search-container input { padding: 10px; width: 300px; border-radius: 6px; border: 1px solid #ccc; }

        .materia-tabs { display: flex; justify-content: center; gap: 10px; margin-bottom: 15px; }
        .periodo-tabs { display: flex; justify-content: center; gap: 20px; margin-bottom: 20px; padding-bottom: 15px; border-bottom: 2px solid #ddd; }

        .btn-materia { padding: 8px 16px; border: 1px solid #ccc; background: #f0f0f0; cursor: pointer; border-radius: 4px; font-weight: bold; color: #555; }
        .btn-materia.active { background: var(--mep-blue); color: white; border-color: var(--mep-blue); }

        .btn-periodo { padding: 10px 30px; border: 2px solid #555; background: white; color: #555; cursor: pointer; border-radius: 20px; font-weight: bold; font-size: 1.1em; transition: 0.3s; }
        .btn-periodo.active { background: #2c3e50; color: white; border-color: #2c3e50; transform: scale(1.05); }

        .tag-aj { color: #d35400; font-weight: bold; background: #fae5d3; padding: 2px 6px; border-radius: 4px; }
        .tag-ai { color: #c0392b; font-weight: bold; background: #fadbd8; padding: 2px 6px; border-radius: 4px; }
        .tag-t { color: #2980b9; font-weight: bold; background: #d6eaf8; padding: 2px 6px; border-radius: 4px; }

        .alerta-box { background-color: #fff3cd; border: 2px solid var(--mep-yellow); color: #856404; padding: 15px; border-radius: 8px; margin-bottom: 20px; display: none; }
        .alerta-titulo { font-weight: bold; font-size: 1.1em; display: flex; align-items: center; gap: 10px; }
        .alerta-item { margin-top: 10px; border-bottom: 1px solid #fae5d3; padding-bottom: 5px; }
        .badge-riesgo { background: var(--mep-orange); color: white; padding: 2px 6px; border-radius: 4px; font-size: 0.8em; }

        .config-prueba { background: #f8f9fa; padding: 15px; border: 1px solid #ddd; border-radius: 8px; margin-bottom: 15px; display: flex; flex-direction:column; gap: 10px; align-items: center; justify-content: center; }
        .config-row { display:flex; gap:20px; align-items:center; }
        .config-prueba input { width: 80px; text-align: center; }
        .input-puntos { width: 60px; text-align: center; }

        .btn-ciclo { background: #34495e; color: white; border: none; padding: 8px 15px; border-radius: 4px; cursor: pointer; font-size: 0.9em; transition:0.2s; }
        .btn-ciclo:hover { background: #2c3e50; transform: scale(1.05); }

        .activar-p2-container { margin: 10px 0; text-align: right; }
        .activar-p2-label { font-weight: bold; color: var(--mep-blue); cursor: pointer; user-select: none; }

        .btn-reset-general { background: #c0392b; color: white; border: none; padding: 15px; border-radius: 8px; width: 100%; font-weight: bold; cursor: pointer; margin-top: 10px; }
        .btn-reset-general:hover { background: #922b21; }

        /* --- NUEVO: Cotidiano con indicadores 1-3 --- */
        .select-coti-ind {
            width: 58px;
            padding: 6px;
            border-radius: 6px;
            border: 1px solid #ccc;
            background: white;
            font-size: 0.9em;
        }

        .coti-chip {
            display:inline-flex;
            align-items:center;
            gap:8px;
            background:#e8f8f5;
            border:1px solid #bfe6dc;
            color:#0e6655;
            padding:6px 10px;
            border-radius:999px;
            font-weight:bold;
            font-size:0.85em;
        }

        .coti-chip button {
            border:none;
            background:#c0392b;
            color:white;
            border-radius:999px;
            width:22px;
            height:22px;
            cursor:pointer;
            font-weight:bold;
            line-height:22px;
        }
    
/* ====== COTIDIANO (INDICADORES) ====== */
.cotidiano-view-tabs{display:flex;justify-content:center;gap:10px;margin:15px 0;flex-wrap:wrap}
.btn-coti-view{padding:10px 18px;border:2px solid var(--mep-teal);background:#fff;color:var(--mep-teal);border-radius:999px;cursor:pointer;font-weight:bold;transition:.2s}
.btn-coti-view.active{background:var(--mep-teal);color:#fff}
.indicator-editor{display:flex;justify-content:center;gap:10px;flex-wrap:wrap;margin:10px 0}
.indicator-editor input{width:min(520px, 92%);padding:10px;border-radius:10px;border:1px solid #ccc}
.indicator-editor button{padding:10px 14px;border-radius:10px;border:none;background:var(--mep-teal);color:#fff;font-weight:bold;cursor:pointer}
.indicator-chips{display:flex;justify-content:center;gap:10px;flex-wrap:wrap;margin:10px 0}
.indicator-chip{display:inline-flex;align-items:center;gap:10px;background:#e8f8f5;border:2px solid #bfece2;color:#0b5345;padding:10px 14px;border-radius:999px;font-weight:bold}
.indicator-chip .chip-x{width:28px;height:28px;border-radius:999px;border:none;background:#c0392b;color:#fff;font-weight:bold;cursor:pointer;line-height:28px}
.cotidiano-panels .hidden{display:none}
.cotidiano-cards{display:grid;grid-template-columns:repeat(auto-fill,minmax(360px,1fr));gap:14px;margin-top:10px}
.cotidiano-card{background:#fff;border:1px solid #e1e1e1;border-radius:14px;box-shadow:0 3px 8px rgba(0,0,0,.06);padding:14px}
.cotidiano-card-header{display:flex;align-items:center;justify-content:space-between;gap:10px;margin-bottom:8px}
.cotidiano-card-title{display:flex;align-items:center;gap:10px;min-width:0}
.cotidiano-card-title .num-lista{background:#ecf9f6;border-radius:8px;padding:6px 10px;font-weight:900}
.cotidiano-st-name{font-weight:900;color:#2c3e50;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.cotidiano-ind-table{width:100%;border-collapse:collapse;margin-top:8px}
.cotidiano-ind-table th,.cotidiano-ind-table td{border:1px solid #000;padding:8px;text-align:left;font-size:.88em}
.cotidiano-ind-table th{text-align:center;background:#ecf0f1}
.cotidiano-ind-table td:last-child{text-align:center}
.cotidiano-ind-table select{width:110px;padding:8px;border-radius:8px;border:1px solid #bbb}
.cotidiano-summary-row td{background:#f7fffd;font-weight:800}
.cotidiano-metric{font-size:1.05em}
.cotidiano-metric.porc{color:var(--mep-teal)}
.coti-empty{background:#fff3cd;border:2px solid var(--mep-yellow);color:#856404;padding:12px;border-radius:10px;text-align:center;margin:10px 0}


/* ====== COTIDIANO: TABLA + MODAL (UI LIMPIA) ====== */
#tablaCotidianoLista td, #tablaCotidianoLista th { font-size: 0.9em; }
.coti-progress-wrap { display:flex; flex-direction:column; gap:6px; }
.progress-bar { background:#eee; border-radius:10px; height:10px; width:100%; overflow:hidden; }
.progress-fill { background: var(--mep-teal); height:100%; border-radius:10px; transition: width 0.25s ease; }
.btn-teal { background: var(--mep-teal); color:white; border:none; padding:8px 12px; border-radius:8px; cursor:pointer; font-weight:bold; font-size:0.9em; }
.btn-teal:hover { filter: brightness(0.95); }
.btn-link-st { border:none; background:transparent; color:#2c3e50; font-weight:900; cursor:pointer; text-align:left; padding:0; }
.btn-link-st:hover { text-decoration: underline; }

.modal-evaluacion {
  position: fixed; inset: 0;
  background: rgba(0,0,0,0.55);
  display: flex; justify-content: center; align-items: center;
  z-index: 1000;
}
.modal-content-eval {
  background: white;
  width: 92%;
  max-width: 780px;
  max-height: 86vh;
  border-radius: 16px;
  overflow: hidden;
  box-shadow: 0 12px 40px rgba(0,0,0,0.25);
  display: flex;
  flex-direction: column;
}
.modal-header {
  display:flex; align-items:center; justify-content:space-between; gap:12px;
  padding: 14px 16px;
  border-bottom: 1px solid #eee;
  background: #f8fbfb;
}
.modal-header h3 { margin:0; text-align:left; font-size: 1.05em; color:#2c3e50; }
.close-btn { font-size: 28px; line-height: 28px; cursor: pointer; color:#555; padding: 0 6px; border-radius: 8px; }
.close-btn:hover { background: rgba(0,0,0,0.06); }

.modal-subtitle { padding: 8px 16px 0 16px; color:#666; }
.indicadores-grid {
  padding: 12px 16px 16px 16px;
  overflow-y: auto;
  display: flex;
  flex-direction: column;
  gap: 10px;
}
.indicador-item {
  border: 1px solid #eee;
  border-radius: 14px;
  padding: 10px 12px;
  display: flex;
  align-items: flex-start;
  justify-content: space-between;
  gap: 12px;
  background: #fff;
}
.indicador-text { margin:0; font-size: 0.95em; color:#2c3e50; flex: 1 1 auto; }
.opciones-eval { display:flex; gap:8px; flex: 0 0 auto; align-items:center; flex-wrap: wrap; justify-content: flex-end; }
.btn-opt {
  border: 1px solid #ccc;
  background: #fafafa;
  padding: 8px 10px;
  border-radius: 10px;
  cursor: pointer;
  font-weight: 800;
  font-size: 0.85em;
  min-width: 92px;
}
.btn-opt:hover { background:#f3f3f3; }

.btn-opt-1.active { background: rgba(231,76,60,0.14); border-color: var(--mep-red); color:#922b21; }
.btn-opt-2.active { background: rgba(241,196,15,0.20); border-color: var(--mep-yellow); color:#7d6608; }
.btn-opt-3.active { background: rgba(39,174,96,0.16); border-color: var(--mep-green); color:#1e8449; }

.modal-footer {
  padding: 10px 16px 16px 16px;
  border-top: 1px solid #eee;
  background: #fff;
}
body.modal-open { overflow: hidden; }

.hidden { display: none !important; }

/* ====== BIT√ÅCORA 2026 ====== */
.bitacora-layout{display:grid;grid-template-columns:1.25fr 0.95fr;gap:16px;align-items:start}
@media (max-width: 980px){.bitacora-layout{grid-template-columns:1fr}}
.bitacora-toolbar{display:flex;justify-content:space-between;align-items:center;gap:10px;flex-wrap:wrap;margin-bottom:10px}
.bitacora-toolbar .left{display:flex;align-items:center;gap:10px;flex-wrap:wrap}
.bitacora-year-chip{display:inline-flex;align-items:center;gap:8px;background:#eef2f3;border:1px solid #dfe6e9;color:#2c3e50;padding:8px 12px;border-radius:999px;font-weight:900}
.btn-bitacora-mini{border:none;background:var(--mep-bitacora);color:#fff;padding:8px 12px;border-radius:10px;cursor:pointer;font-weight:900}
.btn-bitacora-mini:hover{filter:brightness(.95)}
.bitacora-toggle{display:inline-flex;align-items:center;gap:8px;font-weight:800;color:#2c3e50}
.bitacora-year-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(230px,1fr));gap:12px}
.bitacora-month{border:1px solid #e3e3e3;border-radius:14px;padding:10px;background:#fff;box-shadow:0 2px 6px rgba(0,0,0,.04)}
.bitacora-month-title{font-weight:1000;text-align:center;margin:0 0 8px 0;color:var(--mep-bitacora);letter-spacing:.5px}
.bitacora-weekdays{display:grid;grid-template-columns:repeat(7,1fr);gap:4px;font-size:.72em;color:#7f8c8d;text-align:center;font-weight:900}
.bitacora-days{display:grid;grid-template-columns:repeat(7,1fr);gap:4px;margin-top:6px}
.bitacora-day{border:1px solid #eee;background:#fafafa;border-radius:10px;padding:6px 0;cursor:pointer;font-size:.86em;font-weight:800;color:#2c3e50;position:relative}
.bitacora-day:hover{background:#f0f0f0}
.bitacora-day.blank{border:none;background:transparent;cursor:default}
.bitacora-day.today{border-color:var(--mep-blue)}
.bitacora-day.selected{outline:2px solid var(--mep-bitacora);background:rgba(52,73,94,0.10)}
.bitacora-day.has-note::after{content:"‚Ä¢";position:absolute;right:8px;bottom:6px;color:var(--mep-orange);font-size:18px;line-height:12px}
.bitacora-day.outside{opacity:.35}
.bitacora-day:disabled{cursor:not-allowed;opacity:.25}
#bitacoraTexto{width:100%;min-height:220px;padding:12px;border:1px solid #ccc;border-radius:12px;resize:vertical;font-size:.95em;line-height:1.35}
.bitacora-actions{display:flex;gap:10px;flex-wrap:wrap;margin-top:10px}
.bitacora-actions .btn-save-lista{margin-top:0;width:auto;flex:1 1 220px}
.bitacora-list{margin-top:10px;display:flex;flex-direction:column;gap:10px}
.bitacora-entry{border:1px solid #e7e7e7;border-radius:12px;background:#fbfbfb;padding:10px 12px;display:flex;gap:12px;justify-content:space-between;align-items:flex-start}
.bitacora-entry .meta{display:flex;flex-direction:column;gap:4px}
.bitacora-entry .fecha{font-weight:1000;color:#2c3e50}
.bitacora-entry .small{font-size:.82em;color:#7f8c8d}
.bitacora-entry .snippet{font-size:.92em;color:#2c3e50;max-width:560px}
.bitacora-entry .go{border:none;background:var(--mep-bitacora);color:#fff;padding:8px 10px;border-radius:10px;cursor:pointer;font-weight:900;flex:0 0 auto}
.bitacora-entry .go:hover{filter:brightness(.95)}
.bitacora-empty{background:#fff3cd;border:2px solid var(--mep-yellow);color:#856404;padding:12px;border-radius:10px;text-align:center;margin-top:10px}



/* ====== INSTRUMENTO DE COTIDIANO (EMBEBIDO) ====== */
#tabInstrumentoCotidiano.active { background: var(--mep-teal); color: white; }
.instrumento-toolbar{display:flex;justify-content:space-between;align-items:center;gap:10px;flex-wrap:wrap;margin-bottom:10px}
.btn-instrumento{border:none;background:var(--mep-teal);color:#fff;padding:10px 14px;border-radius:10px;cursor:pointer;font-weight:900}
.btn-instrumento:hover{filter:brightness(.95)}
#instrumentoFrame{width:100%;height:85vh;border:none;border-radius:14px;background:#fff}
#tplInstrumentoCotidiano{display:none}

</style>
</head>

<body>
<div class="container">
    <div class="topbar">
        <button class="btn-menu" type="button" onclick="toggleMenu(true)">‚ò∞ Men√∫</button>
        <div id="topMeta" class="topbar-meta">Portada sin configurar</div>
    </div>
    <h1 id="appTitle">Registro Docente - Lic. Juan Carlos S√°nchez</h1>

    <div id="mainTabs" class="nav-tabs" style="display:none;">
        <button id="tabHorario" class="btn-nav active" onclick="showTab('horario')">Horario</button>
        <button id="tabEstudiantes" class="btn-nav" onclick="showTab('estudiantes')">Estudiantes</button>
        <button id="tabMainAsistencia" class="btn-nav" onclick="showTab('mainAsistencia')">Asistencia</button>
        <button id="tabPruebas" class="btn-nav" onclick="showTab('pruebas')">Pruebas</button>
        <button id="tabTareas" class="btn-nav" onclick="showTab('tareas')">Tareas</button>
        <button id="tabCotidiano" class="btn-nav" onclick="showTab('cotidiano')">Trab. Cotidiano</button>
        <button id="tabBitacora" class="btn-nav" onclick="showTab('bitacora')">Bit√°cora</button>
        <button id="tabInstrumentoCotidiano" class="btn-nav" onclick="showTab('instrumentoCotidiano')">Instrumento de cotidiano</button>
    </div>

    <div id="submenuAsistencia" class="submenu-container">
        <p style="margin-top:0; margin-bottom:10px; font-weight:bold; color:#555;">Seleccione una opci√≥n:</p>
        <button class="btn-subnav" onclick="showSubTab('asistencia')">Pasar Lista Diaria</button>
        <button class="btn-subnav" onclick="showSubTab('resumen')">Resumen de Ausencias</button>
    </div>

    
    <!-- ====== PORTADA / CONFIGURACI√ìN PRINCIPAL ====== -->
    <div id="sectionPortada" class="card">
        <h2>Portada / Configuraci√≥n</h2>

        <div class="controls" style="grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));">
            <div>
                <label>Nombre de la Regional:</label>
                <input id="cfgRegional" type="text" placeholder="Ej.: Direcci√≥n Regional de Educaci√≥n..." oninput="portadaOnInput()">
            </div>
            <div>
                <label>Nombre de la Escuela:</label>
                <input id="cfgEscuela" type="text" placeholder="Ej.: Escuela ..." oninput="portadaOnInput()">
            </div>
            <div>
                <label>Circuito Educativo:</label>
                <input id="cfgCircuito" type="text" placeholder="Ej.: Circuito 01" oninput="portadaOnInput()">
            </div>
            <div>
                <label>Grado:</label>
                <input id="cfgGrado" type="text" placeholder="Ej.: 2¬∞ Grado" oninput="portadaOnInput()">
            </div>
            <div style="grid-column: 1 / -1;">
                <label>Nombre del Docente:</label>
                <input id="cfgDocente" type="text" placeholder="Ej.: Juan Carlos S√°nchez" oninput="portadaOnInput()">
                <div class="status-save" id="portadaSaveIndicator" style="opacity:0;">‚úì Guardado autom√°tico</div>
            </div>
        </div>

        <div class="portada-actions">
            <button class="btn-save-lista" style="margin-top:0" type="button" onclick="abrirMenuDesdePortada()">ABRIR MEN√ö</button>
            <button class="btn-reset-general" style="margin-top:0" type="button" onclick="restablecerPortada()">RESTABLECER DATOS</button>
        </div>

        <div class="portada-preview">
            <div style="font-weight:1000; margin-bottom:6px;">Vista previa del encabezado para PDF</div>
            <div id="portadaPreview" style="color:#2c3e50;"></div>
        </div>
    </div>

    <!-- ====== MEN√ö PRINCIPAL (MODAL) ====== -->
    <div id="menuOverlay" class="menu-overlay" onclick="toggleMenu(false)">
        <div class="menu-panel" onclick="event.stopPropagation()">
            <div class="menu-header">
                <div>
                    <div class="menu-title">Men√∫</div>
                    <div id="menuSubtitle" class="menu-subtitle">Seleccione una opci√≥n</div>
                </div>
                <button class="menu-close" type="button" onclick="toggleMenu(false)">√ó</button>
            </div>

            <div class="menu-grid">
                <button class="menu-item primary" type="button" onclick="openFromMenu('portada')">üßæ Portada / Configuraci√≥n</button>
                <button class="menu-item" type="button" onclick="openFromMenu('horario')">üóìÔ∏è Horario</button>
                <button class="menu-item" type="button" onclick="openFromMenu('estudiantes')">üë• Estudiantes</button>
                <button class="menu-item" type="button" onclick="openFromMenu('mainAsistencia')">‚úÖ Asistencia</button>
                <button class="menu-item" type="button" onclick="openFromMenu('pruebas')">üìù Pruebas</button>
                <button class="menu-item" type="button" onclick="openFromMenu('tareas')">üìö Tareas</button>
                <button class="menu-item" type="button" onclick="openFromMenu('cotidiano')">üìí Trab. Cotidiano</button>
                <button class="menu-item" type="button" onclick="openFromMenu('bitacora')">üìò Bit√°cora</button>
                <button class="menu-item" type="button" onclick="openFromMenu('instrumentoCotidiano')">üß∞ Instrumento de cotidiano</button>
            </div>
        </div>
    </div>

    <div id="sectionHorario" class="card hidden">
        <div class="controls">
            <div>
                <label>Jornada:</label>
                <select id="jornadaHorario" onchange="renderizarHorario()">
                    <option value="ma√±ana">Ma√±ana</option>
                    <option value="tarde">Tarde</option>
                </select>
            </div>
            <div id="saveIndicator" class="status-save">‚úì Guardado autom√°tico</div>
        </div>
        <h2 id="tituloHorario" contenteditable="true" oninput="guardarTitulo()">HORARIO DE CLASES: 2¬∞ GRADO</h2>
        <div id="contenedorTablaHorario" oninput="capturarCambiosHorario()"></div>
    </div>

    <div id="sectionEstudiantes" class="card hidden">
        <h2>Lista de Estudiantes (M√°ximo 36)</h2>
        
        <div class="estudiantes-toolbar">
            <label class="chip"><input type="checkbox" id="estCompactToggle" checked onchange="setEstudiantesUI()"> Modo compacto</label>
            <label class="chip"><input type="checkbox" id="estHideEmptyToggle" checked onchange="setEstudiantesUI()"> Ocultar casillas vac√≠as</label>
            <button class="btn-pdf-mini" style="background: var(--mep-green);" onclick="agregarEstudiante()">+ Agregar</button>
            <button class="btn-pdf-mini" style="background: var(--mep-blue);" onclick="expandirTodosEstudiantes()">Expandir todo</button>
            <button class="btn-reset-mini" onclick="contraerTodosEstudiantes()">Contraer todo</button>
            <button class="btn-reset-mini" onclick="limpiarSobrantesEstudiantes()">Borrar sobrantes</button>
        </div>
        <div style="text-align:center; color:#666; font-size:0.9em; margin-top:-6px; margin-bottom:10px;">
            üí° En <b>Modo compacto</b> solo se ve nombre/condici√≥n. Use el bot√≥n <b>‚â°</b> para ver/ocultar los datos (c√©dula, nacimiento, encargado y tel√©fono).
        </div>
        <div class="estudiantes-grid" id="gridEstudiantes"></div>
        <button class="btn-save-lista" onclick="guardarLista()">GUARDAR LISTA</button>
    </div>

    <div id="sectionAsistencia" class="card hidden">
        <h2>Control Diario de Asistencia</h2>

        <div id="panelAlertas" class="alerta-box">
            <div class="alerta-titulo">‚ö†Ô∏è ALERTA TEMPRANA DETECTADA (Ausentismo Intermitente)</div>
            <p style="font-size:0.9em; margin:5px 0;">Estudiantes con <b>3 o m√°s ausencias esta semana</b>. Registrar en SABER.</p>
            <div id="listaAlertas"></div>
        </div>

        <div class="controls">
            <div style="min-width: 150px;">
                <label>Periodo Lectivo:</label>
                <select id="periodoAsistencia" style="border: 2px solid var(--mep-blue); font-weight: bold;">
                    <option value="I">I Periodo (Feb - Jul)</option>
                    <option value="II">II Periodo (Jul - Dic)</option>
                </select>
            </div>

            <div>
                <label>Jornada:</label>
                <select id="jornadaAsistencia" onchange="actualizarAsistencia()">
                    <option value="ma√±ana">Ma√±ana</option>
                    <option value="tarde">Tarde</option>
                </select>
            </div>

            <div>
                <label>Fecha:</label>
                <input type="date" id="fechaAsistencia" onchange="actualizarAsistencia()">
            </div>

            <button class="btn-save-lista" style="margin-top:0" onclick="guardarAsistenciaDelDia()">GUARDAR D√çA</button>
            <button class="btn-save-lista btn-delete-day" style="margin-top:0" onclick="borrarAsistenciaDia()">BORRAR / CORREGIR</button>
            <button class="btn-save-lista btn-pdf" style="margin-top:0" onclick="generarInformePDF()">INFORME PDF</button>
        </div>

        <div id="infoDiaLabel" class="info-dia"></div>

        <table class="asistencia-table">
            <thead><tr id="headerMaterias"></tr></thead>
            <tbody id="listaAsistenciaCuerpo"></tbody>
        </table>
    </div>

    <div id="sectionResumen" class="card hidden">
        <h2>Resumen Detallado por Materia</h2>

        <div class="periodo-tabs">
            <button class="btn-periodo active" onclick="cambiarPeriodoResumen('I', this)">I Periodo</button>
            <button class="btn-periodo" onclick="cambiarPeriodoResumen('II', this)">II Periodo</button>
        </div>

        <div class="materia-tabs">
            <button class="btn-materia active" onclick="filtrarMateria('Espa√±ol')">Espa√±ol</button>
            <button class="btn-materia" onclick="filtrarMateria('Matem√°ticas')">Matem√°ticas</button>
            <button class="btn-materia" onclick="filtrarMateria('Estudios Sociales')">Estudios Sociales</button>
            <button class="btn-materia" onclick="filtrarMateria('Ciencias')">Ciencias</button>
        </div>

        <div class="search-container">
            <input type="text" id="buscadorResumen" placeholder="Buscar estudiante..." onkeyup="filtrarResumen()">
        </div>

        <h3 id="tituloResumenPeriodo" style="text-align:center; color:#555; margin-top:0;">Viendo: I Periodo</h3>

        <table id="tablaResumen">
            <thead>
                <tr>
                    <th style="width: 30%;">Estudiante</th>
                    <th>Ausencias Justificadas</th>
                    <th>Ausencias Injustificadas</th>
                    <th>Tard√≠as / REA</th>
                    <th>% (AI + REA)</th>
                    <th>Asistencia REA (0-10)</th>
                </tr>
            </thead>
            <tbody id="resumenCuerpo"></tbody>
        </table>
    </div>

    <div id="sectionPruebas" class="card hidden">
        <h2>Registro de Calificaciones: Pruebas Escritas</h2>

        <div class="materia-tabs" id="menuMateriaPrueba">
            <button class="btn-subnav btn-materia-prueba active" onclick="selMateriaPrueba('Espa√±ol', this)">Espa√±ol</button>
            <button class="btn-subnav btn-materia-prueba" onclick="selMateriaPrueba('Matem√°ticas', this)">Matem√°ticas</button>
            <button class="btn-subnav btn-materia-prueba" onclick="selMateriaPrueba('Estudios Sociales', this)">Estudios Sociales</button>
            <button class="btn-subnav btn-materia-prueba" onclick="selMateriaPrueba('Ciencias', this)">Ciencias</button>
        </div>

        <div class="periodo-tabs" id="menuPeriodoPrueba">
            <button class="btn-subnav btn-periodo-prueba active" onclick="selPeriodoPrueba('I', this)">I Periodo</button>
            <button class="btn-subnav btn-periodo-prueba" onclick="selPeriodoPrueba('II', this)">II Periodo</button>
        </div>

        <div class="nav-tabs" id="menuNumeroPrueba">
            <button class="btn-nav active" id="btnPrueba1" onclick="selNumeroPrueba(1)">I Prueba</button>
            <button class="btn-nav" id="btnPrueba2" onclick="selNumeroPrueba(2)">II Prueba</button>
        </div>

        <div class="config-prueba">
            <div class="config-row">
                <button class="btn-ciclo" onclick="configurarCiclo(1)">Aplicar I Ciclo (10%)</button>
                <button class="btn-ciclo" onclick="configurarCiclo(2)">Aplicar II Ciclo (15%)</button>
            </div>

            <div class="config-row">
                <label>Valor Porcentual (%):</label>
                <input type="number" id="configValor" value="0" onchange="recalcularTablaPruebas()">
                <label>Puntos Totales:</label>
                <input type="number" id="configPuntos" value="0" onchange="recalcularTablaPruebas()">
            </div>
        </div>

        <div class="activar-p2-container">
            <label class="activar-p2-label">
                <input type="checkbox" id="checkActivarP2" onchange="toggleP2()">
                Habilitar Suma de II Prueba (Activar para sumar al acumulado)
            </label>
        </div>

        <h3 id="tituloTablaPruebas">Espa√±ol - I Periodo - I Prueba</h3>

        <table id="tablaPruebas">
            <thead>
            <tr>
                <th style="width: 5%;">N¬∞</th>
                <th style="width: 30%;">Estudiante</th>
                <th>Puntos Obtenidos</th>
                <th>Nota (1-100)</th>
                <th>Porcentaje Ganado</th>
                <th>Total Acum. (I+II)</th>
                <th>Acciones</th>
            </tr>
            </thead>
            <tbody id="cuerpoTablaPruebas"></tbody>
        </table>

        <br>
        <button class="btn-save-lista" onclick="guardarNotasPrueba()">GUARDAR NOTAS</button>
        <button class="btn-reset-general" onclick="resetearTablaActual()">LIMPIAR TABLA ACTUAL (Esta Prueba)</button>
    </div>

    <div id="sectionTareas" class="card hidden">
        <h2>Registro de Calificaciones: Tareas (10% Total)</h2>

        <div class="materia-tabs" id="menuMateriaTarea">
            <button class="btn-subnav btn-materia-prueba active" onclick="selMateriaTarea('Espa√±ol', this)">Espa√±ol</button>
            <button class="btn-subnav btn-materia-prueba" onclick="selMateriaTarea('Matem√°ticas', this)">Matem√°ticas</button>
            <button class="btn-subnav btn-materia-prueba" onclick="selMateriaTarea('Estudios Sociales', this)">Estudios Sociales</button>
            <button class="btn-subnav btn-materia-prueba" onclick="selMateriaTarea('Ciencias', this)">Ciencias</button>
        </div>

        <div class="periodo-tabs" id="menuPeriodoTarea">
            <button class="btn-subnav btn-periodo-prueba active" onclick="selPeriodoTarea('I', this)">I Periodo</button>
            <button class="btn-subnav btn-periodo-prueba" onclick="selPeriodoTarea('II', this)">II Periodo</button>
        </div>

        <div class="nav-tabs" id="menuNumeroTarea">
            <button class="btn-nav active" id="btnTarea1" onclick="selNumeroTarea(1)">Tarea 1</button>
            <button class="btn-nav" id="btnTarea2" onclick="selNumeroTarea(2)">Tarea 2</button>
        </div>

        <div class="config-prueba">
            <div class="config-row">
                <label>Valor Porcentual (%):</label>
                <input type="number" id="configValorTarea" value="5" onchange="recalcularTablaTareas()">
                <label>Puntos Totales:</label>
                <input type="number" id="configPuntosTarea" value="0" onchange="recalcularTablaTareas()">
            </div>
            <p style="font-size:0.85em; color:#666;">* El reglamento estipula 2 tareas por periodo. Si el total es 10%, cada tarea vale usualmente 5%.</p>
        </div>

        <div class="activar-p2-container">
            <label class="activar-p2-label">
                <input type="checkbox" id="checkActivarT2" onchange="recalcularTablaTareas()">
                Habilitar Suma de Tarea 2
            </label>
        </div>

        <h3 id="tituloTablaTareas">Espa√±ol - I Periodo - Tarea 1</h3>

        <table id="tablaTareas">
            <thead>
            <tr>
                <th style="width: 5%;">N¬∞</th>
                <th style="width: 30%;">Estudiante</th>
                <th>Puntos Obtenidos</th>
                <th>Nota (1-100)</th>
                <th>Porcentaje Ganado</th>
                <th>Total Acum. (T1+T2)</th>
                <th>Acciones</th>
            </tr>
            </thead>
            <tbody id="cuerpoTablaTareas"></tbody>
        </table>

        <br>
        <button class="btn-save-lista" onclick="guardarNotasTarea()">GUARDAR TAREAS</button>
        <button class="btn-reset-general" onclick="resetearTablaActualTarea()">LIMPIAR TABLA ACTUAL (Esta Tarea)</button>
    </div>

    <!-- ‚úÖ COTIDIANO ACTUALIZADO (Indicadores 1-3) -->
    <div id="sectionCotidiano" class="card hidden">
        <h2>Registro de Trabajo Cotidiano (Evaluaci√≥n Sumativa)</h2>

        <div class="materia-tabs" id="menuMateriaCotidiano">
            <button class="btn-subnav btn-materia-prueba active" onclick="selMateriaCotidiano('Espa√±ol', this)">Espa√±ol</button>
            <button class="btn-subnav btn-materia-prueba" onclick="selMateriaCotidiano('Matem√°ticas', this)">Matem√°ticas</button>
            <button class="btn-subnav btn-materia-prueba" onclick="selMateriaCotidiano('Estudios Sociales', this)">Estudios Sociales</button>
            <button class="btn-subnav btn-materia-prueba" onclick="selMateriaCotidiano('Ciencias', this)">Ciencias</button>
        </div>

        <div class="periodo-tabs" id="menuPeriodoCotidiano">
            <button class="btn-subnav btn-periodo-prueba active" onclick="selPeriodoCotidiano('I', this)">I Periodo</button>
            <button class="btn-subnav btn-periodo-prueba" onclick="selPeriodoCotidiano('II', this)">II Periodo</button>
        </div>

        <div class="config-prueba">
            <div class="config-row">
                <button class="btn-ciclo" style="background:var(--mep-teal);" onclick="configurarCicloCotidiano(1)">Aplicar I Ciclo (60%)</button>
                <button class="btn-ciclo" style="background:var(--mep-teal);" onclick="configurarCicloCotidiano(2)">Aplicar II Ciclo (50%)</button>
            </div>

            <div class="config-row">
                <label>Valor Porcentual Total (%):</label>
                <input type="number" id="configValorCotidiano" value="0" readonly style="background:#e8f8f5;">
            </div>

        </div>

        
<h3 id="tituloTablaCotidiano">Espa√±ol - I Periodo - Cotidiano</h3>

<div class="cotidiano-view-tabs">
  <button id="btnCotiViewIndicadores" class="btn-coti-view active" onclick="setVistaCotidiano('indicadores')">Registro por Indicadores</button>
  <button id="btnCotiViewResumen" class="btn-coti-view" onclick="setVistaCotidiano('resumen')">Resumen</button>
</div>

<div class="cotidiano-panels">
  <!-- PANEL 1: REGISTRO POR INDICADORES -->
    <div id="panelCotidianoIndicadores">

    <div style="display:flex;justify-content:space-between;align-items:center;gap:12px;flex-wrap:wrap;margin:6px 0 10px;">
      <div style="font-weight:900;color:#2c3e50;">Listado para Evaluar</div>
      <button class="btn-pdf-mini" style="background:var(--mep-teal)" onclick="toggleConfigIndicadoresCotidiano()">Configurar Indicadores</button>
    </div>

    <div id="cotidianoEmptyHint" class="coti-empty" style="display:none;">
      No hay indicadores todav√≠a. Agregue al menos uno para poder evaluar.
    </div>

    <div style="overflow:auto;">
      <table id="tablaCotidianoLista" class="table-custom">
        <thead>
          <tr>
            <th style="width: 50px;">#</th>
            <th>Estudiante</th>
            <th style="width: 220px;">Progreso</th>
            <th style="width: 120px;">Acci√≥n</th>
          </tr>
        </thead>
        <tbody id="listaCotidiano"></tbody>
      </table>
    </div>

  </div>

  <!-- PANEL 2: RESUMEN (como la segunda imagen) -->
  <div id="panelCotidianoResumen" class="hidden">
    <div style="overflow:auto;">
      <table id="tablaCotidianoResumen">
        <thead>
          <tr>
            <th style="width:5%;">N¬∞</th>
            <th style="width:35%;">Estudiante</th>
            <th>Prom. (1-3)</th>
            <th>Nota (1-100)</th>
            <th>Porcentaje</th>
            <th>Acciones</th>
          </tr>
        </thead>
        <tbody id="cuerpoTablaCotidianoResumen"></tbody>
      </table>
    </div>
  </div>
</div>

<!-- Modal de Evaluaci√≥n (Cotidiano) -->
<div id="modalEvaluacionCoti" class="modal-evaluacion hidden" role="dialog" aria-modal="true">
  <div class="modal-content-eval">
    <div class="modal-header">
      <h3 id="nombreEstudianteEvalCoti">Evaluando Estudiante</h3>
      <span class="close-btn" onclick="cerrarModalEvalCoti()">&times;</span>
    </div>

    <div class="modal-subtitle">
      <small id="subtituloEvalCoti"></small>
    </div>

    <div id="contenedorIndicadoresEvalCoti" class="indicadores-grid"></div>

    <div class="modal-footer">
      <button class="btn-save-lista" style="background:var(--mep-teal); margin-top:0;" onclick="cerrarModalEvalCoti()">Finalizar Evaluaci√≥n</button>
    </div>
  </div>
</div>

<!-- Modal Configurar Indicadores (Cotidiano) -->
<div id="configIndicadoresCotidiano" class="modal-evaluacion hidden" role="dialog" aria-modal="true">
  <div class="modal-content-eval">
    <div class="modal-header">
      <h3>Configurar Indicadores</h3>
      <span class="close-btn" onclick="toggleConfigIndicadoresCotidiano()">&times;</span>
    </div>

    <div style="margin-top:10px;">
      <div class="indicator-editor">
        <input id="inputNuevoIndicador" type="text" placeholder="Escriba un indicador y presione AGREGAR">
        <button type="button" onclick="agregarIndicadorCotidiano()">AGREGAR</button>
      </div>

      <div id="chipsIndicadoresCotidiano" class="indicator-chips"></div>
    </div>

    <div class="modal-footer">
      <button class="btn-save-lista" style="background:var(--mep-teal); margin-top:0;" onclick="toggleConfigIndicadoresCotidiano()">LISTO</button>
    </div>
  </div>
</div>

<br>
<button class="btn-save-lista" style="background:var(--mep-teal);" onclick="guardarNotasCotidiano()">GUARDAR COTIDIANO</button>
<button class="btn-reset-general" onclick="resetearTablaActualCotidiano()">LIMPIAR COTIDIANO (Materia/Periodo)</button>

    </div>

    <div id="sectionBitacora" class="card hidden">
        <h2>Bit√°cora 2026 (Observaciones / Contingencias)</h2>

        <div class="bitacora-toolbar">
            <div class="left">
                <span class="bitacora-year-chip">üìò A√±o: <span id="bitacoraYearLabel">2026</span></span>
                <button class="btn-bitacora-mini" onclick="bitacoraIrAHoy()">Ir a HOY</button>
                <label class="bitacora-toggle">
                    <input type="checkbox" id="bitacoraSoloLectivo" onchange="renderBitacoraYear()">
                    Solo curso lectivo
                </label>
            </div>
            <div class="left">
                <label style="font-weight:900;color:#2c3e50;">Ir al mes:</label>
                <select id="bitacoraMesSelect" onchange="bitacoraIrAlMes()"></select>
            </div>
        </div>

        <div class="bitacora-layout">
            <div>
                <div id="bitacoraYearGrid" class="bitacora-year-grid"></div>
            </div>

            <div>
                <div id="bitacoraFechaSel" class="info-dia">Seleccione un d√≠a del calendario para escribir la bit√°cora.</div>

                <textarea id="bitacoraTexto" placeholder="Escriba aqu√≠ las observaciones o contingencia del d√≠a..."></textarea>

                <div class="bitacora-actions">
                    <button class="btn-save-lista" style="background:var(--mep-bitacora);" onclick="guardarBitacora()">GUARDAR</button>
                    <button class="btn-save-lista btn-delete-day" style="margin-top:0;" onclick="borrarBitacora()">BORRAR ENTRADA</button>
                    <button class="btn-save-lista btn-pdf" style="margin-top:0;" onclick="generarPDFBitacora()">PDF (MES)</button>
                </div>

                <div class="search-container" style="margin-top:10px;">
                    <input type="text" id="bitacoraBuscar" placeholder="Buscar en bit√°cora..." onkeyup="renderBitacoraLista()">
                </div>

                <div id="bitacoraLista" class="bitacora-list"></div>
                <div id="bitacoraEmpty" class="bitacora-empty" style="display:none;">No hay entradas guardadas todav√≠a.</div>
            </div>
        </div>
    </div>

    <div id="sectionInstrumentoCotidiano" class="card hidden">
        <h2>Instrumento de Trabajo Cotidiano</h2>

        <div class="instrumento-toolbar">
            <div style="font-weight:800;color:#555;">Incluido en este archivo (con activaci√≥n / clave)</div>
            <div style="display:flex;gap:10px;flex-wrap:wrap;">
                <button class="btn-instrumento" onclick="recargarInstrumentoCotidiano()">Recargar</button>
                <button class="btn-instrumento" onclick="abrirInstrumentoPantallaCompleta()">Pantalla completa</button>
            </div>
        </div>

        <iframe id="instrumentoFrame" title="Instrumento de cotidiano"></iframe>

        <template id="tplInstrumentoCotidiano">
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gesti√≥n Escolar - MEP (V16 - Estable)</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mammoth/1.4.2/mammoth.browser.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    
    <style>
        body { font-family: 'Segoe UI', sans-serif; padding: 20px; background-color: #f4f6f9; color: #333; }
        header { text-align: center; margin-bottom: 20px; background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        
        .btn { padding: 10px 20px; border: none; cursor: pointer; color: white; margin: 5px; border-radius: 5px; font-weight: bold; }
        .btn:hover { opacity: 0.9; }
        .btn:disabled { background-color: #ccc; cursor: not-allowed; }
        .blue { background-color: #0056b3; }
        .green { background-color: #28a745; }
        .orange { background-color: #fd7e14; }
        .purple { background-color: #6f42c1; }
        .gray { background-color: #6c757d; }
        
        .section { background: white; margin-bottom: 20px; border: 1px solid #ddd; padding: 25px; border-radius: 10px; display: none; }
        
        #imported-list { max-height: 300px; overflow-y: auto; border: 1px solid #eee; padding: 10px; background: #fff; }
        .import-item { display: flex; align-items: flex-start; padding: 8px; border-bottom: 1px solid #f0f0f0; }
        .import-item label { cursor: pointer; width: 100%; margin-left: 8px; }
        
        #pdf-tools { background: #e9ecef; padding: 15px; border-radius: 8px; margin-top: 15px; }
        #pdf-viewer-container { 
            position: relative; overflow: auto; max-height: 600px; border: 2px dashed #999; 
            margin-top: 10px; text-align: center; display: flex; justify-content: center; background: #555;
        }
        #pdf-canvas-wrapper { position: relative; display: inline-block; cursor: crosshair; box-shadow: 0 0 10px rgba(0,0,0,0.5); }
        #crop-box {
            position: absolute; border: 2px solid #dc3545; background-color: rgba(220, 53, 69, 0.2);
            display: none; pointer-events: none; z-index: 100;
        }

        .activity-card { 
            border: 1px solid #ddd; padding: 10px; margin: 5px; border-radius: 5px; 
            background: #fff; width: 160px; text-align: center; position: relative; display: inline-block; vertical-align: top;
        }
        .activity-card img { max-width: 100%; height: 100px; object-fit: contain; border: 1px solid #eee; }
        .del-btn { position: absolute; top: 2px; right: 2px; background: #dc3545; color: white; border: none; border-radius: 50%; width: 20px; height: 20px; cursor: pointer; font-size: 12px; }

        input[type="text"], select { padding: 8px; margin: 5px 0; border: 1px solid #ccc; border-radius: 4px; width: 100%; box-sizing: border-box; }
        .header-inputs { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px; }
    </style>
</head>
<body>

<div id="license-overlay" style="position:fixed; top:0; left:0; width:100%; height:100%; background:#2c3e50; z-index:99999; color:white; display:flex; flex-direction:column; align-items:center; justify-content:center; text-align:center;">
    <h2 style="color:#f1c40f;">‚ö†Ô∏è ACTIVACI√ìN REQUERIDA</h2>
    <p>Esta copia de "Evaluador MEP" no est√° activa en este equipo.</p>

    <div style="background:rgba(0,0,0,0.3); padding:20px; border-radius:10px; width:400px;">
        <label>üÜî ID DE ESTA COMPUTADORA:</label>
        <input type="text" id="device-id-display" readonly style="text-align:center; font-weight:bold; font-size:1.2em; color:#333; background:#e9ecef; border:none; margin:10px 0;">
        <p style="font-size:0.8em; color:#bdc3c7;">Env√≠e este ID al administrador para recibir su clave.</p>

        <label>üîë INGRESE SU CLAVE:</label>
        <input type="text" id="activation-key-input" placeholder="Pegar clave aqu√≠..." style="text-align:center; font-size:1.2em; margin:10px 0;">

        <button class="btn green" onclick="verifyLicense()" style="width:100%; font-size:1.2em; margin-top:10px;">üîì ACTIVAR SISTEMA</button>
        <p id="license-msg" style="margin-top:10px; font-weight:bold;"></p>
    </div>
</div>

<script>
    // --- CONFIGURACI√ìN DEL ADMINISTRADOR ---
    // ¬°CAMBIA ESTO POR UNA PALABRA SECRETA TUYA!
    const ADMIN_SECRET_SALT = "MEP_2024_SECRETO_MAESTRO"; 

    // 1. Generar o recuperar ID del dispositivo
    let deviceID = localStorage.getItem('mep_device_id');
    if (!deviceID) {
        // Crear un ID aleatorio √∫nico para este navegador
        deviceID = 'PC-' + Math.random().toString(36).substr(2, 9).toUpperCase();
        localStorage.setItem('mep_device_id', deviceID);
    }
    document.getElementById('device-id-display').value = deviceID;

    // 2. Verificar si ya est√° activado
    if (localStorage.getItem('mep_license_active') === 'true') {
        document.getElementById('license-overlay').style.display = 'none';
    }

    // 3. Funci√≥n de validaci√≥n (Algoritmo simple)
    function verifyLicense() {
        let inputKey = document.getElementById('activation-key-input').value.trim();
        let expectedKey = generateKey(deviceID); // Generar la clave que deber√≠a ser

        if (inputKey === expectedKey) {
            localStorage.setItem('mep_license_active', 'true');
            document.getElementById('license-msg').style.color = '#2ecc71';
            document.getElementById('license-msg').innerText = "¬°Activado correctamente!";
            setTimeout(() => {
                document.getElementById('license-overlay').style.display = 'none';
            }, 1000);
        } else {
            document.getElementById('license-msg').style.color = '#e74c3c';
            document.getElementById('license-msg').innerText = "Clave incorrecta. Verifique el ID.";
        }
    }

    // 4. El algoritmo "Secreto" (Debe coincidir con tu generador)
    function generateKey(id) {
        // Combina el ID + Tu Secreto
        let raw = id + ADMIN_SECRET_SALT;
        // Simulaci√≥n de Hash simple:
        let hash = 0;
        for (let i = 0; i < raw.length; i++) {
            let char = raw.charCodeAt(i);
            hash = ((hash << 5) - hash) + char;
            hash = hash & hash; // Convertir a 32bit integer
        }
        // Convertir a positivo y tomar los √∫ltimos 8 d√≠gitos
        return Math.abs(hash).toString(16).toUpperCase().substring(0, 8);
    }
</script>



<header>
    <h1 style="color:#003366;">Evaluaci√≥n del Trabajo Cotidiano (MEP)</h1>
    <nav>
        <button class="btn blue" onclick="goToSection('asignaturas')">1. Asignaturas</button>
        <button class="btn blue" onclick="goToSection('importar')">2. Importar / Recortar</button>
        <button class="btn blue" onclick="goToSection('registro-cotidiano')">3. Generar Instrumento</button>
    </nav>
    <div style="text-align:right; margin-bottom:10px;">
        <button class="btn gray" onclick="exportData()">‚¨áÔ∏è Respaldar Datos</button>
        <button class="btn gray" onclick="document.getElementById('file-import').click()">‚¨ÜÔ∏è Restaurar</button>
        <input type="file" id="file-import" style="display:none" onchange="importData(this)" accept=".json">
    </div>

</header>

<main>
    <section id="asignaturas" class="section">
        <h2>1. Seleccione la Asignatura</h2>
        <div style="display: flex; gap: 10px; flex-wrap: wrap;">
            <button class="btn blue" onclick="selectSubject('Espa√±ol')">Espa√±ol</button>
            <button class="btn blue" onclick="selectSubject('Matem√°ticas')">Matem√°ticas</button>
            <button class="btn blue" onclick="selectSubject('Ciencias')">Ciencias</button>
            <button class="btn blue" onclick="selectSubject('Estudios Sociales')">Estudios Sociales</button>
        </div>
        <h3 id="subject-display" style="color: #0056b3; margin-top: 20px;">Ninguna seleccionada</h3>
    </section>

    <section id="importar" class="section">
        <div style="background:#e9ecef; padding:10px; border-radius:5px; margin-bottom:15px;">
            <strong>Mes de Trabajo:</strong>
            <select id="import-month" onchange="loadStoredData()" style="width: auto;">
                <option>Enero</option><option>Febrero</option><option>Marzo</option><option>Abril</option>
                <option>Mayo</option><option>Junio</option><option>Julio</option><option>Agosto</option>
                <option>Setiembre</option><option>Octubre</option><option>Noviembre</option><option>Diciembre</option>
            </select>
        </div>

        <h3>2.1 Indicadores (Word - Columna 3)</h3>
        <p>Suba el planeamiento. El sistema extraer√° √∫nicamente el texto de la <b>3ra columna</b>.</p>
        <input type="file" id="upload-planning" accept=".docx" onchange="processWord(this)">
        <div id="word-results" style="display:none; margin-top:10px;">
            <div id="imported-list"></div>
            <button class="btn green" onclick="saveIndicators()" style="margin-top:10px;">Guardar Indicadores Seleccionados</button>
        </div>

        <hr>

        <h3>2.2 Recortar Libro (PDF)</h3>
        <p>Suba el PDF, dibuje un cuadro rojo sobre la imagen y guarde.</p>
        <input type="file" id="upload-pdf" accept=".pdf" onchange="processPdf(this)">
        
        <div id="pdf-tools" style="display:none;">
            <div style="display:flex; justify-content:space-between; margin-bottom:10px;">
                <button class="btn blue" onclick="prevPage()">‚óÄ Anterior</button>
                <span id="page-num" style="font-weight:bold; align-self:center;">P√°g 1</span>
                <button class="btn blue" onclick="nextPage()">Siguiente ‚ñ∂</button>
            </div>
            <div style="text-align:center; margin-bottom:5px; font-size:0.9em; color:#555;">
                üñ±Ô∏è Arrastre el mouse sobre la imagen para seleccionar
            </div>
            <div id="pdf-viewer-container">
                <div id="pdf-canvas-wrapper" onmousedown="startCrop(event)" onmousemove="moveCrop(event)" onmouseup="endCrop(event)">
                    <canvas id="the-canvas"></canvas>
                    <div id="crop-box"></div>
                </div>
            </div>
            <br>
            <button id="btn-save-crop" class="btn purple" onclick="saveCropImage()" disabled>‚úÇÔ∏è Guardar Recorte</button>
        </div>

        <div id="saved-items-container" style="margin-top:20px;"></div>
    </section>

    <section id="registro-cotidiano" class="section">
        <h2>3. Generar Instrumento (Formato Estable)</h2>
        
        <div class="header-inputs">
<div>
                <label>Centro Educativo:</label>
                <input type="text" id="school" placeholder="Ej: Esc. Ricardo Moreno Ca√±as">
            </div>
            <div>
                <label>Nombre del Docente:</label>
                <input type="text" id="teacher" placeholder="Nombre del docente">
            </div>
            <div>
                <label>Asignatura:</label>
                <input type="text" id="subject-field" readonly style="background:#eee;">
            </div>
        </div>
        
        <div style="display:grid; grid-template-columns: 1fr 1fr 1fr; gap:10px; margin-bottom:15px;">
            <div>
                <label>Nivel / Secci√≥n:</label>
                <input type="text" id="grade" placeholder="Ej: 4-2">
            </div>
            <div>
                <label>Estudiante:</label>
                <input type="text" id="student" placeholder="Nombre del estudiante">
            </div>
             <div>
                <label>Mes:</label>
                <select id="gen-month" onchange="updateGenLists()">
                    <option>Enero</option><option>Febrero</option><option>Marzo</option><option>Abril</option>
                    <option>Mayo</option><option>Junio</option><option>Julio</option><option>Agosto</option>
                    <option>Setiembre</option><option>Octubre</option><option>Noviembre</option><option>Diciembre</option>
                </select>
            </div>
        </div>

        
        <div style="background:#222; color:white; padding:15px; border-radius:5px; margin-bottom:15px;">
            <label><strong>üß† Inteligencia Artificial (Gemini - Opcional):</strong></label>

            <div style="display:flex; flex-direction:column; gap:10px; margin-top:8px;">
                <div style="display:flex; gap:10px; flex-wrap:wrap;">
                    <input type="password" id="gemini-key" placeholder="API Key Gemini (AIza...)" style="flex:1; min-width:260px;">
                    <select id="gemini-model" style="min-width:210px;">
                        <option value="gemini-2.0-flash" selected>Gemini: gemini-2.0-flash</option>
                        <option value="gemini-1.5-flash">Gemini: gemini-1.5-flash</option>
                        <option value="gemini-1.5-pro">Gemini: gemini-1.5-pro (Versi√≥n Potente)</option>
                    </select>
                    <button id="btn-ai-gemini" class="btn purple" onclick="consultarIA_Gemini()">Probar Gemini</button>
                    <button class="btn gray" onclick="limpiarIA()">Limpiar IA</button>
                </div>

                <small id="ai-status" style="color:#9be7ff;">IA: no usada</small>
                 <label style="font-size:12px; color:#ccc; display:flex; align-items:center; gap:6px; margin-top:4px;">
                     <input type="checkbox" id="gemini-use-image" style="width:auto;"> Usar recorte del libro seleccionado como contexto para la actividad
                 </label>

                <div id="ai-preview-wrap" style="display:none;">
                    <div id="ai-preview-gemini" style="background:#111; border:1px solid #333; padding:10px; border-radius:6px;">
                        <div style="font-size:12px; color:#9be7ff;"><strong>Gemini</strong></div>
                        <div style="font-size:12px; color:#ddd; margin-top:6px;"><strong>Inicial:</strong> <span id="prev-gemini-inicial"></span></div>
                        <div style="font-size:12px; color:#ddd; margin-top:6px;"><strong>Intermedio:</strong> <span id="prev-gemini-intermedio"></span></div>
                        <div style="font-size:12px; color:#ddd; margin-top:6px;"><strong>Avanzado:</strong> <span id="prev-gemini-avanzado"></span></div>
                        <div style="font-size:12px; color:#ddd; margin-top:10px; border-top:1px solid #333; padding-top:10px;">
                            <strong>Actividad sugerida por IA:</strong>
                            <div id="prev-gemini-actividad" style="color:#afffba; font-style:italic; margin-top:4px;"></div>
                            <button class="btn green" style="font-size:10px; padding:2px 5px; margin-top:5px;" onclick="usarActividadIA()">Copiar a Indicaciones</button>
                        </div>
                    </div>
                    <small style="color:#ccc; display:block; margin-top:6px;">Si la IA falla, el sistema usar√° el m√©todo autom√°tico (por verbos).</small>
                </div>
            </div>
        </div>

<div style="background:#f1f3f5; padding:15px; border-radius:5px; margin-bottom:15px;">
            <label><strong>Seleccione el Indicador:</strong></label>
            <select id="gen-indicator" style="font-size:1.1em;"></select>
        </div>
        
        <div style="background:#fff3cd; padding:15px; border:1px solid #ffeeba; border-radius:5px;">
            <label><strong>Actividad del Libro (Recorte):</strong></label>
            <select id="gen-activity" onchange="previewGenActivity()"></select>
            <div id="gen-preview" style="text-align:center; margin-top:10px; min-height:100px; border:1px solid #ccc; background:white; padding:10px;">
                <span style="color:#999">Vista previa...</span>
                <img id="preview-img-tag" style="max-width:100%; max-height:150px; display:none;">
            </div>
            <label style="margin-top:10px; display:block; margin:0; padding:0;">
                <input type="checkbox" id="include-act" checked style="width:auto;"> Incluir imagen
            </label>
            <div style="margin-top:12px;">
                <label><strong>Indicaciones (opcional):</strong></label>
                <textarea id="activity-instructions" rows="4" placeholder="Escriba aqu√≠ las indicaciones para el estudiante..." style="width:100%; padding:10px; border:1px solid #ccc; border-radius:5px; resize:vertical;"></textarea>
            </div>
        </div>
        
        <center style="margin-top:30px;">
            <button class="btn orange" onclick="generateHeaderWord()" style="font-size:1.2em; padding:15px 30px;">üìÑ Descargar Word</button>
        </center>
    </section>
</main>

<script>
// --- LOGICA GLOBAL ---
let db = JSON.parse(localStorage.getItem('mepDataV16')) || { indicators:{}, activities:{} };
let curSubject = null;
let importedLines = [];
// --- RESPALDO / RESTAURACI√ìN (JSON) ---
function exportData() {
    // Recopila todas las bases de datos del localStorage
    let fullBackup = {
        mepDataV16: localStorage.getItem('mepDataV16'),
        mepAdminData: localStorage.getItem('mepAdminData'),
        mepStudentLists: localStorage.getItem('mepStudentLists')
    };
    let blob = new Blob([JSON.stringify(fullBackup)], {type: "application/json"});
    saveAs(blob, "Respaldo_Evaluador_MEP.json");
}

function importData(input) {
    let file = input.files[0];
    if(!file) return;
    let reader = new FileReader();
    reader.onload = function(e) {
        try {
            let data = JSON.parse(e.target.result);
            if(data.mepDataV16) localStorage.setItem('mepDataV16', data.mepDataV16);
            if(data.mepAdminData) localStorage.setItem('mepAdminData', data.mepAdminData);
            if(data.mepStudentLists) localStorage.setItem('mepStudentLists', data.mepStudentLists);
            alert("Datos restaurados con √©xito. La p√°gina se recargar√°.");
            location.reload();
        } catch(err) {
            alert("Error al leer el archivo de respaldo.");
        }
    };
    reader.readAsText(file);
}


// --- IA (Opcional): R√∫brica generada con API (si existe) ---
let rubricaIA = null;         // R√∫brica ACTIVA { indicador, inicial, intermedio, avanzado }
let rubricaIA_gemini = null;  // √öltima r√∫brica (Gemini)
let rubricaIAProvider = null; // "openai" | "gemini" | null

function setAIStatus(txt) {
    const el = document.getElementById('ai-status');
    if(el) el.textContent = txt;
}

function clearRubricaIA() {
    rubricaIA = null;
    rubricaIA_gemini = null;
    rubricaIAProvider = null;
    setAIStatus("IA: no usada");

    const act = document.getElementById('prev-gemini-actividad');
    if (act) act.textContent = "";

    const wrap = document.getElementById('ai-preview-wrap');
    if (wrap) wrap.style.display = "none";
}


// Variables PDF
let pdfDoc = null, pageNum = 1, pdfScale = 1.5;
let canvas, ctx, cropBox;
let isCropping = false, startX, startY;

// LOGO MEP (Base64 CORREGIDO - Versi√≥n segura y corta)
const mepLogo = "data:image/png;base64,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";

// Banner izquierdo MEP + Gobierno (recortado de la cabecera oficial)
const mepLeftBanner = "data:image/png;base64,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";

function saveDB() { localStorage.setItem('mepDataV16', JSON.stringify(db)); }

// --- NAVEGACION ---
function goToSection(id) {
    document.querySelectorAll('.section').forEach(s => s.style.display = 'none');
    document.getElementById(id).style.display = 'block';
    if(id === 'registro-cotidiano') updateGenLists();
}

function selectSubject(sub) {
    curSubject = sub;
    document.getElementById('subject-display').textContent = "Seleccionado: " + sub;
    document.getElementById('subject-field').value = sub;
    goToSection('importar');
    loadStoredData();
}

function getImportMonth() { return document.getElementById('import-month').value; }

// --- 1. WORD - COLUMNA 3 ---
function processWord(input) {
    if(!curSubject) return alert("Seleccione asignatura primero");
    if(!input.files[0]) return;
    
    let reader = new FileReader();
    reader.onload = function(e) {
        mammoth.convertToHtml({arrayBuffer: e.target.result})
            .then(result => {
                let div = document.createElement('div');
                div.innerHTML = result.value;
                importedLines = [];
                let rows = div.querySelectorAll('tr');
                if (rows.length > 0) {
                    rows.forEach(row => {
                        let cells = row.querySelectorAll('td, th');
                        if (cells.length >= 3) {
                            let targetCell = cells[2];
                            let lis = targetCell.querySelectorAll('li');
                            if (lis.length > 0) {
                                lis.forEach(li => importedLines.push(li.innerText.trim()));
                            } else {
                                let text = targetCell.innerText.trim();
                                if(text) importedLines.push(text);
                            }
                        }
                    });
                } else {
                    alert("No se detectaron tablas. Se mostrar√° todo el texto.");
                    div.querySelectorAll('p').forEach(el => importedLines.push(el.innerText));
                }
                importedLines = importedLines.filter(x => x.length > 5 && !x.toLowerCase().includes("indicador"));
                importedLines = [...new Set(importedLines)];
                let html = "";
                importedLines.forEach((txt, idx) => {
                    html += `<div class="import-item"><input type="checkbox" id="ind-${idx}" checked> <label for="ind-${idx}">${txt}</label></div>`;
                });
                document.getElementById('imported-list').innerHTML = html || "<span style='color:red'>No se encontraron datos en la Columna 3.</span>";
                document.getElementById('word-results').style.display = 'block';
            })
            .catch(err => alert("Error leyendo Word: " + err));
    };
    reader.readAsArrayBuffer(input.files[0]);
}

function saveIndicators() {
    let month = getImportMonth();
    if(!db.indicators[curSubject]) db.indicators[curSubject] = {};
    if(!db.indicators[curSubject][month]) db.indicators[curSubject][month] = [];
    let count = 0;
    importedLines.forEach((txt, idx) => {
        let chk = document.getElementById(`ind-${idx}`);
        if(chk && chk.checked) {
            db.indicators[curSubject][month].push(txt);
            count++;
        }
    });
    saveDB();
    alert(`Guardados ${count} indicadores.`);
    loadStoredData(); 
}

// --- 2. PDF & RECORTE ---
function processPdf(input) {
    if(!input.files[0]) return;
    let reader = new FileReader();
    reader.onload = function(e) {
        let typedarray = new Uint8Array(e.target.result);
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
        pdfjsLib.getDocument(typedarray).promise.then(pdf => {
            pdfDoc = pdf;
            pageNum = 1;
            document.getElementById('pdf-tools').style.display = 'block';
            renderPage();
        });
    };
    reader.readAsArrayBuffer(input.files[0]);
}

function renderPage() {
    pdfDoc.getPage(pageNum).then(page => {
        let viewport = page.getViewport({scale: pdfScale});
        canvas = document.getElementById('the-canvas');
        ctx = canvas.getContext('2d');
        canvas.height = viewport.height;
        canvas.width = viewport.width;
        page.render({canvasContext: ctx, viewport: viewport});
        document.getElementById('page-num').textContent = `P√°g ${pageNum}`;
        cropBox = document.getElementById('crop-box');
        cropBox.style.display = 'none';
        document.getElementById('btn-save-crop').disabled = true;
    });
}

function prevPage() { if(pageNum <= 1) return; pageNum--; renderPage(); }
function nextPage() { if(pageNum >= pdfDoc.numPages) return; pageNum++; renderPage(); }

function startCrop(e) {
    isCropping = true;
    let rect = canvas.getBoundingClientRect();
    startX = e.clientX - rect.left;
    startY = e.clientY - rect.top;
    cropBox.style.left = startX + 'px';
    cropBox.style.top = startY + 'px';
    cropBox.style.width = '0px'; cropBox.style.height = '0px';
    cropBox.style.display = 'block';
}

function moveCrop(e) {
    if(!isCropping) return;
    let rect = canvas.getBoundingClientRect();
    let curX = e.clientX - rect.left;
    let curY = e.clientY - rect.top;
    let w = curX - startX;
    let h = curY - startY;
    cropBox.style.width = Math.abs(w) + 'px';
    cropBox.style.height = Math.abs(h) + 'px';
    if(w < 0) cropBox.style.left = curX + 'px';
    if(h < 0) cropBox.style.top = curY + 'px';
}

function endCrop(e) {
    isCropping = false;
    if(parseInt(cropBox.style.width) > 10) document.getElementById('btn-save-crop').disabled = false;
}

function saveCropImage() {
    if(!curSubject) return alert("Seleccione Asignatura");
    let rect = canvas.getBoundingClientRect();
    let scaleX = canvas.width / rect.width;
    let scaleY = canvas.height / rect.height;
    let x = parseInt(cropBox.style.left) * scaleX;
    let y = parseInt(cropBox.style.top) * scaleY;
    let w = parseInt(cropBox.style.width) * scaleX;
    let h = parseInt(cropBox.style.height) * scaleY;
    let tempC = document.createElement('canvas');
    tempC.width = w; tempC.height = h;
    let tCtx = tempC.getContext('2d');
    tCtx.drawImage(canvas, x, y, w, h, 0, 0, w, h);
    let imgData = tempC.toDataURL('image/jpeg', 0.7);
    let month = getImportMonth();
    if(!db.activities[curSubject]) db.activities[curSubject] = {};
    if(!db.activities[curSubject][month]) db.activities[curSubject][month] = [];
    db.activities[curSubject][month].push({ src: imgData, id: Date.now() });
    saveDB();
    alert("Recorte guardado");
    cropBox.style.display = 'none';
    document.getElementById('btn-save-crop').disabled = true;
    loadStoredData();
}

function loadStoredData() {
    if(!curSubject) return;
    let month = getImportMonth();
    let div = document.getElementById('saved-items-container');
    div.innerHTML = `<h4>Guardado en ${month}:</h4>`;
    let acts = (db.activities[curSubject] && db.activities[curSubject][month]) || [];
    acts.forEach((a, idx) => {
        div.innerHTML += `
            <div class="activity-card">
                <button class="del-btn" onclick="delActivity(${idx})">x</button>
                <img src="${a.src}"><br><small>Recorte ${idx+1}</small>
            </div>`;
    });
}

function delActivity(idx) {
    let month = getImportMonth();
    db.activities[curSubject][month].splice(idx, 1);
    saveDB();
    loadStoredData();
}

// --- 3. GENERADOR ---
function updateGenLists() {
    if(!curSubject) return;
    let month = document.getElementById('gen-month').value;
    let selInd = document.getElementById('gen-indicator');
    selInd.innerHTML = "";
    let inds = (db.indicators[curSubject] && db.indicators[curSubject][month]) || [];
    inds.forEach(t => {
        let opt = document.createElement('option');
        opt.value = t; opt.text = t.substring(0,120)+"...";
        selInd.appendChild(opt);
    });
    
    let selAct = document.getElementById('gen-activity');
    selAct.innerHTML = "<option value=''>Ninguna</option>";
    let acts = (db.activities[curSubject] && db.activities[curSubject][month]) || [];
    acts.forEach((a, idx) => {
        let opt = document.createElement('option');
        opt.value = idx; opt.text = "Recorte " + (idx+1);
        selAct.appendChild(opt);
    });
    previewGenActivity();
    // IA: al cambiar mes o indicador, reiniciar r√∫brica IA
    clearRubricaIA();
    selInd.onchange = () => clearRubricaIA();
}

function previewGenActivity() {
    let idx = document.getElementById('gen-activity').value;
    let img = document.getElementById('preview-img-tag');
    if(idx === "") {
        img.style.display = 'none';
    } else {
        let month = document.getElementById('gen-month').value;
        let acts = db.activities[curSubject][month];
        if(acts && acts[idx]) {
            img.src = acts[idx].src;
            img.style.display = 'inline-block';
        }
    }
}

// --- FUNCI√ìN DE INTELIGENCIA PARA R√öBRICAS MEP ---
function calcularNiveles(textoIndicador) {
    // 1) Limpieza inicial
    let texto = (textoIndicador || "").toString().trim();
    if (!texto) return { inicial: "", intermedio: "", avanzado: "" };

    // Quitar vi√±etas / numeraci√≥n inicial
    texto = texto.replace(/^[\s‚Ä¢\-‚Äì‚Äî\d.()]+/, "").trim();

    // Quitar punto final (y similares) si existe
    texto = texto.replace(/[.„ÄÇ]+$/, "").trim();

    // 2) Separar el verbo del resto del contenido
    let partes = texto.split(/\s+/);
    if (partes.length === 0) return { inicial: "", intermedio: "", avanzado: "" };

    let verboOriginal = partes[0];
    let resto = partes.slice(1).join(" ").trim();

    // Normalizar verbo: min√∫sculas, sin signos, sin tildes (para comparar)
    let verboKey = (verboOriginal || "")
        .toLowerCase()
        .replace(/^[¬ø¬°("']+|[.,;:!?")']+$/g, "");

    try {
        verboKey = verboKey.normalize('NFD').replace(/[\u0300-\u036f]/g, '');
    } catch (e) {
        // Navegadores viejos: si no soporta normalize(), seguimos sin quitar tildes
    }

    // 3) Diccionario (taxonom√≠a simplificada)
    const verbosAplicacion = [
        'emplea','aplica','utiliza','usa','construye','elabora','redacta','disena','dise√±a',
        'ejecuta','resuelve','calcula','formula','plantea','propone','crea','produce'
    ];
    const verbosAnalisis = [
        'analiza','distingue','compara','caracteriza','explica','justifica','determina',
        'discrimina','relaciona','evalua','eval√∫a','valora','argumenta','interpreta'
    ];
    const verbosIdentificacion = [
        'identifica','reconoce','cita','enumera','describe','define','nombra','senala','se√±ala',
        'menciona','ubica','localiza'
    ];

    const inGroup = (arr) => arr.some(v => verboKey.startsWith(v));

    let verboInicial = "Menciona elementos de";
    let verboIntermedio = "Describe generalidades de";
    let sufInicial = " de forma aislada.";
    let sufIntermedio = " con imprecisiones.";

    if (inGroup(verbosAplicacion)) {
        verboInicial = "Cita aspectos b√°sicos de";
        verboIntermedio = "Realiza";
        sufInicial = " de forma aislada.";
        sufIntermedio = " con algunas imprecisiones.";
    } else if (inGroup(verbosAnalisis)) {
        verboInicial = "Menciona ideas generales sobre";
        verboIntermedio = "Destaca aspectos parciales de";
        sufInicial = " de forma general.";
        sufIntermedio = " con imprecisiones.";
    } else if (inGroup(verbosIdentificacion)) {
        verboInicial = "Indica puntualmente";
        verboIntermedio = "Identifica parcialmente";
        sufInicial = " de forma aislada.";
        sufIntermedio = " con imprecisiones.";
    }

    // 4) Unir verbo + resto con peque√±os ajustes gramaticales
    const joinPhrase = (verbo, obj) => {
        let v = (verbo || "").toString().trim();
        let o = (obj || "").toString().trim();
        if (!v) return o;
        if (!o) return v;

        // Evitar "de de ..." si el verbo ya termina en "de" y el resto inicia con "de"
        if (v.toLowerCase().endsWith(" de") && o.toLowerCase().startsWith("de ")) {
            o = o.replace(/^de\s+/i, "");
        }
        return v + " " + o;
    };

    const inicial = joinPhrase(verboInicial, resto) + (resto ? sufInicial : "");
    const intermedio = joinPhrase(verboIntermedio, resto) + (resto ? sufIntermedio : "");

    // Nivel Avanzado: indicador original
    const avanzado = texto.endsWith(".") ? texto : (texto + ".");

    return { inicial, intermedio, avanzado };
}


// --- IA: CONSULTA A OPENAI (Opcional) ---
function _extractOutputTextFromResponsesAPI(data) {
    // Responses API devuelve un array "output" con mensajes; buscamos el primer output_text del assistant
    if (!data) return null;
    if (typeof data.output_text === "string" && data.output_text.trim()) return data.output_text;
    const out = data.output || [];
    for (const item of out) {
        if (item && item.type === "message" && item.role === "assistant") {
            const content = item.content || [];
            for (const c of content) {
                if (c && c.type === "output_text" && typeof c.text === "string") return c.text;
            }
        }
    }
    return null;
}

// --- IA (Opcional): IA y Gemini + selecci√≥n ---
function _safeStr(x) { return (x === undefined || x === null) ? "" : String(x); }

function _extractJSONObject(text) {
    const t = _safeStr(text).trim();
    if (!t) return null;
    try { return JSON.parse(t); } catch(e) {}
    const a = t.indexOf("{");
    const b = t.lastIndexOf("}");
    if (a >= 0 && b > a) {
        const sub = t.slice(a, b + 1);
        try { return JSON.parse(sub); } catch(e) {}
    }
    return null;
}

function _setPreview(provider, rubrica) {
    // Solo Gemini
    const wrap = document.getElementById('ai-preview-wrap');
    const boxG = document.getElementById('ai-preview-gemini');
    if (!wrap || !boxG) return;

    if (provider !== "gemini") return;

    const a = document.getElementById('prev-gemini-inicial');
    const b = document.getElementById('prev-gemini-intermedio');
    const c = document.getElementById('prev-gemini-avanzado');
    const d = document.getElementById('prev-gemini-actividad');

    if (a) a.textContent = _safeStr(rubrica?.inicial);
    if (b) b.textContent = _safeStr(rubrica?.intermedio);
    if (c) c.textContent = _safeStr(rubrica?.avanzado);
    if (d) d.textContent = _safeStr(rubrica?.actividad || "No se gener√≥ actividad.");

    wrap.style.display = (rubrica && rubrica.inicial) ? "block" : "none";
}


function usarActividadIA() {
    const actividadTexto = document.getElementById('prev-gemini-actividad')?.textContent || "";
    const txtArea = document.getElementById('activity-instructions');
    if (actividadTexto && txtArea) {
        txtArea.value = actividadTexto;
        alert("Actividad copiada al cuadro de indicaciones.");
    }
}

function limpiarIA() { clearRubricaIA(); }

document.addEventListener('DOMContentLoaded', () => {
    const sel = document.getElementById('gen-indicator');
    if (sel) sel.addEventListener('change', () => clearRubricaIA());
});

function _buildRubricaPrompt(indicador, incluyeImagen) {
    const usaImg = !!incluyeImagen;
    return (`
Act√∫a como un asesor pedag√≥gico del MEP de Costa Rica.
Indicador: "${indicador}".

1. Genera una r√∫brica de 3 niveles (Inicial, Intermedio, Avanzado).
2. Dise√±a una ACTIVIDAD breve y pr√°ctica para que el estudiante realice en clase (o en su cuaderno) que permita evaluar espec√≠ficamente ese indicador.
${usaImg ? "3. Se adjunta un recorte del libro (imagen). Anal√≠zalo y √∫salo como contexto para que la ACTIVIDAD sea coherente con lo que se ve en la imagen (sin inventar detalles que no se observen)." : ""}

Devuelve SOLO un objeto JSON con este formato:
{
  "inicial": "...",
  "intermedio": "...",
  "avanzado": "...",
  "actividad": "Redacci√≥n detallada de la actividad sugerida para el estudiante."
}
`).trim();
}

async function consultarIA_Gemini() {
    const apiKey = (document.getElementById('gemini-key')?.value || "").trim();
    const indicador = (document.getElementById('gen-indicator')?.value || "").trim();
    const modelSelected = (document.getElementById('gemini-model')?.value || "gemini-1.5-flash").trim();

    if (!apiKey) return alert("Pega tu API Key de Gemini (AIza...) para probar Gemini.");
    if (!apiKey.startsWith("AIza")) return alert("Esa no parece una llave de Gemini. Debe empezar con 'AIza'.");
    if (!indicador) return alert("Selecciona un indicador primero.");

    const btn = document.getElementById('btn-ai-gemini');
    if (btn) { btn.disabled = true; btn.textContent = "‚è≥ Gemini..."; }
    setAIStatus(`IA: consultando Gemini (${modelSelected})...`);

    // Opci√≥n: usar el recorte del libro (imagen) como contexto para la actividad
    const wantImage = !!document.getElementById('gemini-use-image')?.checked;
    const inlineData = (() => {
        if (!wantImage) return null;

        const idx = document.getElementById('gen-activity')?.value;
        if (idx === "" || idx == null) return null;

        const month = document.getElementById('gen-month')?.value;
        const acts = (db.activities?.[curSubject] && month) ? db.activities[curSubject][month] : null;
        const src = (acts && acts[idx]) ? acts[idx].src : null;
        if (!src || typeof src !== "string") return null;

        const m = src.match(/^data:([^;]+);base64,(.+)$/);
        if (!m) return null;

        return { mimeType: m[1], data: m[2] };
    })();

    const prompt = _buildRubricaPrompt(indicador, !!inlineData);

    // Esquema simple (4 campos) para salida JSON.
    const schema = {
        type: "OBJECT",
        properties: {
            inicial: { type: "STRING" },
            intermedio: { type: "STRING" },
            avanzado: { type: "STRING" },
            actividad: { type: "STRING" }
        },
        required: ["inicial","intermedio","avanzado","actividad"]
    };

    // Helper: llamada a Gemini con variantes (snake_case o camelCase, con/sin schema)
    const callGemini = async (model, variant) => {
        const url = `https://generativelanguage.googleapis.com/v1beta/models/${encodeURIComponent(model)}:generateContent?key=${encodeURIComponent(apiKey)}`;

        const generationConfig = (() => {
            // Nota: la documentaci√≥n muestra ejemplos con snake_case (response_mime_type)
            // y tambi√©n define campos en camelCase (responseMimeType). Probamos ambos.
            const t = (variant && typeof variant.temperature === "number") ? variant.temperature : 0.6;

            if (variant && variant.useSchema) {
                if (variant.casing === "camel") {
                    return { temperature: t, responseMimeType: "application/json", responseSchema: schema };
                }
                return { temperature: t, response_mime_type: "application/json", response_schema: schema };
            }

            // Sin schema: pedimos JSON por prompt (m√°s compatible).
            if (variant && variant.casing === "camel") {
                return { temperature: t, responseMimeType: "application/json" };
            }
            return { temperature: t, response_mime_type: "application/json" };
        })();

        const body = {
            contents: [
                {
                    role: "user",
                    parts: (() => {
                        const parts = [{ text: prompt }];
                        if (inlineData) {
                            if (variant && variant.casing === "camel") {
                                parts.push({ inlineData: { mimeType: inlineData.mimeType, data: inlineData.data } });
                            } else {
                                parts.push({ inline_data: { mime_type: inlineData.mimeType, data: inlineData.data } });
                            }
                        }
                        return parts;
                    })()
                }
            ],
            generationConfig
        };

        const response = await fetch(url, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(body)
        });

        const data = await response.json().catch(() => ({}));

        if (!response.ok || data?.error) {
            const msg = String(data?.error?.message || data?.error?.status || response.statusText || "Error");
            const err = new Error(msg);
            err.status = response.status;
            err._status = response.status;
            err.data = data;
            throw err;
        }

        const outText =
            data?.candidates?.[0]?.content?.parts?.map(p => p?.text || "").join("") ||
            data?.candidates?.[0]?.content?.parts?.[0]?.text ||
            "";

        const parsed = _extractJSONObject(outText);
        if (!parsed || !parsed.inicial || !parsed.intermedio || !parsed.avanzado) {
            const err = new Error("La respuesta no trajo un JSON v√°lido con inicial/intermedio/avanzado (y opcionalmente actividad).");
            err.status = 0;
            err._status = 0;
            err.raw = outText;
            throw err;
        }

        return {
            indicador,
            inicial: String(parsed.inicial).trim(),
            intermedio: String(parsed.intermedio).trim(),
            avanzado: String(parsed.avanzado).trim(),
            actividad: String(parsed.actividad || "").trim(),
            _model: model
        };
    };

    // Lista de modelos a probar (por si el seleccionado no est√° habilitado en tu llave)
    const modelsToTry = Array.from(new Set([
        modelSelected,
        "gemini-1.5-flash",
        "gemini-1.5-pro"
    ]));

    let lastError = null;

    try {
        for (const model of modelsToTry) {
            try {
                // Intento 1: schema + snake_case (como ejemplos curl)
                const r1 = await callGemini(model, { useSchema: true, casing: "snake", temperature: 0.4 });
                rubricaIA_gemini = r1; rubricaIA = r1; rubricaIAProvider = "gemini";
                _setPreview("gemini", r1);
                setAIStatus(`IA activa: Gemini ‚úÖ (${r1._model})`);
                return;
            } catch (e1) {
                lastError = e1;
                const msg1 = String(e1?.message || e1);
                const st1 = Number(e1?.status || e1?._status || 0);

                // Si el modelo no existe/habilitado, probamos el siguiente modelo.
                if (st1 === 404 || /not found|model/i.test(msg1) && /not found/i.test(msg1)) {
                    continue;
                }
                // Si es error de permisos o llave inv√°lida, no vale la pena seguir con otros modelos.
                if (st1 === 401 || st1 === 403 || /permission|api key|key invalid|unauth/i.test(msg1)) {
                    throw e1;
                }
                // Si es error de red/CORS, tampoco vale seguir.
                if (/failed to fetch|networkerror|cors|blocked/i.test(msg1)) {
                    throw e1;
                }

                // Intento 2: schema + camelCase
                try {
                    const r2 = await callGemini(model, { useSchema: true, casing: "camel", temperature: 0.4 });
                    rubricaIA_gemini = r2; rubricaIA = r2; rubricaIAProvider = "gemini";
                    _setPreview("gemini", r2);
                    setAIStatus(`IA activa: Gemini ‚úÖ (${r2._model})`);
                    return;
                } catch (e2) {
                    lastError = e2;
                    const msg2 = String(e2?.message || e2);
                    const st2 = Number(e2?.status || e2?._status || 0);

                    if (st2 === 404 || /not found/i.test(msg2)) continue;
                    if (st2 === 401 || st2 === 403 || /permission|api key|key invalid|unauth/i.test(msg2)) throw e2;
                    if (/failed to fetch|networkerror|cors|blocked/i.test(msg2)) throw e2;

                    // Intento 3: sin schema (m√°s compatible) + snake_case
                    try {
                        const r3 = await callGemini(model, { useSchema: false, casing: "snake", temperature: 0.7 });
                        rubricaIA_gemini = r3; rubricaIA = r3; rubricaIAProvider = "gemini";
                        _setPreview("gemini", r3);
                        setAIStatus(`IA activa: Gemini ‚úÖ (${r3._model})`);
                        return;
                    } catch (e3) {
                        lastError = e3;
                        const msg3 = String(e3?.message || e3);
                        const st3 = Number(e3?.status || e3?._status || 0);

                        if (st3 === 404 || /not found/i.test(msg3)) continue;
                        if (st3 === 401 || st3 === 403 || /permission|api key|key invalid|unauth/i.test(msg3)) throw e3;
                        if (/failed to fetch|networkerror|cors|blocked/i.test(msg3)) throw e3;

                        // Intento 4: sin schema + camelCase
                        const r4 = await callGemini(model, { useSchema: false, casing: "camel", temperature: 0.7 });
                        rubricaIA_gemini = r4; rubricaIA = r4; rubricaIAProvider = "gemini";
                        _setPreview("gemini", r4);
                        setAIStatus(`IA activa: Gemini ‚úÖ (${r4._model})`);
                        return;
                    }
                }
            }
        }

        // Si llegamos aqu√≠, fallaron todos los modelos/variantes.
        throw lastError || new Error("No se pudo completar la consulta a Gemini.");

    } catch (error) {
        console.error(error);

        rubricaIA_gemini = null;
        rubricaIA = null;
        rubricaIAProvider = null;
        _setPreview("gemini", null);

        const msg = String(error?.message || error);
        const status = Number(error?._status || error?.status || 0);

        let userMsg = "No se pudo usar Gemini. Se usar√° el m√©todo autom√°tico.";

        if (status === 401 || status === 403 || /permission|api key|key invalid|unauth/i.test(msg)) {
            userMsg = "Gemini: tu API Key no tiene permisos / no es v√°lida, o la API no est√° habilitada en tu proyecto. " +
                      "Verifica que la llave sea de Google AI Studio y que la API est√© habilitada (y sin restricciones de referrer).";
        } else if (status === 404 || /not found/i.test(msg)) {
            userMsg = "Gemini: el modelo seleccionado no est√° disponible para tu API Key. " +
                      "Prueba con 'gemini-1.5-flash' o 'gemini-1.5-pro'. (El sistema ya intent√≥ modelos alternos y fall√≥).";
        } else if (status === 429) {
            userMsg = "Gemini: alcanzaste el l√≠mite temporal (429). Intenta m√°s tarde o revisa l√≠mites/cuota en Google.";
        } else if (status === 400) {
            userMsg = "Gemini: la solicitud fue rechazada (400). Normalmente pasa por formato de solicitud o por JSON/schema. " +
                      "El sistema intent√≥ modo compatible, pero fall√≥. Revisa tu API Key y el modelo.";
        } else if (/failed to fetch|networkerror|cors|blocked/i.test(msg)) {
            userMsg = "Gemini: el navegador bloque√≥ la conexi√≥n (CORS/red). " +
                      "Sugerencia: abre este HTML desde http://localhost (no file://) usando un servidor local.";
        }

        setAIStatus("IA: Gemini fall√≥ (auto) ‚ö†Ô∏è");
        alert(userMsg + "\n\nDetalle t√©cnico: " + msg);
    } finally {
        const btn2 = document.getElementById('btn-ai-gemini');
        if (btn2) { btn2.disabled = false; btn2.textContent = "Probar Gemini"; }
    }
}

// --- GENERACION DE HEADER SEPARADO ---
function generateHeaderWord() {
    if(!curSubject) return alert("Seleccione asignatura primero");
let school = document.getElementById('school').value;
// --- Header formatting helpers (to match the exact sample layout) ---
    const toSafe = (s) => (s === undefined || s === null) ? "" : String(s);
    const splitSchoolForHeader = (s) => {
        const t = toSafe(s).trim();
        if(!t) return ["&nbsp;", "&nbsp;"];
        const words = t.split(/\s+/);
        // If begins with a title like "Dr."/"Dra."/"Lic."/"Prof." split after 2 words: "Dr. Ricardo" + rest
        const first = (words[0] || "").toLowerCase().replace(".", "");
        const titled = ["dr", "dra", "lic", "prof", "profe", "msc", "ing"].includes(first) || (words[0] || "").endsWith(".");
        if(titled && words.length >= 3) {
            return [words.slice(0,2).join(" "), words.slice(2).join(" ")];
        }
        // Otherwise split near the middle at a word boundary
        if(words.length <= 3) return [t, "&nbsp;"];
        const mid = Math.ceil(words.length/2);
        return [words.slice(0, mid).join(" "), words.slice(mid).join(" ")];
    };

    const [schoolLine1, schoolLine2] = splitSchoolForHeader(school);

let teacher = document.getElementById('teacher').value;
    let grade = document.getElementById('grade').value;
    let student = document.getElementById('student').value;
    let month = document.getElementById('gen-month').value;
    let indicator = document.getElementById('gen-indicator').value || "";

    // --- L√ìGICA H√çBRIDA: IA O MANUAL ---
    let nivelInicial, nivelIntermedio, nivelAvanzado;
    const indicadorActual = (indicator || "").toString().trim();

    if (rubricaIA && (rubricaIA.indicador || "").toString().trim() === indicadorActual) {
        // Opci√≥n A: Usar lo que gener√≥ la IA para ESTE indicador
        nivelInicial = rubricaIA.inicial;
        nivelIntermedio = rubricaIA.intermedio;
        nivelAvanzado = rubricaIA.avanzado;
        setAIStatus("IA: aplicada ‚úÖ");
    } else {
        // Opci√≥n B: Si no se us√≥ IA (o no coincide), usar el c√°lculo heur√≠stico
        let rubrica = calcularNiveles(indicator);
        nivelInicial = rubrica.inicial;
        nivelIntermedio = rubrica.intermedio;
        nivelAvanzado = rubrica.avanzado;
        if (rubricaIA) setAIStatus("IA: no coincide, auto");
        else setAIStatus("IA: no usada (auto)");
    }
    // -----------------------------------
    let actIdx = document.getElementById('gen-activity').value;
    let includeAct = document.getElementById('include-act').checked;
    
    let actHtml = "";
    // Indicaciones (texto que el docente escribe en la app)
    const escapeHTML = (s) => (s || "")
        .replace(/&/g, "&amp;")
        .replace(/</g, "&lt;")
        .replace(/>/g, "&gt;")
        .replace(/"/g, "&quot;")
        .replace(/'/g, "&#39;");
    // Escapar HTML para insertarlo en Word sin romper la tabla
    let indicatorSafe = escapeHTML(indicator);
    let nivelInicialSafe = escapeHTML(nivelInicial);
    let nivelIntermedioSafe = escapeHTML(nivelIntermedio);
    let nivelAvanzadoSafe = escapeHTML(nivelAvanzado);

    let instructions = (document.getElementById('activity-instructions')?.value || "").trim();

    // Mostrar secci√≥n "Actividad" si hay recorte seleccionado o si hay indicaciones escritas
    const hasActivitySection = (actIdx !== "") || (instructions !== "");
    if(hasActivitySection) {
        let acts = db.activities[curSubject][month];
        let imgAct = (actIdx !== "" && acts && acts[actIdx]) ? acts[actIdx].src : null;
        let instHtml = escapeHTML(instructions).replaceAll("\r", "").split("\n").join("<br>");
        if(instHtml === "") instHtml = "&nbsp;";

        actHtml = `
            <div style="page-break-inside: avoid; margin-top:15px; border:1px solid #ccc; padding:10px;">
                <p style="font-weight:bold; margin-bottom:5px;">Actividad:</p>
                <div style="font-weight:bold; margin:0 0 4px 0;">Indicaciones:</div>
                <div style="border:1px solid #999; padding:8px; min-height:60px; margin-bottom:10px;">${instHtml}</div>
                ${includeAct && imgAct ? `
                <div style="text-align:center;">
                    <img src="${imgAct}" style="max-width:450px; height:auto;">
                </div>` : ``}
            </div>`;
    }
let content = `
    <html xmlns:o='urn:schemas-microsoft-com:office:office' xmlns:w='urn:schemas-microsoft-com:office:word' xmlns='http://www.w3.org/TR/REC-html40'>
    <head>
        <meta charset='utf-8'>
        <title>Evaluaci√≥n</title>
        <style>
            @page Section1 {
                size: 21.59cm 27.94cm;
                /* M√°s margen superior para que el contenido no ‚Äúempuje‚Äù el encabezado */
                margin: 2.8cm 2cm 2cm 2cm;
                /* Espacio entre el encabezado y el cuerpo */
                mso-header-margin: 0.6cm;
                mso-footer-margin: 1cm;
                /* Encabezado REAL (evita que se imprima abajo como contenido normal) */
                mso-header: h1;
                mso-first-header: h1;
                mso-even-header: h1;
            }
            div.Section1 { page: Section1; }
            
            body { font-family: 'Arial', sans-serif; font-size: 11pt; }
            table { width: 100%; border-collapse: collapse; }
            td, th { border: 1px solid black; padding: 5px; vertical-align: top; }
            .gray-bg { background-color: #f2f2f2; font-weight: bold; }
            .admin-table td { padding: 4px; }
            .admin-table { border: 2px solid #000; }
            .admin-table td { border: 1px solid #000; }

            .rubric-table th { background-color: #e6e6e6; text-align: center; font-weight: bold; }
            .rubric-table td { height: 70px; }
        </style>
    </head>
    <body>

    <!--[if gte mso 9]>
    <div style="mso-element:header" id="h1">
      <div style="padding-bottom:6px;">
        <table style="width:17.59cm; border-collapse:collapse; border:0; table-layout:fixed;" border="0" cellspacing="0" cellpadding="0">
          <tr>
            <td style="border:0; padding:0; width:17.59cm; vertical-align:middle; text-align:left;">
              <img src="${mepLeftBanner}" style="width:12.00cm; height:2.07cm; mso-width-source:userset; mso-height-source:userset; display:block; margin:0; padding:0;">
            </td>
          </tr>
        </table>
      </div>
    </div>
    <![endif]-->

    <div class="Section1">
        <div style="text-align:center; font-size:18pt; font-weight:bold; margin:0.18cm 0 0.40cm 0; line-height:1.05; mso-line-height-rule:exactly;">INSTRUMENTO PARA LA EVALUACI√ìN DEL<br>TRABAJO COTIDIANO</div>

                <table class="admin-table">
            
            <tr>
                <td class="gray-bg" width="15%">Centro Educativo:</td>
                <td colspan="3">${school}</td>
            </tr>
<tr>
                <td class="gray-bg" width="15%">Docente:</td>
                <td width="35%">${teacher}</td>
                <td class="gray-bg" width="15%">Asignatura:</td>
                <td width="35%">${curSubject}</td>
            </tr>
            <tr>
                <td class="gray-bg">Nivel/Secci√≥n:</td>
                <td>${grade}</td>
                <td class="gray-bg">Per√≠odo/Mes:</td>
                <td>${month}</td>
            </tr>
            <tr>
                <td class="gray-bg">Estudiante:</td>
                <td colspan="3">${student}</td>
            </tr>
        </table>
        <br>

        <table class="rubric-table">
            <thead>
                <tr>
                    <th style="width: 40%;">Indicador (Aprendizaje Esperado)</th>
                    <th style="width: 20%;">Nivel Inicial<br>(1 pt)</th>
                    <th style="width: 20%;">Nivel Intermedio<br>(2 pts)</th>
                    <th style="width: 20%;">Nivel Avanzado<br>(3 pts)</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td style="padding: 10px;">${indicatorSafe}</td>

                    <td style="padding: 10px; font-size: 10pt;">${nivelInicialSafe}</td>
                    <td style="padding: 10px; font-size: 10pt;">${nivelIntermedioSafe}</td>
                    <td style="padding: 10px; font-size: 10pt;">${nivelAvanzadoSafe}</td>
                </tr>
            </tbody>
        </table>

        ${actHtml}

        <br>
        <div style="border: 1px solid black; padding: 5px; height: 80px;">
            <strong>Observaciones:</strong>
        </div>
    </div>

    </body>
    </html>`;
    
    let blob = new Blob(['\ufeff', content], {type: 'application/msword'});
    saveAs(blob, `Evaluacion_${curSubject}_${month}.doc`);
}

// Iniciar en Asignaturas
goToSection('asignaturas');

</script>
</body>
</html>
        </template>
    </div>


</div>

<script>
// jsPDF (PDF). Si el archivo se abre sin internet y no cargan los CDN, evitamos que la app se rompa.
let jsPDFReal = null;
try {
    jsPDFReal = (window.jspdf && window.jspdf.jsPDF) ? window.jspdf.jsPDF : (window.jsPDF || null);
} catch (e) {
    jsPDFReal = null;
}

function ensureJsPDFLoaded() {
    if (typeof jsPDFReal !== "function") {
        alert("No se pudo cargar la librer√≠a para PDF (jsPDF). Si abriste este archivo sin internet, los PDF no se pueden generar. Soluci√≥n: abre el archivo con internet o usa Archivo > Imprimir > Guardar como PDF.");
        return false;
    }
    return true;
}

// Para no romper otras funciones PDF que usan `new jsPDF()`, damos un constructor 'stub' cuando falta la librer√≠a.
const jsPDF = (typeof jsPDFReal === "function") ? jsPDFReal : function () {
    alert("PDF no disponible: no se carg√≥ jsPDF (posible falta de internet).");
    return {
        setFontSize(){},
        text(){},
        splitTextToSize(t){ return [String(t)]; },
        autoTable(){ this.lastAutoTable = { finalY: 60 }; },
        addPage(){},
        save(){},
        lastAutoTable: { finalY: 60 }
    };
};

// ====== PORTADA / CONFIG (LocalStorage) ======
const MEP_PORTADA_KEY = "mep_portada_config_v1";

function getPortadaConfig() {
    try { return JSON.parse(localStorage.getItem(MEP_PORTADA_KEY) || "{}") || {}; }
    catch(e){ return {}; }
}

function setPortadaConfig(next) {
    localStorage.setItem(MEP_PORTADA_KEY, JSON.stringify(next || {}));
}

function getPortadaField(cfg, key, fallback="") {
    return (cfg && cfg[key] !== undefined && cfg[key] !== null) ? String(cfg[key]) : fallback;
}

function applyPortadaToUI(cfg) {
    const regional = getPortadaField(cfg, "regional", "").trim();
    const escuela  = getPortadaField(cfg, "escuela", "").trim();
    const circuito = getPortadaField(cfg, "circuito", "").trim();
    const grado    = getPortadaField(cfg, "grado", "").trim();
    const docente  = getPortadaField(cfg, "docente", "").trim();

    // T√≠tulo principal
    const docenteTitle = docente || "Juan Carlos S√°nchez";
    const title = `Registro Docente - Lic. ${docenteTitle}`;
    const h1 = document.getElementById("appTitle");
    if (h1) h1.textContent = title;
    document.title = `Sistema Control MEP - Lic. ${docenteTitle}`;

    // Meta superior
    const meta = document.getElementById("topMeta");
    if (meta) {
        const a = escuela ? escuela : "Escuela (sin definir)";
        const b = grado ? grado : "Grado (sin definir)";
        meta.textContent = `${a} ‚Ä¢ ${b}`;
    }

    // Subt√≠tulo del men√∫
    const sub = document.getElementById("menuSubtitle");
    if (sub) {
        const bits = [];
        if (escuela) bits.push(escuela);
        if (grado) bits.push(grado);
        if (docente) bits.push(docente);
        sub.textContent = bits.length ? bits.join(" ‚Ä¢ ") : "Seleccione una opci√≥n";
    }

    // Vista previa
    const pv = document.getElementById("portadaPreview");
    if (pv) {
        pv.innerHTML = `
            <div><b>Regional:</b> ${regional || "-"}</div>
            <div><b>Escuela:</b> ${escuela || "-"}</div>
            <div><b>Circuito:</b> ${circuito || "-"}</div>
            <div><b>Grado:</b> ${grado || "-"}</div>
            <div><b>Docente:</b> ${docente || "-"}</div>
        `;
    }

    // (Opcional) sincronizar el t√≠tulo del horario si est√° por defecto
    const th = document.getElementById("tituloHorario");
    if (th && grado) {
        const raw = (th.textContent || "").trim();
        const isDefault = raw.toUpperCase().startsWith("HORARIO DE CLASES:");
        if (isDefault) th.textContent = `HORARIO DE CLASES: ${grado.toUpperCase()}`;
    }
}

function initPortada() {
    const cfg = getPortadaConfig();

    const r = document.getElementById("cfgRegional");
    const e = document.getElementById("cfgEscuela");
    const c = document.getElementById("cfgCircuito");
    const g = document.getElementById("cfgGrado");
    const d = document.getElementById("cfgDocente");

    if (r) r.value = getPortadaField(cfg, "regional", "");
    if (e) e.value = getPortadaField(cfg, "escuela", "");
    if (c) c.value = getPortadaField(cfg, "circuito", "");
    if (g) g.value = getPortadaField(cfg, "grado", "");
    if (d) d.value = getPortadaField(cfg, "docente", "");

    applyPortadaToUI(cfg);
}

function portadaOnInput() {
    const cfg = {
        regional: (document.getElementById("cfgRegional")?.value || "").trim(),
        escuela:  (document.getElementById("cfgEscuela")?.value || "").trim(),
        circuito: (document.getElementById("cfgCircuito")?.value || "").trim(),
        grado:    (document.getElementById("cfgGrado")?.value || "").trim(),
        docente:  (document.getElementById("cfgDocente")?.value || "").trim()
    };
    setPortadaConfig(cfg);
    applyPortadaToUI(cfg);

    const ind = document.getElementById("portadaSaveIndicator");
    if (ind) {
        ind.style.opacity = 1;
        clearTimeout(window.__portadaSaveTO);
        window.__portadaSaveTO = setTimeout(() => { ind.style.opacity = 0; }, 1200);
    }
}

// ====== MEN√ö ======
function toggleMenu(open) {
    const ov = document.getElementById("menuOverlay");
    if (!ov) return;
    const willOpen = (open === undefined) ? !ov.classList.contains("open") : !!open;
    if (willOpen) ov.classList.add("open");
    else ov.classList.remove("open");
}

function openFromMenu(tab) {
    toggleMenu(false);
    if (typeof showTab === "function") showTab(tab);
    // En Asistencia, abrimos por defecto "Asistencia Diaria"
    if (tab === "mainAsistencia" && typeof showSubTab === "function") {
        showSubTab("asistencia");
    }
}

function abrirMenuDesdePortada() {
    toggleMenu(true);
}

function restablecerPortada() {
    if (!confirm("¬øDesea borrar los datos de la Portada (regional/escuela/circuito/grado/docente)?")) return;
    localStorage.removeItem(MEP_PORTADA_KEY);
    initPortada();
}

// ====== ENCABEZADO PARA PDF ======
function drawPDFHeader(doc) {
    const cfg = getPortadaConfig();
    const regional = getPortadaField(cfg, "regional", "").trim();
    const escuela  = getPortadaField(cfg, "escuela", "").trim();
    const circuito = getPortadaField(cfg, "circuito", "").trim();
    const grado    = getPortadaField(cfg, "grado", "").trim();
    const docente  = getPortadaField(cfg, "docente", "").trim();

    const left = 14;
    const maxW = 182;
    let y = 12;

    doc.setFontSize(9);
    doc.setTextColor(80);

    const line1 = `Regional: ${regional || "-"}   |   Escuela: ${escuela || "-"}`;
    const line2 = `Circuito: ${circuito || "-"}   |   Grado: ${grado || "-"}   |   Docente: ${docente || "-"}`;

    const l1 = (typeof doc.splitTextToSize === "function") ? doc.splitTextToSize(line1, maxW) : [line1];
    const l2 = (typeof doc.splitTextToSize === "function") ? doc.splitTextToSize(line2, maxW) : [line2];

    doc.text(l1, left, y);
    y += 4 * l1.length;
    doc.text(l2, left, y);
    y += 4 * l2.length;

    doc.setDrawColor(180);
    doc.line(left, y + 1, 196, y + 1);

    doc.setTextColor(0);
    return y + 8; // inicio recomendado del contenido
}

    // Configuraci√≥n Inicial
    const fechasMEP = {
        I: { inicio: "2026-02-23", fin: "2026-07-03" },
        II: { inicio: "2026-07-20", fin: "2026-12-09" }
    };

    const baseHorarios = {
        ma√±ana: [
            {h: "7:00-7:40", lun: "Espa√±ol", mar: "Espa√±ol", mie: "Matem√°ticas", jue: "Estudios Sociales", vie: "Espa√±ol", c: ["m-esp","m-esp","m-mate","m-soc","m-esp"]},
            {h: "7:40-8:20", lun: "Espa√±ol", mar: "Espa√±ol", mie: "Matem√°ticas", jue: "Estudios Sociales", vie: "Espa√±ol", c: ["m-esp","m-esp","m-mate","m-soc","m-esp"]},
            {h: "Receso", lun: "-", mar: "-", mie: "-", jue: "-", vie: "-", c: ["receso","receso","receso","receso","receso"]},
            {h: "8:30-9:10", lun: "Educ. Musical", mar: "Ingl√©s", mie: "Espa√±ol", jue: "Matem√°ticas", vie: "Matem√°ticas", c: ["m-mus","m-ing","m-esp","m-mate","m-mate"]},
            {h: "9:10-9:50", lun: "Educ. Musical", mar: "Ingl√©s", mie: "Ciencias", jue: "Matem√°ticas", vie: "Estudios Sociales", c: ["m-mus","m-ing","","m-mate","m-soc"]},
            {h: "Receso", lun: "-", mar: "-", mie: "-", jue: "-", vie: "-", c: ["receso","receso","receso","receso","receso"]},
            {h: "10:00-10:40", lun: "Ingl√©s", mar: "Matem√°ticas", mie: "Inform√°tica", jue: "Ciencias", vie: "Educ. Religiosa", c: ["m-ing","m-mate","m-inf","","m-rel"]},
            {h: "10:40-11:20", lun: "Ingl√©s", mar: "Matem√°ticas", mie: "Inform√°tica", jue: "Ciencias", vie: "Educ. Religiosa", c: ["m-ing","m-mate","m-inf","","m-rel"]},
            {h: "Receso", lun: "-", mar: "-", mie: "-", jue: "-", vie: "-", c: ["receso","receso","receso","receso","receso"]},
            {h: "11:30-12:10", lun: "Ingl√©s", mar: "-", mie: "-", jue: "-", vie: "-", c: ["m-ing","","","",""]}
        ],
        tarde: [
            {h: "12:40-1:20", lun: "Educ. Musical", mar: "Ingl√©s", mie: "Matem√°ticas", jue: "Ingl√©s", vie: "Espa√±ol", c: ["m-mus","m-ing","m-mate","m-ing","m-esp"]},
            {h: "1:20-2:00", lun: "Educ. Musical", mar: "Ingl√©s", mie: "Matem√°ticas", jue: "Ingl√©s", vie: "Espa√±ol", c: ["m-mus","m-ing","m-mate","m-ing","m-esp"]},
            {h: "Receso", lun: "-", mar: "-", mie: "-", jue: "-", vie: "-", c: ["receso","receso","receso","receso","receso"]},
            {h: "2:10-2:50", lun: "Ingl√©s", mar: "Matem√°ticas", mie: "Ciencias", jue: "Matem√°ticas", vie: "Est. Sociales", c: ["m-ing","m-mate","","m-mate","m-soc"]},
            {h: "2:50-3:30", lun: "Matem√°ticas", mar: "Matem√°ticas", mie: "Ciencias", jue: "Matem√°ticas", vie: "Est. Sociales", c: ["m-mate","m-mate","","m-mate","m-soc"]},
            {h: "Receso", lun: "-", mar: "-", mie: "-", jue: "-", vie: "-", c: ["receso","receso","receso","receso","receso"]},
            {h: "3:40-4:20", lun: "Espa√±ol", mar: "Espa√±ol", mie: "Inform√°tica", jue: "Espa√±ol", vie: "Educ. Religiosa", c: ["m-esp","m-esp","m-inf","m-esp","m-rel"]},
            {h: "4:20-5:00", lun: "Espa√±ol", mar: "Espa√±ol", mie: "Inform√°tica", jue: "Ciencias", vie: "Educ. Religiosa", c: ["m-esp","m-esp","m-inf","","m-rel"]},
            {h: "Receso", lun: "-", mar: "-", mie: "-", jue: "-", vie: "-", c: ["receso","receso","receso","receso","receso"]},
            {h: "5:00+", lun: "-", mar: "-", mie: "Est. Sociales", jue: "-", vie: "-", c: ["","","m-soc","",""]}
        ]
    };

    let horariosData = JSON.parse(localStorage.getItem('mep_horario_custom')) || baseHorarios;
    const diasNombres = ["Lunes", "Martes", "Mi√©rcoles", "Jueves", "Viernes"];

    let dbAusencias = JSON.parse(localStorage.getItem('mep_db_ausencias_periodo')) || {};
    let dbDiaria = JSON.parse(localStorage.getItem('mep_db_diaria')) || {};
    let dbPruebas = JSON.parse(localStorage.getItem('mep_db_pruebas')) || {};
    let dbTareas = JSON.parse(localStorage.getItem('mep_db_tareas')) || {};
    let dbCotidiano = JSON.parse(localStorage.getItem('mep_db_cotidiano')) || {}; // DB Cotidiano

    let dbBitacora = JSON.parse(localStorage.getItem('mep_db_bitacora_2026')) || {}; // DB Bit√°cora (observaciones)
    let bitacoraSelectedDate = null;
    let bitacoraInited = false;

    let materiaActual = "Espa√±ol";
    let periodoActualResumen = "I";
    let pMateria = "Espa√±ol";
    let pPeriodo = "I";
    let pNumero = 1;

    // Variables Tareas
    let tMateria = "Espa√±ol";
    let tPeriodo = "I";
    let tNumero = 1;

    // Variables Cotidiano
    let cMateria = "Espa√±ol";
    let cPeriodo = "I";

    
    // --- FUNCIONES CORE ---
    function initEstudiantes() {
        const grid = document.getElementById('gridEstudiantes');
        let lista = null;
        try { lista = JSON.parse(localStorage.getItem('mep_estudiantes_v2')); } catch(e) { lista = null; }

        // Migraci√≥n / compatibilidad:
        // - mep_estudiantes: array de strings (solo nombres)
        // - mep_estudiantes_v2 antiguo: {nombre, condicion}
        const esArray = Array.isArray(lista);
        const esStringArray = esArray && lista.length > 0 && typeof lista[0] === 'string';

        if (!esArray || esStringArray) {
            const listaVieja = JSON.parse(localStorage.getItem('mep_estudiantes')) || [];
            lista = [];
            for (let i = 0; i < 36; i++) {
                lista.push({
                    nombre: listaVieja[i] || "",
                    cedula: "",
                    nacimiento: "",
                    encargado: "",
                    telefono: "",
                    condicion: "Regular"
                });
            }
        } else {
            // Completar campos nuevos si faltan
            lista = lista.map(x => ({
                nombre: (x && x.nombre) ? x.nombre : "",
                cedula: (x && x.cedula) ? x.cedula : "",
                nacimiento: (x && x.nacimiento) ? x.nacimiento : "",
                encargado: (x && x.encargado) ? x.encargado : "",
                telefono: (x && x.telefono) ? x.telefono : "",
                condicion: (x && x.condicion) ? x.condicion : "Regular"
            }));
        }

        // Asegurar siempre 36 registros
        for (let i = 0; i < 36; i++) {
            if (!lista[i]) {
                lista[i] = { nombre: "", cedula: "", nacimiento: "", encargado: "", telefono: "", condicion: "Regular" };
            }
        }

        const esc = (v) => String(v || "")
            .replace(/&/g, "&amp;")
            .replace(/</g, "&lt;")
            .replace(/>/g, "&gt;")
            .replace(/"/g, "&quot;");

        // Estado UI (compacto / ocultar vac√≠os)
        loadEstudiantesUI();

        grid.innerHTML = "";
        for (let i = 1; i <= 36; i++) {
            const dato = lista[i - 1] || { nombre: "", cedula: "", nacimiento: "", encargado: "", telefono: "", condicion: "Regular" };

            const isEmpty = !(dato.nombre || "").trim() &&
                            !(dato.cedula || "").trim() &&
                            !(dato.nacimiento || "").trim() &&
                            !(dato.encargado || "").trim() &&
                            !(dato.telefono || "").trim();

            const miniParts = [];
            if ((dato.cedula || "").trim()) miniParts.push(`C√©dula: ${esc(dato.cedula)}`);
            if ((dato.nacimiento || "").trim()) miniParts.push(`Nac.: ${esc(dato.nacimiento)}`);
            if ((dato.encargado || "").trim()) miniParts.push(`Encargado: ${esc(dato.encargado)}`);
            if ((dato.telefono || "").trim()) miniParts.push(`Tel: ${esc(dato.telefono)}`);
            const mini = miniParts.join(" ‚Ä¢ ");

            grid.innerHTML += `
                <div class="estudiante-item ${isEmpty ? 'is-empty' : ''}">
                    <div class="estudiante-top">
                        <span class="num-lista">${i}</span>
                        <input type="text" class="input-estudiante" placeholder="Nombre completo" value="${esc(dato.nombre)}">

                        <select class="select-condicion">
                            <option value="Regular" ${dato.condicion === 'Regular' ? 'selected' : ''}>Regular</option>
                            <option value="Adecuaci√≥n Significativa" ${dato.condicion === 'Adecuaci√≥n Significativa' ? 'selected' : ''}>Adecuaci√≥n Sig.</option>
                            <option value="Adecuaci√≥n No Significativa" ${dato.condicion === 'Adecuaci√≥n No Significativa' ? 'selected' : ''}>Adecuaci√≥n No Sig.</option>
                            <option value="Apoyo" ${dato.condicion === 'Apoyo' ? 'selected' : ''}>Apoyo</option>
                        </select>

                        <div class="estudiante-actions">
                            <button type="button" class="btn-icon details" title="Ver/ocultar datos" onclick="toggleDetallesEstudiante(this)">‚â°</button>
                            <button type="button" class="btn-icon danger" title="Limpiar esta fila" onclick="limpiarFilaEstudiante(${i - 1})">üßπ</button>
                        </div>
                    </div>

                    <div class="estudiante-mini">${mini}</div>

                    <div class="estudiante-details">
                        <div class="estudiante-extra">
                            <input type="text" class="input-small input-cedula" placeholder="N√∫mero de c√©dula" value="${esc(dato.cedula)}">
                            <input type="date" class="input-small input-nacimiento" value="${esc(dato.nacimiento)}">
                        </div>

                        <div class="estudiante-extra">
                            <input type="text" class="input-small input-encargado" placeholder="Encargado legal" value="${esc(dato.encargado)}">
                            <input type="tel" class="input-small input-telefono" placeholder="N√∫mero telef√≥nico" value="${esc(dato.telefono)}">
                        </div>
                    </div>
                </div>`;
        }

        bindEstudiantesHandlers();
        setEstudiantesUI();
        syncBotonesDetalles();
    }

    function loadEstudiantesUI() {
        const compactSaved = localStorage.getItem('mep_est_ui_compact');
        const hideEmptySaved = localStorage.getItem('mep_est_ui_hide_empty');

        const compact = (compactSaved === null) ? true : (compactSaved === '1');
        const hideEmpty = (hideEmptySaved === null) ? true : (hideEmptySaved === '1');

        const chkCompact = document.getElementById('estCompactToggle');
        const chkHideEmpty = document.getElementById('estHideEmptyToggle');

        if (chkCompact) chkCompact.checked = compact;
        if (chkHideEmpty) chkHideEmpty.checked = hideEmpty;
    }

    function setEstudiantesUI() {
        const grid = document.getElementById('gridEstudiantes');
        const chkCompact = document.getElementById('estCompactToggle');
        const chkHideEmpty = document.getElementById('estHideEmptyToggle');

        const compact = chkCompact ? chkCompact.checked : true;
        const hideEmpty = chkHideEmpty ? chkHideEmpty.checked : true;

        if (grid) {
            grid.classList.toggle('compact', !!compact);
            grid.classList.toggle('hide-empty', !!hideEmpty);
        }

        localStorage.setItem('mep_est_ui_compact', compact ? '1' : '0');
        localStorage.setItem('mep_est_ui_hide_empty', hideEmpty ? '1' : '0');
    }

    function toggleDetallesEstudiante(btn) {
        const card = btn.closest('.estudiante-item');
        if (!card) return;
        card.classList.toggle('open');
        syncBotonesDetalles();
    }

    function syncBotonesDetalles() {
        document.querySelectorAll('#gridEstudiantes .estudiante-item').forEach(card => {
            const btn = card.querySelector('.btn-icon.details');
            if (btn) btn.classList.toggle('active', card.classList.contains('open'));
        });
    }

    function refreshEstudianteCard(card) {
        const nombre = (card.querySelector('.input-estudiante')?.value || "").trim();
        const cedula = (card.querySelector('.input-cedula')?.value || "").trim();
        const nacimiento = (card.querySelector('.input-nacimiento')?.value || "").trim();
        const encargado = (card.querySelector('.input-encargado')?.value || "").trim();
        const telefono = (card.querySelector('.input-telefono')?.value || "").trim();

        const miniParts = [];
        if (cedula) miniParts.push(`C√©dula: ${cedula}`);
        if (nacimiento) miniParts.push(`Nac.: ${nacimiento}`);
        if (encargado) miniParts.push(`Encargado: ${encargado}`);
        if (telefono) miniParts.push(`Tel: ${telefono}`);

        const miniEl = card.querySelector('.estudiante-mini');
        if (miniEl) miniEl.textContent = miniParts.join(" ‚Ä¢ ");

        const isEmpty = (!nombre && !cedula && !nacimiento && !encargado && !telefono);
        card.classList.toggle('is-empty', isEmpty);
        if (!isEmpty) card.classList.remove('force-show');
    }

    function onEstudianteAnyChange(e) {
        const card = e.target.closest('.estudiante-item');
        if (!card) return;
        refreshEstudianteCard(card);
    }

    function bindEstudiantesHandlers() {
        const grid = document.getElementById('gridEstudiantes');
        if (!grid) return;
        if (grid.dataset.bound === '1') return;

        grid.addEventListener('input', onEstudianteAnyChange);
        grid.addEventListener('change', onEstudianteAnyChange);
        grid.dataset.bound = '1';
    }

    function limpiarFilaEstudiante(idx) {
        if (!confirm("¬øDesea limpiar todos los datos de esta fila?")) return;

        const cards = document.querySelectorAll('#gridEstudiantes .estudiante-item');
        const card = cards[idx];
        if (!card) return;

        card.querySelector('.input-estudiante').value = "";
        card.querySelector('.input-cedula').value = "";
        card.querySelector('.input-nacimiento').value = "";
        card.querySelector('.input-encargado').value = "";
        card.querySelector('.input-telefono').value = "";
        card.querySelector('.select-condicion').value = "Regular";
        card.classList.remove('open');
        card.classList.remove('force-show');

        refreshEstudianteCard(card);
        syncBotonesDetalles();
        guardarLista(true);
    }

    function limpiarSobrantesEstudiantes() {
        if (!confirm("Esto borrar√° todas las casillas despu√©s del √öLTIMO estudiante con nombre. ¬øDesea continuar?")) return;

        const cards = Array.from(document.querySelectorAll('#gridEstudiantes .estudiante-item'));
        let last = -1;

        cards.forEach((card, idx) => {
            const nombre = (card.querySelector('.input-estudiante')?.value || "").trim();
            if (nombre) last = idx;
        });

        for (let i = last + 1; i < cards.length; i++) {
            const card = cards[i];
            card.querySelector('.input-estudiante').value = "";
            card.querySelector('.input-cedula').value = "";
            card.querySelector('.input-nacimiento').value = "";
            card.querySelector('.input-encargado').value = "";
            card.querySelector('.input-telefono').value = "";
            card.querySelector('.select-condicion').value = "Regular";
            card.classList.remove('open');
        card.classList.remove('force-show');
            refreshEstudianteCard(card);
        }

        syncBotonesDetalles();
        guardarLista(true);
        alert("Casillas sobrantes borradas.");
    }

    
    function agregarEstudiante() {
        const card = document.querySelector('#gridEstudiantes .estudiante-item.is-empty');
        if (!card) {
            alert("No hay m√°s espacios disponibles (m√°ximo 36).");
            return;
        }
        card.classList.add('force-show');
        card.classList.add('open');
        syncBotonesDetalles();
        card.scrollIntoView({ behavior: 'smooth', block: 'center' });
        const inp = card.querySelector('.input-estudiante');
        if (inp) inp.focus();
    }

function expandirTodosEstudiantes() {
        document.querySelectorAll('#gridEstudiantes .estudiante-item').forEach(card => card.classList.add('open'));
        syncBotonesDetalles();
    }

    function contraerTodosEstudiantes() {
        document.querySelectorAll('#gridEstudiantes .estudiante-item').forEach(card => card.classList.remove('open'));
        syncBotonesDetalles();
    }


    function guardarLista(silent = false) {
        const items = document.querySelectorAll('.estudiante-item');
        const listaGuardar = [];
        items.forEach(item => {
            const nombre = item.querySelector('.input-estudiante').value.trim();
            const condicion = item.querySelector('.select-condicion').value;

            const cedula = (item.querySelector('.input-cedula')?.value || "").trim();
            const nacimiento = (item.querySelector('.input-nacimiento')?.value || "").trim();
            const encargado = (item.querySelector('.input-encargado')?.value || "").trim();
            const telefono = (item.querySelector('.input-telefono')?.value || "").trim();

            listaGuardar.push({
                nombre: nombre,
                cedula: cedula,
                nacimiento: nacimiento,
                encargado: encargado,
                telefono: telefono,
                condicion: condicion
            });
        });

        localStorage.setItem('mep_estudiantes_v2', JSON.stringify(listaGuardar));
        localStorage.setItem('mep_estudiantes', JSON.stringify(listaGuardar.map(x => x.nombre)));

        if(!silent) alert("Lista actualizada.");
        renderResumen();
    }

    // --- L√ìGICA PRUEBAS ---
    function selMateriaPrueba(m, btn) {
        pMateria = m;
        document.querySelectorAll('#menuMateriaPrueba .btn-subnav').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        cargarDatosPrueba();
    }
    function selPeriodoPrueba(p, btn) {
        pPeriodo = p;
        document.querySelectorAll('#menuPeriodoPrueba .btn-subnav').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        cargarDatosPrueba();
    }
    function selNumeroPrueba(n) {
        pNumero = n;
        document.querySelectorAll('#menuNumeroPrueba .btn-nav').forEach(b => b.classList.remove('active'));
        document.getElementById(`btnPrueba${n}`).classList.add('active');
        cargarDatosPrueba();
    }
    function configurarCiclo(ciclo) {
        if(ciclo === 1) document.getElementById('configValor').value = 10;
        else document.getElementById('configValor').value = 15;
        document.getElementById('configPuntos').value = 0;
        recalcularTablaPruebas();
    }
    function toggleP2() { recalcularTablaPruebas(); }

    function cargarDatosPrueba() {
        document.getElementById('tituloTablaPruebas').innerText = `${pMateria} - ${pPeriodo} Periodo - ${pNumero === 1 ? 'I' : 'II'} Prueba`;

        if (!dbPruebas[pMateria]) dbPruebas[pMateria] = {};
        if (!dbPruebas[pMateria][pPeriodo]) dbPruebas[pMateria][pPeriodo] = {};
        if (!dbPruebas[pMateria][pPeriodo][`p${pNumero}`]) dbPruebas[pMateria][pPeriodo][`p${pNumero}`] = { config: { valor: 0, puntos: 0 }, notas: {} };
        let otherNum = pNumero === 1 ? 2 : 1;
        if (!dbPruebas[pMateria][pPeriodo][`p${otherNum}`]) dbPruebas[pMateria][pPeriodo][`p${otherNum}`] = { config: { valor: 0, puntos: 0 }, notas: {} };
        if(!dbPruebas[pMateria][pPeriodo].settings) dbPruebas[pMateria][pPeriodo].settings = { p2Activa: false };

        document.getElementById('checkActivarP2').checked = dbPruebas[pMateria][pPeriodo].settings.p2Activa;
        const dataPrueba = dbPruebas[pMateria][pPeriodo][`p${pNumero}`];
        const valorConfig = (dataPrueba.config.valor === undefined || dataPrueba.config.valor === null) ? 0 : dataPrueba.config.valor;
        const puntosConfig = (dataPrueba.config.puntos === undefined || dataPrueba.config.puntos === null) ? 0 : dataPrueba.config.puntos;

        document.getElementById('configValor').value = valorConfig;
        document.getElementById('configPuntos').value = puntosConfig;

        const lista = JSON.parse(localStorage.getItem('mep_estudiantes_v2')) || [];
        const tbody = document.getElementById('cuerpoTablaPruebas');
        tbody.innerHTML = "";
        const p1 = dbPruebas[pMateria][pPeriodo][`p1`];
        const p2 = dbPruebas[pMateria][pPeriodo][`p2`];
        const p2Activa = dbPruebas[pMateria][pPeriodo].settings.p2Activa;

        lista.forEach((est, index) => {
            if(est.nombre && est.nombre.trim() !== "") {
                let ptsObtenidos = dataPrueba.notas[est.nombre];
                if (ptsObtenidos === undefined || ptsObtenidos === null || ptsObtenidos === "") ptsObtenidos = 0;

                let nota = "0.00", porc = "0.00";
                let valPorcNum = 0;
                const maxPts = parseFloat(puntosConfig);
                const valPorc = parseFloat(valorConfig);
                if(maxPts > 0) {
                    nota = ((ptsObtenidos / maxPts) * 100).toFixed(2);
                    valPorcNum = ((ptsObtenidos / maxPts) * valPorc);
                    porc = valPorcNum.toFixed(2);
                }
                let porc1 = 0, porc2 = 0;
                if(pNumero === 1) porc1 = valPorcNum;
                else if(p1.notas[est.nombre] !== undefined && parseFloat(p1.config.puntos) > 0) porc1 = (parseFloat(p1.notas[est.nombre]) / parseFloat(p1.config.puntos)) * parseFloat(p1.config.valor);
                if(pNumero === 2) porc2 = valPorcNum;
                else if(p2.notas[est.nombre] !== undefined && parseFloat(p2.config.puntos) > 0) porc2 = (parseFloat(p2.notas[est.nombre]) / parseFloat(p2.config.puntos)) * parseFloat(p2.config.valor);

                let totalAcumulado = porc1 + (p2Activa ? porc2 : 0);

                tbody.innerHTML += `<tr>
                    <td>${index+1}</td>
                    <td style="text-align:left; font-weight:bold;">${est.nombre}</td>
                    <td><input type="number" class="input-puntos" value="${ptsObtenidos}" oninput="calcularFilaPrueba(this)" data-nombre="${est.nombre}"></td>
                    <td class="td-nota" style="${maxPts > 0 && (ptsObtenidos/maxPts*100) < 65 ? 'color:red' : 'color:black'}">${nota}</td>
                    <td class="td-porc" style="font-weight:bold; color:var(--mep-blue)">${porc}</td>
                    <td class="td-acumulado" style="font-weight:bold;">${totalAcumulado.toFixed(2)}%</td>
                    <td>
                        <button class="btn-pdf-mini" onclick="generarPDFPruebas('${est.nombre}')">PDF</button>
                        <button class="btn-reset-mini" onclick="resetearEstudianteTotal('${est.nombre}')">RESET</button>
                    </td>
                </tr>`;
            }
        });
    }

    function recalcularTablaPruebas() {
        const filas = document.querySelectorAll('#cuerpoTablaPruebas tr');
        filas.forEach(tr => { calcularFilaPrueba(tr.querySelector('.input-puntos')); });
    }

    function calcularFilaPrueba(input) {
        const tr = input.closest('tr');
        const pts = parseFloat(input.value);
        const maxPts = parseFloat(document.getElementById('configPuntos').value);
        const valPorc = parseFloat(document.getElementById('configValor').value);
        const activarP2 = document.getElementById('checkActivarP2').checked;
        const nombre = input.dataset.nombre;
        const tdNota = tr.querySelector('.td-nota');
        const tdPorc = tr.querySelector('.td-porc');
        const tdAcum = tr.querySelector('.td-acumulado');
        let porcentajeActual = 0;

        if (!isNaN(pts) && maxPts > 0) {
            const nota = (pts / maxPts) * 100;
            porcentajeActual = (pts / maxPts) * valPorc;
            tdNota.innerText = nota.toFixed(2);
            tdPorc.innerText = porcentajeActual.toFixed(2);
            tdNota.style.color = (nota < 65) ? "red" : "black";
        } else {
            tdNota.innerText = "0.00";
            tdPorc.innerText = "0.00";
            porcentajeActual = 0;
            tdNota.style.color = "red";
        }

        let otherNum = pNumero === 1 ? 2 : 1;
        let otroPorc = 0;
        const otherData = dbPruebas[pMateria][pPeriodo][`p${otherNum}`];
        if(otherData && otherData.notas[nombre] !== undefined && parseFloat(otherData.config.puntos) > 0) {
            otroPorc = (parseFloat(otherData.notas[nombre]) / parseFloat(otherData.config.puntos)) * parseFloat(otherData.config.valor);
        }
        let total = (pNumero === 1) ? (porcentajeActual + (activarP2 ? otroPorc : 0)) : (otroPorc + (activarP2 ? porcentajeActual : 0));
        tdAcum.innerText = total.toFixed(2) + "%";
    }

    function guardarNotasPrueba() {
        const val = parseFloat(document.getElementById('configValor').value) || 0;
        const pts = parseFloat(document.getElementById('configPuntos').value) || 0;
        const p2Activa = document.getElementById('checkActivarP2').checked;
        dbPruebas[pMateria][pPeriodo][`p${pNumero}`].config = { valor: val, puntos: pts };
        if(!dbPruebas[pMateria][pPeriodo].settings) dbPruebas[pMateria][pPeriodo].settings = {};
        dbPruebas[pMateria][pPeriodo].settings.p2Activa = p2Activa;
        const inputs = document.querySelectorAll('#cuerpoTablaPruebas .input-puntos');
        let notasObj = {};
        inputs.forEach(i => { let v = parseFloat(i.value); if(isNaN(v)) v = 0; notasObj[i.dataset.nombre] = v; });
        dbPruebas[pMateria][pPeriodo][`p${pNumero}`].notas = notasObj;
        localStorage.setItem('mep_db_pruebas', JSON.stringify(dbPruebas));
        alert("Notas y configuraci√≥n guardadas.");
        cargarDatosPrueba();
    }

    function resetearTablaActual() {
        if(!confirm("¬øBorrar notas de ESTA prueba?")) return;
        const inputs = document.querySelectorAll('#cuerpoTablaPruebas .input-puntos');
        inputs.forEach(inp => inp.value = "0");
        dbPruebas[pMateria][pPeriodo][`p${pNumero}`].notas = {};
        guardarNotasPrueba();
    }

    function resetearEstudianteTotal(nombre) {
        if(!confirm(`¬øBorrar TODO registro de pruebas de ${nombre}?`)) return;
        ["Espa√±ol", "Matem√°ticas", "Estudios Sociales", "Ciencias"].forEach(m => {
            if(dbPruebas[m]) ["I", "II"].forEach(p => {
                if(dbPruebas[m][p]) ["p1", "p2"].forEach(pr => {
                    if(dbPruebas[m][p][pr]?.notas) delete dbPruebas[m][p][pr].notas[nombre];
                });
            });
        });
        localStorage.setItem('mep_db_pruebas', JSON.stringify(dbPruebas));
        alert("Borrado.");
        cargarDatosPrueba();
    }

    function generarPDFPruebas(nombreEstudiante) {
        if (!ensureJsPDFLoaded()) return;
        const doc = new jsPDF();
        const y0 = drawPDFHeader(doc);

        const periodo = pPeriodo;
        doc.setFontSize(16); 
        doc.text("Informe de Calificaciones - Componente Pruebas", 14, y0);

        doc.setFontSize(12); 
        doc.text(`Estudiante: ${nombreEstudiante}`, 14, y0 + 10); 
        doc.text(`Periodo: ${periodo}`, 14, y0 + 18);

        const materias = ["Espa√±ol", "Matem√°ticas", "Estudios Sociales", "Ciencias"];
        const filas = [];
        materias.forEach(mat => {
            let p1Txt="-", p2Txt="-", total=0, p1Val=0, p2Val=0;
            if(dbPruebas[mat] && dbPruebas[mat][periodo]) {
                const d1 = dbPruebas[mat][periodo].p1;
                if(d1 && d1.notas[nombreEstudiante]!==undefined && d1.config.puntos>0) {
                    const raw = d1.notas[nombreEstudiante];
                    p1Val = (raw/d1.config.puntos)*d1.config.valor;
                    p1Txt = `${((raw/d1.config.puntos)*100).toFixed(2)} (${p1Val.toFixed(2)}%)`;
                }
                const d2 = dbPruebas[mat][periodo].p2;
                if(d2 && d2.notas[nombreEstudiante]!==undefined && d2.config.puntos>0) {
                    const raw = d2.notas[nombreEstudiante];
                    p2Val = (raw/d2.config.puntos)*d2.config.valor;
                    p2Txt = `${((raw/d2.config.puntos)*100).toFixed(2)} (${p2Val.toFixed(2)}%)`;
                }
                const sets = dbPruebas[mat][periodo].settings || {p2Activa:false};
                total = p1Val + (sets.p2Activa?p2Val:0);
            }
            filas.push([mat, p1Txt, p2Txt, total.toFixed(2)+"%"]);
        });

        doc.autoTable({ startY: y0 + 25, head: [['Materia', 'I Prueba', 'II Prueba', 'Total']], body: filas });
        doc.save(`Notas_Pruebas_${nombreEstudiante}.pdf`);
    }

    // --- L√ìGICA TAREAS ---
    function selMateriaTarea(m, btn) {
        tMateria = m;
        document.querySelectorAll('#menuMateriaTarea .btn-subnav').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        cargarDatosTarea();
    }
    function selPeriodoTarea(p, btn) {
        tPeriodo = p;
        document.querySelectorAll('#menuPeriodoTarea .btn-subnav').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        cargarDatosTarea();
    }
    function selNumeroTarea(n) {
        tNumero = n;
        document.querySelectorAll('#menuNumeroTarea .btn-nav').forEach(b => b.classList.remove('active'));
        document.getElementById(`btnTarea${n}`).classList.add('active');
        cargarDatosTarea();
    }

    function cargarDatosTarea() {
        document.getElementById('tituloTablaTareas').innerText = `${tMateria} - ${tPeriodo} Periodo - Tarea ${tNumero}`;

        if (!dbTareas[tMateria]) dbTareas[tMateria] = {};
        if (!dbTareas[tMateria][tPeriodo]) dbTareas[tMateria][tPeriodo] = {};
        if (!dbTareas[tMateria][tPeriodo][`t${tNumero}`]) dbTareas[tMateria][tPeriodo][`t${tNumero}`] = { config: { valor: 5, puntos: 0 }, notas: {} };
        let otherNum = tNumero === 1 ? 2 : 1;
        if (!dbTareas[tMateria][tPeriodo][`t${otherNum}`]) dbTareas[tMateria][tPeriodo][`t${otherNum}`] = { config: { valor: 5, puntos: 0 }, notas: {} };
        if(!dbTareas[tMateria][tPeriodo].settings) dbTareas[tMateria][tPeriodo].settings = { t2Activa: true };
        document.getElementById('checkActivarT2').checked = dbTareas[tMateria][tPeriodo].settings.t2Activa;

        const dataTarea = dbTareas[tMateria][tPeriodo][`t${tNumero}`];
        document.getElementById('configValorTarea').value = dataTarea.config.valor;
        document.getElementById('configPuntosTarea').value = dataTarea.config.puntos;

        const lista = JSON.parse(localStorage.getItem('mep_estudiantes_v2')) || [];
        const tbody = document.getElementById('cuerpoTablaTareas');
        tbody.innerHTML = "";

        const t1 = dbTareas[tMateria][tPeriodo][`t1`];
        const t2 = dbTareas[tMateria][tPeriodo][`t2`];
        const t2Activa = dbTareas[tMateria][tPeriodo].settings.t2Activa;

        lista.forEach((est, index) => {
            if(est.nombre && est.nombre.trim() !== "") {
                let ptsObtenidos = dataTarea.notas[est.nombre];
                if (ptsObtenidos === undefined || ptsObtenidos === null) ptsObtenidos = 0;
                let nota = "0.00", porc = "0.00";
                let valPorcNum = 0;
                const maxPts = parseFloat(dataTarea.config.puntos);
                const valPorc = parseFloat(dataTarea.config.valor);
                if(maxPts > 0) {
                    nota = ((ptsObtenidos / maxPts) * 100).toFixed(2);
                    valPorcNum = ((ptsObtenidos / maxPts) * valPorc);
                    porc = valPorcNum.toFixed(2);
                }
                let porc1 = 0, porc2 = 0;
                if(tNumero === 1) porc1 = valPorcNum;
                else if(t1.notas[est.nombre] !== undefined && parseFloat(t1.config.puntos) > 0) porc1 = (parseFloat(t1.notas[est.nombre]) / parseFloat(t1.config.puntos)) * parseFloat(t1.config.valor);
                if(tNumero === 2) porc2 = valPorcNum;
                else if(t2.notas[est.nombre] !== undefined && parseFloat(t2.config.puntos) > 0) porc2 = (parseFloat(t2.notas[est.nombre]) / parseFloat(t2.config.puntos)) * parseFloat(t2.config.valor);
                let totalAcumulado = porc1 + (t2Activa ? porc2 : 0);

                tbody.innerHTML += `<tr>
                    <td>${index+1}</td>
                    <td style="text-align:left; font-weight:bold;">${est.nombre}</td>
                    <td><input type="number" class="input-puntos" value="${ptsObtenidos}" oninput="calcularFilaTarea(this)" data-nombre="${est.nombre}"></td>
                    <td class="td-nota-t" style="${maxPts > 0 && (ptsObtenidos/maxPts*100) < 65 ? 'color:red' : 'color:black'}">${nota}</td>
                    <td class="td-porc-t" style="font-weight:bold; color:var(--mep-purple)">${porc}</td>
                    <td class="td-acumulado-t" style="font-weight:bold;">${totalAcumulado.toFixed(2)}%</td>
                    <td>
                        <button class="btn-pdf-mini" style="background:var(--mep-purple)" onclick="generarPDFTareas('${est.nombre}')">PDF</button>
                        <button class="btn-reset-mini" onclick="resetearEstudianteTotalTarea('${est.nombre}')">RESET</button>
                    </td>
                </tr>`;
            }
        });
    }

    function recalcularTablaTareas() {
        const filas = document.querySelectorAll('#cuerpoTablaTareas tr');
        filas.forEach(tr => { calcularFilaTarea(tr.querySelector('.input-puntos')); });
    }

    function calcularFilaTarea(input) {
        const tr = input.closest('tr');
        const pts = parseFloat(input.value);
        const maxPts = parseFloat(document.getElementById('configPuntosTarea').value);
        const valPorc = parseFloat(document.getElementById('configValorTarea').value);
        const activarT2 = document.getElementById('checkActivarT2').checked;
        const nombre = input.dataset.nombre;
        const tdNota = tr.querySelector('.td-nota-t');
        const tdPorc = tr.querySelector('.td-porc-t');
        const tdAcum = tr.querySelector('.td-acumulado-t');
        let porcentajeActual = 0;
        if (!isNaN(pts) && maxPts > 0) {
            const nota = (pts / maxPts) * 100;
            porcentajeActual = (pts / maxPts) * valPorc;
            tdNota.innerText = nota.toFixed(2);
            tdPorc.innerText = porcentajeActual.toFixed(2);
            tdNota.style.color = (nota < 65) ? "red" : "black";
        } else {
            tdNota.innerText = "0.00"; tdPorc.innerText = "0.00"; porcentajeActual = 0; tdNota.style.color = "red";
        }
        let otroPorc = 0;
        let otherNum = tNumero === 1 ? 2 : 1;
        const otherData = dbTareas[tMateria][tPeriodo][`t${otherNum}`];
        if(otherData && otherData.notas[nombre] !== undefined && parseFloat(otherData.config.puntos) > 0) {
            otroPorc = (parseFloat(otherData.notas[nombre]) / parseFloat(otherData.config.puntos)) * parseFloat(otherData.config.valor);
        }
        let total = (tNumero === 1) ? (porcentajeActual + (activarT2 ? otroPorc : 0)) : (otroPorc + (activarT2 ? porcentajeActual : 0));
        tdAcum.innerText = total.toFixed(2) + "%";
    }

    function guardarNotasTarea() {
        const val = parseFloat(document.getElementById('configValorTarea').value) || 0;
        const pts = parseFloat(document.getElementById('configPuntosTarea').value) || 0;
        const t2Activa = document.getElementById('checkActivarT2').checked;
        dbTareas[tMateria][tPeriodo][`t${tNumero}`].config = { valor: val, puntos: pts };
        if(!dbTareas[tMateria][tPeriodo].settings) dbTareas[tMateria][tPeriodo].settings = {};
        dbTareas[tMateria][tPeriodo].settings.t2Activa = t2Activa;
        const inputs = document.querySelectorAll('#cuerpoTablaTareas .input-puntos');
        let notasObj = {};
        inputs.forEach(i => { let v = parseFloat(i.value); if(isNaN(v)) v = 0; notasObj[i.dataset.nombre] = v; });
        dbTareas[tMateria][tPeriodo][`t${tNumero}`].notas = notasObj;
        localStorage.setItem('mep_db_tareas', JSON.stringify(dbTareas));
        alert("Tareas guardadas.");
        cargarDatosTarea();
    }

    function resetearTablaActualTarea() {
        if(!confirm("¬øBorrar notas de ESTA tarea?")) return;
        const inputs = document.querySelectorAll('#cuerpoTablaTareas .input-puntos');
        inputs.forEach(inp => inp.value = "0");
        dbTareas[tMateria][tPeriodo][`t${tNumero}`].notas = {};
        guardarNotasTarea();
    }

    function resetearEstudianteTotalTarea(nombre) {
        if(!confirm(`¬øBorrar TODAS las tareas de ${nombre}?`)) return;
        ["Espa√±ol", "Matem√°ticas", "Estudios Sociales", "Ciencias"].forEach(m => {
            if(dbTareas[m]) ["I", "II"].forEach(p => {
                if(dbTareas[m][p]) ["t1", "t2"].forEach(tr => {
                    if(dbTareas[m][p][tr]?.notas) delete dbTareas[m][p][tr].notas[nombre];
                });
            });
        });
        localStorage.setItem('mep_db_tareas', JSON.stringify(dbTareas));
        alert("Borrado.");
        cargarDatosTarea();
    }

    function generarPDFTareas(nombreEstudiante) {
        if (!ensureJsPDFLoaded()) return;
        const doc = new jsPDF();
        const y0 = drawPDFHeader(doc);

        const periodo = tPeriodo;
        doc.setFontSize(16); 
        doc.text("Informe de Calificaciones - Componente Tareas", 14, y0);

        doc.setFontSize(12); 
        doc.text(`Estudiante: ${nombreEstudiante}`, 14, y0 + 10); 
        doc.text(`Periodo: ${periodo}`, 14, y0 + 18);

        const materias = ["Espa√±ol", "Matem√°ticas", "Estudios Sociales", "Ciencias"];
        const filas = [];
        materias.forEach(mat => {
            let t1Txt="-", t2Txt="-", total=0, t1Val=0, t2Val=0;
            if(dbTareas[mat] && dbTareas[mat][periodo]) {
                const d1 = dbTareas[mat][periodo].t1;
                if(d1 && d1.notas[nombreEstudiante]!==undefined && d1.config.puntos>0) {
                    const raw = d1.notas[nombreEstudiante];
                    t1Val = (raw/d1.config.puntos)*d1.config.valor;
                    t1Txt = `${((raw/d1.config.puntos)*100).toFixed(2)} (${t1Val.toFixed(2)}%)`;
                }
                const d2 = dbTareas[mat][periodo].t2;
                if(d2 && d2.notas[nombreEstudiante]!==undefined && d2.config.puntos>0) {
                    const raw = d2.notas[nombreEstudiante];
                    t2Val = (raw/d2.config.puntos)*d2.config.valor;
                    t2Txt = `${((raw/d2.config.puntos)*100).toFixed(2)} (${t2Val.toFixed(2)}%)`;
                }
                const sets = dbTareas[mat][periodo].settings || {t2Activa:false};
                total = t1Val + (sets.t2Activa?t2Val:0);
            }
            filas.push([mat, t1Txt, t2Txt, total.toFixed(2)+"%"]);
        });

        doc.autoTable({ startY: y0 + 25, head: [['Materia', 'I Tarea', 'II Tarea', 'Total']], body: filas });
        doc.save(`Notas_Tareas_${nombreEstudiante}.pdf`);
    }

    /* ============================================================
       ‚úÖ L√ìGICA COTIDIANO (Indicadores 1-3) ‚Äî VISTAS + SIN PREDETERMINADOS
       ============================================================ */
    function getDefaultIndicadoresCotidiano(materia) {
        // IMPORTANTE: SIN indicadores predeterminados (como pidi√≥ el usuario).
        return [];
    }

    function ensureCotidianoDB() {
        if (!dbCotidiano[cMateria]) dbCotidiano[cMateria] = {};
        if (!dbCotidiano[cMateria][cPeriodo]) {
            dbCotidiano[cMateria][cPeriodo] = {
                config: {
                    valor: 60, // I Ciclo por defecto
                    indicadores: getDefaultIndicadoresCotidiano(cMateria)
                },
                // notas: { "Nombre": { "Indicador": 1|2|3 } }
                notas: {}
            };
        }

        const dataCoti = dbCotidiano[cMateria][cPeriodo];

        if (!dataCoti.config) dataCoti.config = { valor: 60, indicadores: [] };
        if (typeof dataCoti.config.valor !== "number") dataCoti.config.valor = parseFloat(dataCoti.config.valor) || 60;

        if (!Array.isArray(dataCoti.config.indicadores)) dataCoti.config.indicadores = [];

        // Normalizamos textos (trim) y eliminamos vac√≠os
        dataCoti.config.indicadores = dataCoti.config.indicadores
            .map(x => (x || "").toString().trim())
            .filter(x => x.length > 0);

        // ‚úÖ Limpieza autom√°tica: si ven√≠a de una versi√≥n vieja con indicadores ‚Äúde ejemplo‚Äù
        // (solo se elimina si NO hay notas registradas a√∫n)
        const _oldDefaults = ["Lectura/Comprensi√≥n", "Escritura", "Participaci√≥n"];
        const _hasOldDefaults =
            dataCoti.config.indicadores.length === _oldDefaults.length &&
            dataCoti.config.indicadores.every((x, i) => x.toLowerCase() === _oldDefaults[i].toLowerCase());

        const _noNotas = !dataCoti.notas || Object.keys(dataCoti.notas).length === 0;

        if (_hasOldDefaults && _noNotas) {
            dataCoti.config.indicadores = [];
        }


        if (!dataCoti.notas || typeof dataCoti.notas !== "object") dataCoti.notas = {};

        // ‚úÖ Migraci√≥n de formatos viejos:
        // - Si guardaba un n√∫mero 1-100
        // - Si guardaba array [1..3] por √≠ndice del indicador
        Object.keys(dataCoti.notas).forEach(nombre => {
            const stored = dataCoti.notas[nombre];

            // Caso 1: n√∫mero 1-100 (viejo)
            if (typeof stored === "number") {
                // Convertimos a 1-3 "aproximado" y lo aplicamos a todos los indicadores actuales
                const score = Math.max(1, Math.min(3, Math.round((stored / 100) * 3)));
                const obj = {};
                (dataCoti.config.indicadores || []).forEach(ind => { obj[ind] = score; });
                dataCoti.notas[nombre] = obj;
                return;
            }

            // Caso 2: array viejo (por √≠ndice)
            if (Array.isArray(stored)) {
                const obj = {};
                (dataCoti.config.indicadores || []).forEach((ind, i) => {
                    const v = parseInt(stored[i] || 0, 10);
                    if (v >= 1 && v <= 3) obj[ind] = v;
                });
                dataCoti.notas[nombre] = obj;
                return;
            }

            // Caso 3: ya es objeto => ok
            if (stored && typeof stored === "object") return;

            dataCoti.notas[nombre] = {};
        });
    }

    function persistCotidiano() {
        localStorage.setItem("mep_db_cotidiano", JSON.stringify(dbCotidiano));
    }

    let cVista = "indicadores"; // 'indicadores' | 'resumen'

    function setVistaCotidiano(v) {
        cVista = v;

        const pInd = document.getElementById('panelCotidianoIndicadores');
        const pRes = document.getElementById('panelCotidianoResumen');
        const bInd = document.getElementById('btnCotiViewIndicadores');
        const bRes = document.getElementById('btnCotiViewResumen');

        if (!pInd || !pRes || !bInd || !bRes) return;

        if (v === "indicadores") {
            pInd.classList.remove("hidden");
            pRes.classList.add("hidden");
            bInd.classList.add("active");
            bRes.classList.remove("active");

            // Refrescar lista principal
            renderTablaCotidianoLista();
        } else {
            pInd.classList.add("hidden");
            pRes.classList.remove("hidden");
            bInd.classList.remove("active");
            bRes.classList.add("active");
            renderResumenCotidiano();
        }
    }

    function selMateriaCotidiano(m, btn) {
        cMateria = m;
        document.querySelectorAll('#menuMateriaCotidiano .btn-subnav').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        cargarDatosCotidiano();
    }

    function selPeriodoCotidiano(p, btn) {
        cPeriodo = p;
        document.querySelectorAll('#menuPeriodoCotidiano .btn-subnav').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        cargarDatosCotidiano();
    }

    // AUTOM√ÅTICO (sin editar a mano): ciclo 1 = 60%, ciclo 2 = 50%
    function configurarCicloCotidiano(ciclo) {
        ensureCotidianoDB();
        const dataCoti = dbCotidiano[cMateria][cPeriodo];
        const val = (ciclo === 1) ? 60 : 50;

        dataCoti.config.valor = val;

        const inp = document.getElementById('configValorCotidiano');
        if (inp) inp.value = val;

        persistCotidiano();
        recalcularCotidianoUI();
    }

    function agregarIndicadorCotidiano() {
        ensureCotidianoDB();
        const dataCoti = dbCotidiano[cMateria][cPeriodo];

        const inp = document.getElementById('inputNuevoIndicador');
        const nombre = (inp && inp.value ? inp.value : "").trim();
        if (!nombre) return;

        const exists = dataCoti.config.indicadores.some(x => (x || "").toLowerCase() === nombre.toLowerCase());
        if (!exists) dataCoti.config.indicadores.push(nombre);

        if (inp) inp.value = "";
        persistCotidiano();
        cargarDatosCotidiano();
    }

    function eliminarIndicadorCotidiano(nombreIndicador) {
        ensureCotidianoDB();
        const dataCoti = dbCotidiano[cMateria][cPeriodo];

        dataCoti.config.indicadores = dataCoti.config.indicadores.filter(x => x !== nombreIndicador);

        // eliminar del objeto de notas
        Object.keys(dataCoti.notas || {}).forEach(est => {
            if (dataCoti.notas[est] && typeof dataCoti.notas[est] === "object") {
                delete dataCoti.notas[est][nombreIndicador];
            }
        });

        persistCotidiano();
        cargarDatosCotidiano();
    }

    function renderChipsIndicadoresCotidiano() {
        const wrap = document.getElementById('chipsIndicadoresCotidiano');
        if (!wrap) return;

        ensureCotidianoDB();
        const dataCoti = dbCotidiano[cMateria][cPeriodo];

        wrap.innerHTML = "";
        (dataCoti.config.indicadores || []).forEach(ind => {
            const chip = document.createElement('div');
            chip.className = "indicator-chip";
            chip.innerHTML = `
                <span>${ind}</span>
                <button class="chip-x" title="Eliminar" onclick='eliminarIndicadorCotidiano(${JSON.stringify(ind)})'>√ó</button>
            `;
            wrap.appendChild(chip);
        });
    }

    function calcCotidianoMetrics(nombreEstudiante) {
        ensureCotidianoDB();
        const dataCoti = dbCotidiano[cMateria][cPeriodo];

        const valorMax = parseFloat(dataCoti.config.valor || 0);
        const indicadores = dataCoti.config.indicadores || [];

        const obj = (dataCoti.notas && dataCoti.notas[nombreEstudiante] && typeof dataCoti.notas[nombreEstudiante] === "object")
            ? dataCoti.notas[nombreEstudiante]
            : {};

        const vals = [];
        indicadores.forEach(ind => {
            const v = parseInt(obj[ind] || 0, 10);
            if (v >= 1 && v <= 3) vals.push(v);
        });

        const prom3 = vals.length ? (vals.reduce((a,b)=>a+b,0) / vals.length) : 0;
        const nota100 = (prom3 / 3) * 100;
        const porc = (nota100 / 100) * valorMax;

        return {
            prom3: isFinite(prom3) ? prom3 : 0,
            nota100: isFinite(nota100) ? nota100 : 0,
            porc: isFinite(porc) ? porc : 0,
            valorMax
        };
    }

    function buildSelectIndicador(currentVal, nombre, indicador) {
        const v = parseInt(currentVal || 0, 10);
        const s0 = (v === 0) ? "selected" : "";
        const s1 = (v === 1) ? "selected" : "";
        const s2 = (v === 2) ? "selected" : "";
        const s3 = (v === 3) ? "selected" : "";
        return `
            <select class="select-coti-ind" data-nombre="${nombre}" data-indicador="${indicador}" onchange="onChangeIndicadorCotidiano(this)">
                <option value="0" ${s0}>‚Äî</option>
                <option value="1" ${s1}>1</option>
                <option value="2" ${s2}>2</option>
                <option value="3" ${s3}>3</option>
            </select>
        `;
    }

        // ===== COTIDIANO: VISTA LIMPIA (TABLA + MODAL) =====
    let cotiEvalNombreActual = null;

    function toggleConfigIndicadoresCotidiano() {
        const box = document.getElementById('configIndicadoresCotidiano');
        if (!box) return;

        const wasHidden = box.classList.contains('hidden');
        box.classList.toggle('hidden');

        // Si se est√° abriendo, refrescamos la lista de indicadores para que siempre est√© al d√≠a.
        if (wasHidden) {
            try { renderChipsIndicadoresCotidiano(); } catch (e) {}
            const inp = document.getElementById('inputNuevoIndicador');
            if (inp) setTimeout(() => inp.focus(), 0);
        }
    }

    function escapeHTML(str) {
        return String(str)
            .replace(/&/g, "&amp;")
            .replace(/</g, "&lt;")
            .replace(/>/g, "&gt;")
            .replace(/"/g, "&quot;")
            .replace(/'/g, "&#039;");
    }

    function calcCotidianoProgress(nombre) {
        ensureCotidianoDB();
        const dataCoti = dbCotidiano[cMateria][cPeriodo];
        const indicadores = dataCoti.config.indicadores || [];
        const total = indicadores.length;

        if (!dataCoti.notas[nombre] || typeof dataCoti.notas[nombre] !== "object") dataCoti.notas[nombre] = {};
        const obj = dataCoti.notas[nombre];

        let done = 0;
        indicadores.forEach(ind => {
            const v = parseInt(obj[ind] || 0, 10);
            if (v >= 1 && v <= 3) done++;
        });

        const pct = total ? (done / total) * 100 : 0;
        return { done, total, pct };
    }

    function renderTablaCotidianoLista() {
        const tbody = document.getElementById('listaCotidiano');
        const emptyHint = document.getElementById('cotidianoEmptyHint');
        const configBox = document.getElementById('configIndicadoresCotidiano');

        if (!tbody || !emptyHint) return;

        ensureCotidianoDB();
        const dataCoti = dbCotidiano[cMateria][cPeriodo];
        const indicadores = dataCoti.config.indicadores || [];

        // Si no hay indicadores, mostramos el aviso
        emptyHint.style.display = (indicadores.length === 0) ? "block" : "none";

        tbody.innerHTML = "";

        const estudiantes = JSON.parse(localStorage.getItem('mep_estudiantes_v2')) || [];
        let idx = 0;

        estudiantes.forEach(est => {
            const nombre = (est.nombre || "").trim();
            if (!nombre) return;
            idx++;

            if (!dataCoti.notas[nombre] || typeof dataCoti.notas[nombre] !== "object") dataCoti.notas[nombre] = {};

            const pr = calcCotidianoProgress(nombre);

            const tr = document.createElement('tr');
            tr.dataset.nombre = nombre;

            tr.innerHTML = `
                <td>${idx}</td>
                <td style="text-align:left;">
                    <button type="button" class="btn-link-st" onclick='abrirEvaluacionCotidiano(${JSON.stringify(nombre)})' title="Abrir evaluaci√≥n">
                        ${escapeHTML(nombre)}
                    </button>
                </td>
                <td>
                    <div class="coti-progress-wrap">
                        <div class="progress-bar">
                            <div class="progress-fill" style="width:${pr.pct}%;"></div>
                        </div>
                        <small>${pr.done} de ${pr.total}</small>
                    </div>
                </td>
                <td>
                    <button type="button" class="btn-teal" onclick='abrirEvaluacionCotidiano(${JSON.stringify(nombre)})'>Evaluar</button>
                    <button type="button" class="btn-pdf-mini" style="background:var(--mep-teal)" onclick='generarPDFCotidiano(${JSON.stringify(nombre)})'>PDF</button>
                </td>
            `;
            tbody.appendChild(tr);
        });

        persistCotidiano();
    }

    function actualizarFilaProgresoCotidiano(nombre) {
        const tbody = document.getElementById('listaCotidiano');
        if (!tbody) return;

        const tr = tbody.querySelector(`tr[data-nombre="${CSS.escape(nombre)}"]`);
        if (!tr) return;

        const pr = calcCotidianoProgress(nombre);
        const fill = tr.querySelector('.progress-fill');
        const small = tr.querySelector('small');

        if (fill) fill.style.width = pr.pct + "%";
        if (small) small.textContent = `${pr.done} de ${pr.total}`;
    }

    function actualizarSubtituloEvalCoti(nombreEstudiante) {
        const subt = document.getElementById('subtituloEvalCoti');
        if (!subt) return;

        const pr = calcCotidianoProgress(nombreEstudiante);
        subt.textContent = `${pr.done} de ${pr.total} indicadores evaluados`;
    }

    function abrirEvaluacionCotidiano(nombreEstudiante) {
        ensureCotidianoDB();
        const dataCoti = dbCotidiano[cMateria][cPeriodo];
        const indicadores = dataCoti.config.indicadores || [];

        const modal = document.getElementById('modalEvaluacionCoti');
        const cont = document.getElementById('contenedorIndicadoresEvalCoti');
        const titulo = document.getElementById('nombreEstudianteEvalCoti');
        const configBox = document.getElementById('configIndicadoresCotidiano');

        if (!modal || !cont || !titulo) return;

        if (indicadores.length === 0) {
            alert("Primero debe configurar al menos un indicador.");
            if (configBox) configBox.classList.remove('hidden');
            return;
        }

        if (!dataCoti.notas[nombreEstudiante] || typeof dataCoti.notas[nombreEstudiante] !== "object") dataCoti.notas[nombreEstudiante] = {};

        cotiEvalNombreActual = nombreEstudiante;
        titulo.innerText = `Evaluando a: ${nombreEstudiante}`;

        cont.innerHTML = "";

        indicadores.forEach((ind, i) => {
            const v = parseInt(dataCoti.notas[nombreEstudiante][ind] || 0, 10);

            const item = document.createElement('div');
            item.className = "indicador-item";

            const p = document.createElement('p');
            p.className = "indicador-text";
            p.innerHTML = `<strong>${i + 1}.</strong> ${escapeHTML(ind)}`;
            item.appendChild(p);

            const opts = document.createElement('div');
            opts.className = "opciones-eval";

            const mkBtn = (val, label) => {
                const b = document.createElement('button');
                b.className = `btn-opt btn-opt-${val}` + (v === val ? " active" : "");
                b.textContent = label;
                b.onclick = () => setNotaCotidianoModal(nombreEstudiante, ind, val, b);
                return b;
            };

            opts.appendChild(mkBtn(1, "Inicial"));
            opts.appendChild(mkBtn(2, "Intermedio"));
            opts.appendChild(mkBtn(3, "Avanzado"));

            item.appendChild(opts);
            cont.appendChild(item);
        });

        actualizarSubtituloEvalCoti(nombreEstudiante);

        modal.classList.remove("hidden");
        document.body.classList.add("modal-open");

        // Cerrar si se toca afuera
        modal.onclick = (e) => { if (e.target === modal) cerrarModalEvalCoti(); };
    }

    function setNotaCotidianoModal(nombre, indicador, val, btnEl) {
        ensureCotidianoDB();
        const dataCoti = dbCotidiano[cMateria][cPeriodo];

        if (!dataCoti.notas[nombre] || typeof dataCoti.notas[nombre] !== "object") dataCoti.notas[nombre] = {};

        const current = parseInt(dataCoti.notas[nombre][indicador] || 0, 10);

        // Si presiona el mismo nivel, lo desmarca (permite corregir)
        if (current === val) {
            delete dataCoti.notas[nombre][indicador];
        } else {
            dataCoti.notas[nombre][indicador] = val;
        }

        persistCotidiano();

        // UI: actualizar botones activos
        const cont = btnEl && btnEl.parentElement;
        if (cont) {
            cont.querySelectorAll('.btn-opt').forEach(b => b.classList.remove('active'));
            if (current !== val) btnEl.classList.add('active');
        }

        actualizarFilaProgresoCotidiano(nombre);
        actualizarSubtituloEvalCoti(nombre);

        if (cVista === "resumen") renderResumenCotidiano();
    }

    function cerrarModalEvalCoti() {
        const modal = document.getElementById('modalEvaluacionCoti');
        if (modal) modal.classList.add('hidden');
        document.body.classList.remove('modal-open');

        // Refrescar la tabla principal
        renderTablaCotidianoLista();
    }

    // ESC para cerrar modal
    document.addEventListener('keydown', function (e) {
        if (e.key === "Escape") {
            const modal = document.getElementById('modalEvaluacionCoti');
            if (modal && !modal.classList.contains('hidden')) cerrarModalEvalCoti();
        }
    });

    function renderCardsCotidiano() {
        // Compatibilidad: la vista principal ahora es tabla + modal
        return renderTablaCotidianoLista();

ensureCotidianoDB();
        const dataCoti = dbCotidiano[cMateria][cPeriodo];
        const indicadores = dataCoti.config.indicadores || [];

        cont.innerHTML = "";
        emptyHint.style.display = (indicadores.length === 0) ? "block" : "none";

        const estudiantes = JSON.parse(localStorage.getItem('mep_estudiantes_v2')) || [];
        let num = 0;

        estudiantes.forEach(est => {
            const nombre = (est.nombre || "").trim();
            if (!nombre) return;
            num++;

            if (!dataCoti.notas[nombre] || typeof dataCoti.notas[nombre] !== "object") dataCoti.notas[nombre] = {};

            const metrics = calcCotidianoMetrics(nombre);

            const card = document.createElement('div');
            card.className = "cotidiano-card";

            card.innerHTML = `
                <div class="cotidiano-card-header">
                    <div class="cotidiano-card-title">
                        <span class="num-lista">${num}</span>
                        <span class="cotidiano-st-name" title="${nombre}">${nombre}</span>
                    </div>
                    <button class="btn-pdf-mini" style="background:var(--mep-teal)" onclick='generarPDFCotidiano(${JSON.stringify(nombre)})'>PDF</button>
                </div>
            `;

            const table = document.createElement('table');
            table.className = "cotidiano-ind-table";
            table.innerHTML = `
                <thead><tr><th>Indicador</th><th>Evaluaci√≥n (1-3)</th></tr></thead>
                <tbody></tbody>
            `;
            const tb = table.querySelector('tbody');

            indicadores.forEach(ind => {
                const currentVal = dataCoti.notas[nombre][ind] || 0;
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${ind}</td>
                    <td>${buildSelectIndicador(currentVal, nombre, ind)}</td>
                `;
                tb.appendChild(tr);
            });

            // resumen (vertical, debajo)
            const trProm = document.createElement('tr');
            trProm.className = "cotidiano-summary-row";
            trProm.innerHTML = `<td>Prom. (1-3)</td><td class="cotidiano-metric c-prom" data-nombre="${nombre}">${metrics.prom3.toFixed(2)}</td>`;
            tb.appendChild(trProm);

            const trNota = document.createElement('tr');
            trNota.className = "cotidiano-summary-row";
            trNota.innerHTML = `<td>Nota (1-100)</td><td class="cotidiano-metric c-nota" data-nombre="${nombre}">${metrics.nota100.toFixed(2)}</td>`;
            tb.appendChild(trNota);

            const trPorc = document.createElement('tr');
            trPorc.className = "cotidiano-summary-row";
            trPorc.innerHTML = `<td>Porcentaje</td><td class="cotidiano-metric porc c-porc" data-nombre="${nombre}">${metrics.porc.toFixed(2)}%</td>`;
            tb.appendChild(trPorc);

            card.appendChild(table);
            cont.appendChild(card);
        });

        persistCotidiano();
    }

    function onChangeIndicadorCotidiano(sel) {
        ensureCotidianoDB();
        const dataCoti = dbCotidiano[cMateria][cPeriodo];

        const nombre = sel.dataset.nombre;
        const indicador = sel.dataset.indicador;
        const v = parseInt(sel.value || "0", 10);

        if (!dataCoti.notas[nombre] || typeof dataCoti.notas[nombre] !== "object") dataCoti.notas[nombre] = {};
        if (v >= 1 && v <= 3) dataCoti.notas[nombre][indicador] = v;
        else delete dataCoti.notas[nombre][indicador];

        persistCotidiano();

        const metrics = calcCotidianoMetrics(nombre);

        const promEl = document.querySelector(`.c-prom[data-nombre="${CSS.escape(nombre)}"]`);
        const notaEl = document.querySelector(`.c-nota[data-nombre="${CSS.escape(nombre)}"]`);
        const porcEl = document.querySelector(`.c-porc[data-nombre="${CSS.escape(nombre)}"]`);
        if (promEl) promEl.innerText = metrics.prom3.toFixed(2);
        if (notaEl) notaEl.innerText = metrics.nota100.toFixed(2);
        if (porcEl) porcEl.innerText = metrics.porc.toFixed(2) + "%";

        if (cVista === "resumen") renderResumenCotidiano();
    }

    function renderResumenCotidiano() {
        const tbody = document.getElementById('cuerpoTablaCotidianoResumen');
        if (!tbody) return;

        ensureCotidianoDB();
        const estudiantes = JSON.parse(localStorage.getItem('mep_estudiantes_v2')) || [];
        tbody.innerHTML = "";

        let idx = 0;
        estudiantes.forEach(est => {
            const nombre = (est.nombre || "").trim();
            if (!nombre) return;
            idx++;

            const m = calcCotidianoMetrics(nombre);

            const tr = document.createElement('tr');
            tr.innerHTML = `
                <td>${idx}</td>
                <td style="text-align:left; font-weight:bold;">${nombre}</td>
                <td style="font-weight:bold;">${m.prom3.toFixed(2)}</td>
                <td style="font-weight:bold; ${m.nota100 < 65 ? 'color:red' : 'color:black'}">${m.nota100.toFixed(2)}</td>
                <td style="font-weight:bold; color:var(--mep-teal);">${m.porc.toFixed(2)}%</td>
                <td><button class="btn-pdf-mini" style="background:var(--mep-teal)" onclick='generarPDFCotidiano(${JSON.stringify(nombre)})'>PDF</button></td>
            `;
            tbody.appendChild(tr);
        });
    }

    function recalcularCotidianoUI() {
        renderChipsIndicadoresCotidiano();
        renderTablaCotidianoLista();
        if (cVista === "resumen") renderResumenCotidiano();
    }

    function cargarDatosCotidiano() {
        ensureCotidianoDB();
        const dataCoti = dbCotidiano[cMateria][cPeriodo];

        document.getElementById('tituloTablaCotidiano').innerText = `${cMateria} - ${cPeriodo} Periodo - Cotidiano`;

        const inp = document.getElementById('configValorCotidiano');
        if (inp) inp.value = dataCoti.config.valor;

        renderChipsIndicadoresCotidiano();
        renderTablaCotidianoLista();

        // Mantener vista actual
        setVistaCotidiano(cVista);
    }

    function guardarNotasCotidiano() {
        // Ya se guarda con persistCotidiano() autom√°ticamente, pero se deja el bot√≥n por UX.
        ensureCotidianoDB();
        persistCotidiano();
        alert("Cotidiano guardado.");
        cargarDatosCotidiano();
    }

    function resetearTablaActualCotidiano() {
        if (!confirm("¬øBorrar indicadores y evaluaciones de Cotidiano de esta materia/periodo?")) return;

        ensureCotidianoDB();
        dbCotidiano[cMateria][cPeriodo].config.indicadores = [];
        dbCotidiano[cMateria][cPeriodo].notas = {};
        persistCotidiano();

        alert("Cotidiano reiniciado.");
        cargarDatosCotidiano();
    }

    // PDF: SOLO la materia actual, con indicadores hacia abajo (como pidi√≥ el usuario).
    function generarPDFCotidiano(nombreEstudiante) {
        ensureCotidianoDB();
        if (!ensureJsPDFLoaded()) return;
        const doc = new jsPDF();
        const y0 = drawPDFHeader(doc);

        const dataCoti = dbCotidiano[cMateria][cPeriodo];
        const valorMax = parseFloat(dataCoti.config.valor || 0);

        doc.setFontSize(16);
        doc.text("Informe de Calificaciones - Trabajo Cotidiano", 14, y0);

        doc.setFontSize(12);
        doc.text(`Estudiante: ${nombreEstudiante}`, 14, y0 + 10);
        doc.text(`Materia: ${cMateria}`, 14, y0 + 18);
        doc.text(`Periodo Lectivo: ${cPeriodo}`, 14, y0 + 26);
        doc.text(`Valor porcentual total: ${valorMax}%`, 14, y0 + 34);

        const indicadores = dataCoti.config.indicadores || [];
        const obj = (dataCoti.notas && dataCoti.notas[nombreEstudiante] && typeof dataCoti.notas[nombreEstudiante] === "object")
            ? dataCoti.notas[nombreEstudiante]
            : {};

        const filas = [];
        indicadores.forEach(ind => {
            const v = obj[ind] ? obj[ind] : "-";
            filas.push([ind, v]);
        });
        if (filas.length === 0) filas.push(["-", "-"]);

        const m = calcCotidianoMetrics(nombreEstudiante);

        let yBase = y0 + 42;
        const startYTable = y0 + 42;

        if (typeof doc.autoTable === "function") {
            doc.autoTable({
                startY: startYTable,
                head: [["Indicador", "Evaluaci√≥n (1-3)"]],
                body: filas,
                headStyles: { fillColor: [22, 160, 133] }
            });
            yBase = (doc.lastAutoTable && doc.lastAutoTable.finalY) ? doc.lastAutoTable.finalY + 10 : (startYTable + 40);
        } else {
            // Fallback sin autoTable: lista vertical con salto de p√°gina si es necesario.
            doc.setFontSize(11);
            let y = startYTable;
            if (indicadores.length === 0) {
                doc.text("-", 14, y);
                y += 10;
            } else {
                indicadores.forEach((ind, idx) => {
                    const v = obj[ind] ? obj[ind] : "-";
                    const line = `${idx + 1}. ${ind}  ‚Äî  ${v}`;
                    const lines = (typeof doc.splitTextToSize === "function") ? doc.splitTextToSize(line, 180) : [line];
                    doc.text(lines, 14, y);
                    y += (lines.length * 6) + 2;
                    if (y > 270) { doc.addPage(); y = 20; }
                });
            }
            yBase = y + 10;
        }

        doc.setFontSize(12);
        doc.text(`Promedio (1-3): ${m.prom3.toFixed(2)}`, 14, yBase);
        doc.text(`Nota (1-100): ${m.nota100.toFixed(2)}`, 14, yBase + 8);
        doc.text(`Porcentaje obtenido: ${m.porc.toFixed(2)}%`, 14, yBase + 16);

        doc.save(`Cotidiano_${cMateria}_${cPeriodo}_${nombreEstudiante}.pdf`);
    }

    // Enter = agregar indicador
    document.addEventListener('keydown', function(e){
        const el = document.getElementById('inputNuevoIndicador');
        if(!el) return;
        if(document.activeElement === el && e.key === 'Enter') { e.preventDefault(); agregarIndicadorCotidiano(); }
    });

    // --- FUNCIONES HORARIO ---

    function renderizarHorario() {
        const j = document.getElementById('jornadaHorario').value;
        const cont = document.getElementById('contenedorTablaHorario');
        let html = `<table><thead><tr><th>Horario</th><th>Lunes</th><th>Martes</th><th>Mi√©rcoles</th><th>Jueves</th><th>Viernes</th></tr></thead><tbody>`;
        horariosData[j].forEach((f, idx) => {
            html += `<tr data-row="${idx}">
                <td contenteditable="true" class="editable-cell">${f.h}</td>
                <td contenteditable="true" class="editable-cell ${f.c[0]}">${f.lun}</td>
                <td contenteditable="true" class="editable-cell ${f.c[1]}">${f.mar}</td>
                <td contenteditable="true" class="editable-cell ${f.c[2]}">${f.mie}</td>
                <td contenteditable="true" class="editable-cell ${f.c[3]}">${f.jue}</td>
                <td contenteditable="true" class="editable-cell ${f.c[4]}">${f.vie}</td>
            </tr>`;
        });
        cont.innerHTML = html + `</tbody></table>`;
        const tituloGuardado = localStorage.getItem('mep_titulo_horario');
        if(tituloGuardado) document.getElementById('tituloHorario').innerText = tituloGuardado;
    }

    function capturarCambiosHorario() {
        const j = document.getElementById('jornadaHorario').value;
        const filas = document.querySelectorAll('#contenedorTablaHorario tbody tr');
        horariosData[j] = Array.from(filas).map(tr => {
            const tds = tr.querySelectorAll('td');
            return {
                h: tds[0].innerText,
                lun: tds[1].innerText,
                mar: tds[2].innerText,
                mie: tds[3].innerText,
                jue: tds[4].innerText,
                vie: tds[5].innerText,
                c: [tds[1].className, tds[2].className, tds[3].className, tds[4].className, tds[5].className]
            };
        });
        localStorage.setItem('mep_horario_custom', JSON.stringify(horariosData));
        mostrarIndicadorGuardado();
    }

    function guardarTitulo() {
        localStorage.setItem('mep_titulo_horario', document.getElementById('tituloHorario').innerText);
        mostrarIndicadorGuardado();
    }

    function mostrarIndicadorGuardado() {
        const ind = document.getElementById('saveIndicator');
        ind.style.opacity = "1";
        setTimeout(() => ind.style.opacity = "0", 2000);
    }

    // --- ASISTENCIA (sin cambios) ---
    function actualizarAsistencia() {
        const fechaVal = document.getElementById('fechaAsistencia').value;
        if(!fechaVal) return;
        const fecha = new Date(fechaVal + 'T00:00:00');
        let dIdx = fecha.getDay() - 1; if(dIdx < 0 || dIdx > 4) dIdx = 0;
        const j = document.getElementById('jornadaAsistencia').value;
        const datosGuardados = dbDiaria[fechaVal] ? dbDiaria[fechaVal].datos : {};
        const selPeriodo = document.getElementById('periodoAsistencia');
        if (fechaVal >= fechasMEP.I.inicio && fechaVal <= fechasMEP.I.fin) selPeriodo.value = "I";
        else if (fechaVal >= fechasMEP.II.inicio && fechaVal <= fechasMEP.II.fin) selPeriodo.value = "II";

        const materiasNombres = [];
        horariosData[j].forEach(fila => {
            let materia = "";
            if(dIdx===0) materia = fila.lun; else if(dIdx===1) materia = fila.mar; else if(dIdx===2) materia = fila.mie; else if(dIdx===3) materia = fila.jue; else if(dIdx===4) materia = fila.vie;
            if(materia && materia.trim() !== "-" && materia.trim() !== "") materiasNombres.push(materia);
        });

        document.getElementById('infoDiaLabel').innerText = `D√≠a: ${diasNombres[dIdx]} - Jornada: ${j.toUpperCase()}`;
        let hHtml = `<th><input type="checkbox" disabled></th><th>N¬∞</th><th>Estudiante</th><th>Estado</th>`;
        materiasNombres.forEach((m, idx) => hHtml += `<th>L${idx+1}<br><small>${m}</small></th>`);
        document.getElementById('headerMaterias').innerHTML = hHtml + `<th>Total</th>`;

        const tbody = document.getElementById('listaAsistenciaCuerpo');
        const lista = JSON.parse(localStorage.getItem('mep_estudiantes_v2')) || [];
        tbody.innerHTML = "";

        lista.forEach((est, i) => {
            const nom = est.nombre;
            if(nom && nom.trim() !== "") {
                const estadoGuardado = datosGuardados[nom] ? datosGuardados[nom].estado : "P";
                const totalGuardado = datosGuardados[nom] ? datosGuardados[nom].total : 0;
                let leccs = "";
                materiasNombres.forEach((_, x) => {
                    let celdaTexto = "-"; let celdaColor = "transparent";
                    if(estadoGuardado === "AJ" || estadoGuardado === "AI") {
                        celdaTexto = estadoGuardado; celdaColor = estadoGuardado === "AJ" ? "#fff9c4" : "#ffcdd2";
                    } else if(estadoGuardado === "T" && x === 0) {
                        celdaTexto = "T"; celdaColor = "#bbdefb";
                    }
                    leccs += `<td class="L${x+1}" style="background-color:${celdaColor}" data-materia="${materiasNombres[x]}">${celdaTexto}</td>`;
                });

                let selectHtml = `<select onchange="aplicarMEP(this)">
                    <option value="P" ${estadoGuardado==="P"?"selected":""}>P</option>
                    <option value="AJ" ${estadoGuardado==="AJ"?"selected":""}>AJ</option>
                    <option value="AI" ${estadoGuardado==="AI"?"selected":""}>AI</option>
                    <option value="T" ${estadoGuardado==="T"?"selected":""}>T</option>
                </select>`;

                tbody.innerHTML += `<tr>
                    <td><input type="checkbox" class="check-estudiante" value="${nom}"></td>
                    <td>${i+1}</td>
                    <td class="st-name"><b>${nom}</b></td>
                    <td>${selectHtml}</td>
                    ${leccs}
                    <td class="total-f">${totalGuardado}</td>
                </tr>`;
            }
        });
        verificarAlertasSemana(fechaVal);
    }

    function aplicarMEP(sel) {
        const fila = sel.parentElement.parentElement;
        const est = sel.value;
        const tds = fila.querySelectorAll('td[class^="L"]');
        tds.forEach(t => { t.innerText = "-"; t.style.background = "none"; });
        if(est === "AJ" || est === "AI") {
            tds.forEach(t => { t.innerText = est; t.style.background = est=="AJ"?"#fff9c4":"#ffcdd2"; });
            fila.querySelector('.total-f').innerText = tds.length;
        } else if(est === "T") {
            const l1 = fila.querySelector('.L1'); if(l1) { l1.innerText="T"; l1.style.background="#bbdefb"; }
            fila.querySelector('.total-f').innerText = "0.5";
        } else {
            fila.querySelector('.total-f').innerText = "0";
        }
    }

    function guardarAsistenciaDelDia() {
        const fecha = document.getElementById('fechaAsistencia').value;
        const periodoSeleccionado = document.getElementById('periodoAsistencia').value;
        if(dbDiaria[fecha]) if(!confirm("Ya existe asistencia para este d√≠a. ¬øSobrescribir?")) return;

        const filas = document.querySelectorAll('#listaAsistenciaCuerpo tr');
        let datosDia = {};

        filas.forEach(fila => {
            const nombre = fila.querySelector('.st-name').innerText;
            const estado = fila.querySelector('select').value;
            const total = fila.querySelector('.total-f').innerText;
            datosDia[nombre] = { estado: estado, total: total };

            if(!dbAusencias[nombre]) dbAusencias[nombre] = { I: {}, II: {} };
            ["Espa√±ol", "Matem√°ticas", "Estudios Sociales", "Ciencias"].forEach(m => {
                if(!dbAusencias[nombre][periodoSeleccionado]) dbAusencias[nombre][periodoSeleccionado] = {};
                if(!dbAusencias[nombre][periodoSeleccionado][m]) dbAusencias[nombre][periodoSeleccionado][m] = {AJ:0, AI:0, T:0};
            });

            const lecciones = fila.querySelectorAll('td[class^="L"]');
            lecciones.forEach(td => {
                const matRaw = td.getAttribute('data-materia');
                const val = td.innerText;
                let key = "";
                if(matRaw.includes("Espa√±ol")) key = "Espa√±ol";
                else if(matRaw.includes("Matem√°ticas") || matRaw.includes("Mate")) key = "Matem√°ticas";
                else if(matRaw.includes("Estudios") || matRaw.includes("Soc")) key = "Estudios Sociales";
                else if(matRaw.includes("Ciencias")) key = "Ciencias";

                if(key && dbAusencias[nombre][periodoSeleccionado][key]) {
                    if(val === "AJ") dbAusencias[nombre][periodoSeleccionado][key].AJ += 1;
                    if(val === "AI") dbAusencias[nombre][periodoSeleccionado][key].AI += 1;
                    if(val === "T")  dbAusencias[nombre][periodoSeleccionado][key].T += 1;
                }
            });
        });

        dbDiaria[fecha] = { datos: datosDia, periodo: periodoSeleccionado };
        localStorage.setItem('mep_db_diaria', JSON.stringify(dbDiaria));
        localStorage.setItem('mep_db_ausencias_periodo', JSON.stringify(dbAusencias));
        alert("Asistencia guardada.");
        verificarAlertasSemana(fecha);
        renderResumen();
    }

    function borrarAsistenciaDia() {
        const fecha = document.getElementById('fechaAsistencia').value;
        if(!dbDiaria[fecha]) { alert("No hay datos."); return; }
        const checkboxes = document.querySelectorAll('.check-estudiante:checked');
        const estudiantesABorrar = Array.from(checkboxes).map(c => c.value);
        const esBorradoParcial = estudiantesABorrar.length > 0;
        if(!confirm(esBorradoParcial ? "Borrar selecci√≥n?" : "Borrar todo el d√≠a?")) return;

        const registro = dbDiaria[fecha].datos;
        const periodoGuardado = dbDiaria[fecha].periodo;
        const j = document.getElementById('jornadaAsistencia').value;
        const fechaObj = new Date(fecha + 'T00:00:00');
        let dIdx = fechaObj.getDay() - 1; if(dIdx < 0 || dIdx > 4) dIdx = 0;

        const materiasDiaNombres = [];
        horariosData[j].forEach(fila => {
            let materia = "";
            if(dIdx===0) materia = fila.lun; else if(dIdx===1) materia = fila.mar; else if(dIdx===2) materia = fila.mie; else if(dIdx===3) materia = fila.jue; else if(dIdx===4) materia = fila.vie;
            if(materia && materia.trim() !== "-" && materia.trim() !== "") materiasDiaNombres.push(materia);
        });

        const listaParaProcesar = esBorradoParcial ? estudiantesABorrar : Object.keys(registro);
        listaParaProcesar.forEach(nombreEstudiante => {
            if(!registro[nombreEstudiante]) return;
            const datos = registro[nombreEstudiante]; const estado = datos.estado;
            if (estado !== "P") {
                materiasDiaNombres.forEach((matRaw, index) => {
                    let key = "";
                    if(matRaw.includes("Espa√±ol")) key = "Espa√±ol";
                    else if(matRaw.includes("Matem√°ticas") || matRaw.includes("Mate")) key = "Matem√°ticas";
                    else if(matRaw.includes("Estudios") || matRaw.includes("Soc")) key = "Estudios Sociales";
                    else if(matRaw.includes("Ciencias")) key = "Ciencias";

                    if (key && dbAusencias[nombreEstudiante] && dbAusencias[nombreEstudiante][periodoGuardado] && dbAusencias[nombreEstudiante][periodoGuardado][key]) {
                        if(estado === "AJ") dbAusencias[nombreEstudiante][periodoGuardado][key].AJ = Math.max(0, dbAusencias[nombreEstudiante][periodoGuardado][key].AJ - 1);
                        if(estado === "AI") dbAusencias[nombreEstudiante][periodoGuardado][key].AI = Math.max(0, dbAusencias[nombreEstudiante][periodoGuardado][key].AI - 1);
                        if(estado === "T" && index === 0) dbAusencias[nombreEstudiante][periodoGuardado][key].T = Math.max(0, dbAusencias[nombreEstudiante][periodoGuardado][key].T - 1);
                    }
                });
            }
            if(esBorradoParcial) registro[nombreEstudiante] = { estado: "P", total: 0 };
        });

        if(esBorradoParcial) dbDiaria[fecha].datos = registro; else delete dbDiaria[fecha];
        localStorage.setItem('mep_db_diaria', JSON.stringify(dbDiaria));
        localStorage.setItem('mep_db_ausencias_periodo', JSON.stringify(dbAusencias));
        alert("Actualizado.");
        actualizarAsistencia();
        renderResumen();
    }

    function obtenerFechasSemana(fechaStr) {
        let fecha = new Date(fechaStr + 'T00:00:00');
        let diaSemana = fecha.getDay(); if (diaSemana === 0) diaSemana = 7;
        let primerDia = new Date(fecha); primerDia.setDate(fecha.getDate() - (diaSemana - 1));
        let fechas = [];
        for (let i = 0; i < 5; i++) {
            let d = new Date(primerDia); d.setDate(primerDia.getDate() + i);
            let mes = (d.getMonth() + 1).toString().padStart(2, '0');
            let dia = d.getDate().toString().padStart(2, '0');
            fechas.push(`${d.getFullYear()}-${mes}-${dia}`);
        }
        return fechas;
    }

    function verificarAlertasSemana(fechaRef) {
        const fechasSemana = obtenerFechasSemana(fechaRef);
        const listaEstudiantes = JSON.parse(localStorage.getItem('mep_estudiantes_v2')) || [];
        const panel = document.getElementById('panelAlertas');
        const listaAlertas = document.getElementById('listaAlertas');
        listaAlertas.innerHTML = "";
        let alertasEncontradas = 0;

        listaEstudiantes.forEach(est => {
            const nom = est.nombre;
            if(!nom) return;
            let conteoAusencias = 0;
            fechasSemana.forEach(f => {
                const registroDia = dbDiaria[f];
                if(registroDia && registroDia.datos && registroDia.datos[nom]) {
                    const estado = registroDia.datos[nom].estado;
                    if(estado === "AJ" || estado === "AI") conteoAusencias++;
                }
            });
            if(conteoAusencias >= 3) {
                alertasEncontradas++;
                const item = document.createElement('div');
                item.className = 'alerta-item';
                item.innerHTML = `<strong>${nom}</strong>: <span class="badge-riesgo">${conteoAusencias} d√≠as ausente esta semana</span>`;
                listaAlertas.appendChild(item);
            }
        });
        panel.style.display = alertasEncontradas > 0 ? "block" : "none";
    }

    function generarInformePDF() {
        const checkboxes = document.querySelectorAll('.check-estudiante:checked');
        if(checkboxes.length !== 1) { alert("Seleccione UN estudiante."); return; }
        const nombreEstudiante = checkboxes[0].value;
        const periodoActual = document.getElementById('periodoAsistencia').value;
        const fechaInicio = prompt("Fecha Inicio:", fechasMEP[periodoActual].inicio);
        const fechaFin = prompt("Fecha Fin:", fechasMEP[periodoActual].fin);
        if(!fechaInicio || !fechaFin) return;

        const listaV2 = JSON.parse(localStorage.getItem('mep_estudiantes_v2')) || [];
        const infoEst = listaV2.find(x => x.nombre === nombreEstudiante);
        const condicionEstudiante = infoEst ? infoEst.condicion : "No definida";

        if (!ensureJsPDFLoaded()) return;
        const doc = new jsPDF();
        const y0 = drawPDFHeader(doc);

        doc.setFontSize(16); 
        doc.text("Informe de Asistencia Individual", 14, y0);

        doc.setFontSize(12);
        doc.text(`Estudiante: ${nombreEstudiante}`, 14, y0 + 10);
        doc.text(`Condici√≥n: ${condicionEstudiante}`, 14, y0 + 16);
        doc.text(`Periodo: ${periodoActual}`, 14, y0 + 24);

        const filasTabla = [];
        let dInicio = new Date(fechaInicio); let dFin = new Date(fechaFin);
        const fechasOrdenadas = Object.keys(dbDiaria).sort();

        fechasOrdenadas.forEach(fechaStr => {
            const dActual = new Date(fechaStr + 'T00:00:00');
            if(dActual >= dInicio && dActual <= dFin) {
                const registroDia = dbDiaria[fechaStr];
                if(registroDia && registroDia.datos && registroDia.datos[nombreEstudiante]) {
                    const datos = registroDia.datos[nombreEstudiante];
                    if(datos.estado !== "P") {
                        let tipoTexto = "", detalleMaterias = "";
                        let diaSemana = dActual.getDay() - 1; if(diaSemana < 0) diaSemana = 0;
                        const j = document.getElementById('jornadaAsistencia').value;
                        const materiasDia = [];
                        horariosData[j].forEach(fila => {
                            let m = "";
                            if(diaSemana===0) m = fila.lun; else if(diaSemana===1) m = fila.mar; else if(diaSemana===2) m = fila.mie; else if(diaSemana===3) m = fila.jue; else if(diaSemana===4) m = fila.vie;
                            if(m && m.trim() !== "-" && m.trim() !== "") materiasDia.push(m);
                        });
                        if(datos.estado === "AJ") { tipoTexto = "Ausencia Justificada"; detalleMaterias = materiasDia.join(", "); }
                        else if(datos.estado === "AI") { tipoTexto = "Ausencia Injustificada"; detalleMaterias = materiasDia.join(", "); }
                        else if(datos.estado === "T") { tipoTexto = "Llegada Tard√≠a"; detalleMaterias = materiasDia.length > 0 ? materiasDia[0] + " (1¬∞ Lecci√≥n)" : ""; }
                        filasTabla.push([fechaStr, tipoTexto, detalleMaterias]);
                    }
                }
            }
        });

        if(filasTabla.length === 0) filasTabla.push(["-", "Sin incidencias", "-"]);
        doc.autoTable({ startY: y0 + 35, head: [['Fecha', 'Incidencia', 'Materias']], body: filasTabla });
        doc.save(`Informe_${nombreEstudiante}_${periodoActual}.pdf`);
    }

    // --- RESUMEN ---
    function cambiarPeriodoResumen(periodo, btn) {
        periodoActualResumen = periodo;
        document.querySelectorAll('.btn-periodo').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        document.getElementById('tituloResumenPeriodo').innerText = `Viendo: ${periodo} Periodo`;
        renderResumen();
    }

    function filtrarMateria(materia) {
        materiaActual = materia;
        document.querySelectorAll('.btn-materia').forEach(b => b.classList.remove('active'));
        if (typeof event !== "undefined" && event && event.target) event.target.classList.add('active');
        renderResumen();
    }

    function renderResumen() {
        const tbody = document.getElementById('resumenCuerpo');
        tbody.innerHTML = "";
        const lista = JSON.parse(localStorage.getItem('mep_estudiantes_v2')) || [];

        lista.forEach(est => {
            const nom = est.nombre;
            if(nom && nom.trim() !== "") {
                const datosUsuario = dbAusencias[nom] || {};
                const datosPeriodo = datosUsuario[periodoActualResumen];
                const dataMat = datosPeriodo ? (datosPeriodo[materiaActual] || {AJ:0, AI:0, T:0}) : {AJ:0, AI:0, T:0};
                tbody.innerHTML += `<tr>
                    <td style="font-weight:bold">${nom}</td>
                    <td><span class="tag-aj">${dataMat.AJ}</span></td>
                    <td><span class="tag-ai">${dataMat.AI}</span></td>
                    <td><span class="tag-t">${dataMat.T}</span></td>
                    <td>-</td>
                    <td>-</td>
                </tr>`;
            }
        });
        filtrarResumen();
    }

    function filtrarResumen() {
        const input = document.getElementById('buscadorResumen').value.toLowerCase();
        const filas = document.querySelectorAll('#resumenCuerpo tr');
        filas.forEach(f => {
            const nombre = f.cells[0].innerText.toLowerCase();
            f.style.display = nombre.includes(input) ? "" : "none";
        });
    }


    // --- BIT√ÅCORA 2026 (Observaciones / Contingencias) ---
    const BITACORA_YEAR = 2026;
    const bitacoraMeses = ["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"];
    const bitacoraDias = ["L","M","X","J","V","S","D"]; // Semana inicia Lunes

    function pad2(n){ return String(n).padStart(2,'0'); }
    function isoDate(y,m,d){ return `${y}-${pad2(m)}-${pad2(d)}`; }

    function bitacoraEsCursoLectivo(dateStr){
        return (dateStr >= fechasMEP.I.inicio && dateStr <= fechasMEP.I.fin) ||
               (dateStr >= fechasMEP.II.inicio && dateStr <= fechasMEP.II.fin);
    }

    function bitacoraFechaBonita(dateStr){
        try{
            const dt = new Date(dateStr + 'T00:00:00');
            return new Intl.DateTimeFormat('es-CR', { weekday:'long', year:'numeric', month:'long', day:'numeric' }).format(dt);
        }catch(e){
            return dateStr;
        }
    }

    function initBitacora(){
        if(bitacoraInited){
            renderBitacoraYear();
            renderBitacoraLista();
            return;
        }

        const yearLabel = document.getElementById('bitacoraYearLabel');
        if(yearLabel) yearLabel.innerText = String(BITACORA_YEAR);

        // Llenar selector de mes
        const sel = document.getElementById('bitacoraMesSelect');
        if(sel){
            sel.innerHTML = "";
            bitacoraMeses.forEach((m,i) => {
                const op = document.createElement('option');
                op.value = String(i);
                op.textContent = m;
                sel.appendChild(op);
            });
        }

        // Selecci√≥n inicial: HOY (si es 2026), si no: 2026-01-01
        let dt = new Date();
        if(dt.getFullYear() !== BITACORA_YEAR) dt = new Date(BITACORA_YEAR, 0, 1);
        bitacoraSelectedDate = isoDate(BITACORA_YEAR, dt.getMonth()+1, dt.getDate());

        if(sel) sel.value = String(dt.getMonth());
        renderBitacoraYear();
        selectBitacoraDate(bitacoraSelectedDate, /*skipRerender*/ true);
        renderBitacoraLista();

        // Intentar que el mes visible quede cerca del seleccionado
        setTimeout(() => bitacoraIrAlMes(), 50);

        bitacoraInited = true;
    }

    function renderBitacoraYear(){
        const grid = document.getElementById('bitacoraYearGrid');
        if(!grid) return;

        const soloLectivo = document.getElementById('bitacoraSoloLectivo')?.checked || false;

        // Guardamos el scroll actual para no "brincar" tanto al re-render
        const prevScroll = grid.scrollTop;

        grid.innerHTML = "";

        const hoy = new Date();
        const hoyIso = (hoy.getFullYear() === BITACORA_YEAR) ? isoDate(BITACORA_YEAR, hoy.getMonth()+1, hoy.getDate()) : null;

        for(let month=0; month<12; month++){
            const cont = document.createElement('div');
            cont.className = "bitacora-month";
            cont.id = `bitacoraMonth-${month}`;

            const title = document.createElement('div');
            title.className = "bitacora-month-title";
            title.textContent = bitacoraMeses[month] + " " + BITACORA_YEAR;
            cont.appendChild(title);

            const w = document.createElement('div');
            w.className = "bitacora-weekdays";
            bitacoraDias.forEach(d => {
                const s = document.createElement('div');
                s.textContent = d;
                w.appendChild(s);
            });
            cont.appendChild(w);

            const daysWrap = document.createElement('div');
            daysWrap.className = "bitacora-days";

            // Desfase: lunes=0 ... domingo=6
            const first = new Date(BITACORA_YEAR, month, 1);
            const offset = (first.getDay() + 6) % 7;
            for(let i=0;i<offset;i++){
                const b = document.createElement('button');
                b.type="button";
                b.className="bitacora-day blank";
                b.disabled = true;
                b.textContent = "";
                daysWrap.appendChild(b);
            }

            const daysInMonth = new Date(BITACORA_YEAR, month+1, 0).getDate();
            for(let day=1; day<=daysInMonth; day++){
                const dateStr = isoDate(BITACORA_YEAR, month+1, day);

                const btn = document.createElement('button');
                btn.type = "button";
                btn.className = "bitacora-day";
                btn.textContent = String(day);
                btn.dataset.date = dateStr;

                const isLectivo = bitacoraEsCursoLectivo(dateStr);
                if(!isLectivo) btn.classList.add("outside");
                if(soloLectivo && !isLectivo) btn.disabled = true;

                if(hoyIso && dateStr === hoyIso) btn.classList.add("today");
                if(bitacoraSelectedDate && dateStr === bitacoraSelectedDate) btn.classList.add("selected");

                const entry = dbBitacora[dateStr];
                if(entry && entry.text && String(entry.text).trim() !== "") btn.classList.add("has-note");

                btn.addEventListener('click', () => selectBitacoraDate(dateStr));
                daysWrap.appendChild(btn);
            }

            cont.appendChild(daysWrap);
            grid.appendChild(cont);
        }

        // Restaurar scroll (suave)
        grid.scrollTop = prevScroll;
    }

    function selectBitacoraDate(dateStr, skipRerender=false){
        bitacoraSelectedDate = dateStr;

        const info = document.getElementById('bitacoraFechaSel');
        const esLectivo = bitacoraEsCursoLectivo(dateStr);
        if(info){
            info.innerText = `üìÖ ${bitacoraFechaBonita(dateStr)}  ‚Äî  ${esLectivo ? 'Curso lectivo' : 'Fuera del curso lectivo'}`;
            info.style.borderLeftColor = esLectivo ? "var(--mep-green)" : "var(--mep-yellow)";
            info.style.color = esLectivo ? "#1e8449" : "#856404";
            info.style.background = esLectivo ? "#eafaf1" : "#fff3cd";
        }

        const textarea = document.getElementById('bitacoraTexto');
        if(textarea){
            textarea.value = (dbBitacora[dateStr] && dbBitacora[dateStr].text) ? dbBitacora[dateStr].text : "";
        }

        // Ajustar selector de mes
        const sel = document.getElementById('bitacoraMesSelect');
        if(sel){
            const m = parseInt(dateStr.split('-')[1], 10) - 1;
            if(!isNaN(m)) sel.value = String(m);
        }

        if(!skipRerender) renderBitacoraYear();
        renderBitacoraLista();
    }

    function guardarBitacora(){
        if(!bitacoraSelectedDate){
            alert("Seleccione una fecha en el calendario.");
            return;
        }
        const textarea = document.getElementById('bitacoraTexto');
        const texto = textarea ? textarea.value.trim() : "";

        if(texto === ""){
            // si queda vac√≠o, eliminamos la entrada
            if(dbBitacora[bitacoraSelectedDate]){
                delete dbBitacora[bitacoraSelectedDate];
                localStorage.setItem('mep_db_bitacora_2026', JSON.stringify(dbBitacora));
                alert("Entrada eliminada (texto vac√≠o).");
                renderBitacoraYear();
                renderBitacoraLista();
            }else{
                alert("Nada que guardar.");
            }
            return;
        }

        dbBitacora[bitacoraSelectedDate] = {
            text: texto,
            updatedAt: new Date().toISOString()
        };
        localStorage.setItem('mep_db_bitacora_2026', JSON.stringify(dbBitacora));
        alert("Bit√°cora guardada.");
        renderBitacoraYear();
        renderBitacoraLista();
    }

    function borrarBitacora(){
        if(!bitacoraSelectedDate){ alert("Seleccione una fecha."); return; }
        if(!dbBitacora[bitacoraSelectedDate]){ alert("No hay entrada guardada para ese d√≠a."); return; }
        if(!confirm("¬øBorrar la entrada de este d√≠a?")) return;

        delete dbBitacora[bitacoraSelectedDate];
        localStorage.setItem('mep_db_bitacora_2026', JSON.stringify(dbBitacora));
        const textarea = document.getElementById('bitacoraTexto');
        if(textarea) textarea.value = "";
        alert("Entrada borrada.");
        renderBitacoraYear();
        renderBitacoraLista();
    }

    function renderBitacoraLista(){
        const cont = document.getElementById('bitacoraLista');
        const empty = document.getElementById('bitacoraEmpty');
        if(!cont || !empty) return;

        const q = (document.getElementById('bitacoraBuscar')?.value || "").trim().toLowerCase();

        let entries = Object.entries(dbBitacora)
            .filter(([d, v]) => d.startsWith(BITACORA_YEAR + "-") && v && v.text && String(v.text).trim() !== "")
            .map(([d, v]) => ({ date: d, text: String(v.text), updatedAt: v.updatedAt || "" }));

        if(q){
            entries = entries.filter(e => (e.date + " " + e.text).toLowerCase().includes(q));
        }

        // Ordenar por fecha DESC
        entries.sort((a,b) => (a.date < b.date) ? 1 : (a.date > b.date) ? -1 : 0);

        if(entries.length === 0){
            cont.innerHTML = "";
            empty.style.display = "block";
            return;
        }
        empty.style.display = "none";

        cont.innerHTML = entries.slice(0, 80).map(e => {
            const snippet = e.text.length > 160 ? (e.text.slice(0,160) + "‚Ä¶") : e.text;
            const upd = e.updatedAt ? ("√öltima edici√≥n: " + new Date(e.updatedAt).toLocaleString()) : "";
            return `
                <div class="bitacora-entry">
                    <div class="meta">
                        <div class="fecha">${e.date}</div>
                        <div class="small">${upd}</div>
                        <div class="snippet">${snippet.replace(/</g,"&lt;").replace(/>/g,"&gt;")}</div>
                    </div>
                    <button class="go" onclick="selectBitacoraDate('${e.date}')">Abrir</button>
                </div>
            `;
        }).join("");
    }

    function bitacoraIrAHoy(){
        let dt = new Date();
        if(dt.getFullYear() !== BITACORA_YEAR) dt = new Date(BITACORA_YEAR, 0, 1);
        const dateStr = isoDate(BITACORA_YEAR, dt.getMonth()+1, dt.getDate());
        selectBitacoraDate(dateStr);
        bitacoraIrAlMes();
    }

    function bitacoraIrAlMes(){
        const sel = document.getElementById('bitacoraMesSelect');
        if(!sel) return;
        const m = parseInt(sel.value, 10);
        if(isNaN(m)) return;
        const target = document.getElementById(`bitacoraMonth-${m}`);
        if(target) target.scrollIntoView({ behavior: "smooth", block: "start" });
    }

    function generarPDFBitacora(){
        if(!ensureJsPDFLoaded()) return;

        // Mes a exportar: el del d√≠a seleccionado (o el mes actual si es 2026)
        let month = 0;
        if(bitacoraSelectedDate){
            month = parseInt(bitacoraSelectedDate.split("-")[1], 10) - 1;
        }else{
            const dt = new Date();
            month = (dt.getFullYear() === BITACORA_YEAR) ? dt.getMonth() : 0;
        }

        const mm = pad2(month+1);
        let entries = Object.entries(dbBitacora)
            .filter(([d, v]) => d.startsWith(`${BITACORA_YEAR}-${mm}-`) && v && v.text && String(v.text).trim() !== "")
            .map(([d, v]) => ({ date: d, text: String(v.text) }));

        entries.sort((a,b) => (a.date > b.date) ? 1 : (a.date < b.date) ? -1 : 0);

        if(entries.length === 0){
            alert("No hay entradas para ese mes.");
            return;
        }

        const doc = new jsPDF();
        const y0 = drawPDFHeader(doc);

        doc.setFontSize(16);
        doc.text(`Bit√°cora ${BITACORA_YEAR} - ${bitacoraMeses[month]}`, 14, y0);

        doc.setFontSize(11);
        doc.text("Observaciones / Contingencias", 14, y0 + 8);

        const filas = entries.map(e => [e.date, e.text]);
        doc.autoTable({
            startY: y0 + 14,
            head: [["Fecha", "Observaci√≥n / Contingencia"]],
            body: filas,
            styles: { fontSize: 9, cellPadding: 2 },
            columnStyles: { 0: { cellWidth: 26 } }
        });

        doc.save(`Bitacora_${BITACORA_YEAR}_${mm}.pdf`);
    }

    // --- NAVEGACI√ìN ---
    function showTab(t) {
        document.getElementById('submenuAsistencia').classList.remove('visible');
        document.querySelectorAll('.card').forEach(c => c.classList.add('hidden'));
        document.querySelectorAll('.btn-nav').forEach(b => b.classList.remove('active'));

        if(t === 'mainAsistencia') {
            document.getElementById('submenuAsistencia').classList.add('visible');
            document.getElementById('tabMainAsistencia').classList.add('active');
        } else if(t === 'pruebas') {
            document.getElementById('sectionPruebas').classList.remove('hidden');
            document.getElementById('tabPruebas').classList.add('active');
            cargarDatosPrueba();
        } else if(t === 'tareas') {
            document.getElementById('sectionTareas').classList.remove('hidden');
            document.getElementById('tabTareas').classList.add('active');
            cargarDatosTarea();
        } else if(t === 'cotidiano') {
            document.getElementById('sectionCotidiano').classList.remove('hidden');
            document.getElementById('tabCotidiano').classList.add('active');
            cargarDatosCotidiano();
        } else if(t === 'bitacora') {
            document.getElementById('sectionBitacora').classList.remove('hidden');
            document.getElementById('tabBitacora').classList.add('active');
            initBitacora();
        }
        else if(t === 'instrumentoCotidiano') {
            document.getElementById('sectionInstrumentoCotidiano').classList.remove('hidden');
            document.getElementById('tabInstrumentoCotidiano').classList.add('active');
            asegurarInstrumentoCotidianoCargado();
        } else {
            document.getElementById('section' + t.charAt(0).toUpperCase() + t.slice(1)).classList.remove('hidden');
            if(t==='horario') document.getElementById('tabHorario').classList.add('active');
            if(t==='estudiantes') document.getElementById('tabEstudiantes').classList.add('active');
        }
    }

    

    // --- INSTRUMENTO DE COTIDIANO (EMBEBIDO) ---
    function asegurarInstrumentoCotidianoCargado(force=false) {
        const iframe = document.getElementById('instrumentoFrame');
        const tpl = document.getElementById('tplInstrumentoCotidiano');
        if (!iframe || !tpl) return;

        const already = iframe.getAttribute('data-loaded') === 'true';
        if (already && !force) return;

        // Cargar el HTML del instrumento dentro del iframe (un solo archivo)
        iframe.srcdoc = tpl.innerHTML;
        iframe.setAttribute('data-loaded', 'true');
    }

    function recargarInstrumentoCotidiano() {
        asegurarInstrumentoCotidianoCargado(true);
    }

    function abrirInstrumentoPantallaCompleta() {
        const iframe = document.getElementById('instrumentoFrame');
        if (!iframe) return;

        if (iframe.requestFullscreen) iframe.requestFullscreen();
        else if (iframe.webkitRequestFullscreen) iframe.webkitRequestFullscreen();
        else if (iframe.msRequestFullscreen) iframe.msRequestFullscreen();
        else alert('Pantalla completa no soportada en este navegador.');
    }


    function showSubTab(subTab) {
        document.getElementById('submenuAsistencia').classList.remove('visible');
        document.getElementById('section' + subTab.charAt(0).toUpperCase() + subTab.slice(1)).classList.remove('hidden');
        if(subTab === 'asistencia') actualizarAsistencia();
        if(subTab === 'resumen') renderResumen();
    }

    // --- INIT ---
    document.getElementById('fechaAsistencia').valueAsDate = new Date();
    initPortada();
    initEstudiantes();
    renderizarHorario();
    renderResumen();
    showTab('portada');
</script>

</body>
</html>
